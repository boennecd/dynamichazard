if(interactive()){
  library(survival); library(dynamichazard); library(testthat)
  source("./R/test_utils.R")
}

# Test on data set that is one of Farhmiers papers
result = ddhazard(
  formula = survival::Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 1, # Use by month intervals
  control = list(est_Q_0 = F, n_max = 10^4, eps = 10^-4,
                 save_data = F, save_risk_set = F),
  a_0 = rep(0, 2), Q_0 = diag(1, 2), # Initial value
  max_T = 45,
  id = head_neck_cancer$id, order = 1
)

# plot(result, cov_index = 2)
# get_expect_equal(result, file = "tmp.txt")

expect_equal(c(result$state_vecs),
             c(-3.5025281961134787, -3.5025877576033477, -3.1321088612085983, -2.7757440091832057, -2.4919226130185796, -2.0481629213672718, -2.1192831215763093, -2.5081974639847040, -2.7397385003032992, -2.8845741297267971, -3.0249425773489134, -3.2400528773087220, -3.3649953385374434, -3.4209971757442106, -3.2738906455544505, -3.3169512577607794, -3.4382520761838764, -3.5423227286382666, -3.5025280610662426, -3.5881855240853717, -3.5581765201478746, -3.6816191615343223, -3.8597566904517313, -3.9786676622646073, -4.0361038571766708, -4.1732583956028995, -4.2656563848289011, -4.3141579768727913, -4.4604842005904972, -4.5793523090954995, -4.6702239867590185, -4.7332575267101360, -4.7685792576318100, -4.7761302924183315, -4.7556545004572994, -4.7067217620380086, -4.6287569806218709, -4.5210666088772840, -4.5211246420955638, -4.6290434142170565, -4.7225212272260517, -4.7987715172838055, -4.8571588039855502, -4.9005507089961524, -4.9291008412739341, -4.9428800599987603, 0.4611869044292034, 0.4611973957569191, 0.4644812524045190, 0.4736355394554351,  0.4669827742862612, 0.4837779729722258, 0.4898265943380803, 0.4860728861187437, 0.5052218028384193,  0.5135282631906429, 0.5190721140735243, 0.5202520241841503, 0.5286518809011893, 0.5439737247040330,  0.5619043578043230, 0.5619249621124215, 0.5611736349659849, 0.5660506677350730, 0.5722505331289359,  0.5773467910015616, 0.5834634039203218, 0.5769074684671019, 0.5749777881080025, 0.5734079048915875,  0.5722037907454223, 0.5757739716021596, 0.5797523773232870, 0.5841753632079369, 0.5934274294860569,  0.6031478029556855, 0.6132990871420009, 0.6238518360306121, 0.6347839458711073, 0.6460791936890807,  0.6577259525203066, 0.6697161933542817, 0.6820447299834685, 0.6947086479136694, 0.7009643574480928,  0.7006518516294673, 0.7004158564901843, 0.7002594597824986, 0.7001824345106531, 0.7001175765838670,  0.7000642351810415, 0.7000221623978419 ))

expect_equal(c(result$state_vars),
             c( 0.24966773368218786, -0.04852029000361392, -0.04852029000361389, 0.10685530511125829,  0.16324645041995289, -0.05271757666862437, -0.05271757666862434, 0.09828781852130458,  0.15325430938443149, -0.05162795076841659, -0.05162795076841659, 0.09136058704366490,  0.13495516427714296, -0.04929835651868680, -0.04929835651868683, 0.08496667085337734,  0.11565049223272644, -0.04726320825775959, -0.04726320825775961, 0.07932121905215284,  0.10178753695006632, -0.04274365026883695, -0.04274365026883695, 0.07487249696497597,  0.08289059384724072, -0.03967528470467367, -0.03967528470467367, 0.07163527330767552,  0.08578092764648139, -0.03846953031547166, -0.03846953031547165, 0.07084598469140357,  0.09989891251830449, -0.03828003928875170, -0.03828003928875170, 0.07199997499224448,  0.11295375016727069, -0.03890277688215408, -0.03890277688215407, 0.07418835553444229,  0.12373842571401289, -0.03974565037309754, -0.03974565037309753, 0.07705264985807921,  0.13473520084838175, -0.04057675152505523, -0.04057675152505523, 0.08045959690347994,  0.15058105305824362, -0.04169144974851560, -0.04169144974851560, 0.08433515349608449,  0.16475487689604817, -0.04313298868294341, -0.04313298868294340, 0.08844909148216468,  0.17649960812428095, -0.04469608555201694, -0.04469608555201694, 0.09271710753685869,  0.17457340811056918, -0.04624984779405965, -0.04624984779405965, 0.09698071771152830,  0.17729143834732247, -0.04793202830663135, -0.04793202830663135, 0.10153069332180298,  0.18781431644426710, -0.04988371630787453, -0.04988371630787453, 0.10645602554255014,  0.20226968890371799, -0.05200709477099941, -0.05200709477099941, 0.11169506602767454,  0.21057571962387894, -0.05417688326323991, -0.05417688326323991, 0.11709140194506812,  0.22152250807520027, -0.05647512985785519, -0.05647512985785519, 0.12275524191816919,  0.22514073774398694, -0.05881421064946086, -0.05881421064946086, 0.12856556534008104,  0.23575065936263351, -0.06169553642911084, -0.06169553642911083, 0.13471898476829020,  0.25340692731452963, -0.06480570637453512, -0.06480570637453510, 0.14123036954284510,  0.27107977399326072, -0.06808713214761060, -0.06808713214761059, 0.14798506451979404,  0.28472014812725088, -0.07152287576324623, -0.07152287576324623, 0.15491381998439313,  0.30339422994056781, -0.07518177129671275, -0.07518177129671275, 0.16212017559769024,  0.32068511056675808, -0.07881456491481259, -0.07881456491481259, 0.16951965225692336,  0.33378230195915271, -0.08244341708455906, -0.08244341708455906, 0.17707023560687726,  0.35358556972543320, -0.08605941482097960, -0.08605941482097960, 0.18490296127670985,  0.37617971793236965, -0.08966669605211727, -0.08966669605211727, 0.19295926473176217,  0.39964313796565276, -0.09325935310968274, -0.09325935310968275, 0.20120153675928507,  0.42279983339880933, -0.09682742127231320, -0.09682742127231321, 0.20960319710208880,  0.44474826795908584, -0.10035929363122134, -0.10035929363122136, 0.21814439918955283,  0.46465242556313213, -0.10384280859001971, -0.10384280859001972, 0.22680979489598740,  0.48163515765033976, -0.10726579703353845, -0.10726579703353846, 0.23558722226836393,  0.49471515025978507, -0.11061639909706367, -0.11061639909706368, 0.24446686862305730,  0.50276354516355681, -0.11388328248736546, -0.11388328248736547, 0.25344070457840195,  0.50362840905683237, -0.11694708051804112, -0.11694708051804113, 0.26249616065860049,  0.50886077519654149, -0.12000602290451649, -0.12000602290451649, 0.27177305917769967,  0.53753940894196228, -0.12331671148414861, -0.12331671148414861, 0.28150057273930468,  0.58422478156386226, -0.12675788251307221, -0.12675788251307221, 0.29159871019358652,  0.64854604358809853, -0.13024962589839847, -0.13024962589839847, 0.30202284254748069,  0.72726312575007357, -0.13408461161855237, -0.13408461161855237, 0.31268054143506063,  0.82372145328515756, -0.13821320036111659, -0.13821320036111659, 0.32355970964820718,  0.94204781019899575, -0.14259877676047242, -0.14259877676047242, 0.33465057109659269 ))

expect_equal(c(result$lag_one_cov),
             c( 0.14263116443415219, -0.04574920743260352, -0.05150543127174809, 0.09699079285706530,  0.10452193073617830, -0.04874739256245561, -0.05088688773815839, 0.08928873888007144,  0.09205816511743103, -0.04756288533170949, -0.04850365075455021, 0.08264748691502014,  0.07619687084467806, -0.04535505584257066, -0.04622466673349493, 0.07665184030229086,  0.06287176863202983, -0.04325886709103238, -0.04160716987308177, 0.07163427585559659,  0.04986944205987141, -0.03926405432290643, -0.03806053191486011, 0.06781573294293351,  0.04420678758208781, -0.03685812925848052, -0.03626291638490246, 0.06582468960959215,  0.04965011164211783, -0.03619367549364379, -0.03566682153220575, 0.06600412552478148,  0.05984037617699758, -0.03636192416054163, -0.03603336054933529, 0.06766354299450550,  0.06941035250370327, -0.03719088862092337, -0.03674084832627796, 0.07017664132977827,  0.07843493570034743, -0.03816550473187627, -0.03750684008628748, 0.07329844218824491,  0.08981493623946754, -0.03911819040254304, -0.03855808469632750, 0.07692587692407565,  0.10310658635478691, -0.04033010070998009, -0.03993869643713704, 0.08090961285689185,  0.11484463103360977, -0.04182722190206258, -0.04147133842862829, 0.08509110857921251,  0.11943889701282755, -0.04342857676366355, -0.04299835576581806, 0.08934994645705957,  0.11985243543009538, -0.04503133111582946, -0.04463580013043104, 0.09374691854979829,  0.12588538775084249, -0.04678858788297480, -0.04651894024076669, 0.09847389307447472,  0.13738385412440385, -0.04880681824779191, -0.04858628426379726, 0.10354633878610373,  0.14810467051698023, -0.05097881767359873, -0.05071611232481709, 0.10885655043099464,  0.15713971417898470, -0.05320244372983142, -0.05296561856819847, 0.11437825391674580,  0.16409749051278422, -0.05554564899105975, -0.05526366996309488, 0.12010875527332561,  0.17082169764926447, -0.05798517239621716, -0.05803435922163328, 0.12608210458780958,  0.18419244224951820, -0.06094157095036142, -0.06106650077427613, 0.13240606956799864,  0.20111915566759409, -0.06411857444864097, -0.06428014648816466, 0.13903231308527825,  0.21626339706997472, -0.06746230932018556, -0.06765132467092075, 0.14586836604869613,  0.23182744393716970, -0.07096532642848453, -0.07123809751737308, 0.15292935143336489,  0.24930432312366094, -0.07466552730666579, -0.07483158079442649, 0.16022691389911348,  0.26415101326279677, -0.07833917344388450, -0.07842064208601737, 0.16769729388739543,  0.28012526849294306, -0.08200216252035231, -0.08200453448237387, 0.17538307791434882,  0.30081469440241881, -0.08565137931089720, -0.08558233025367115, 0.18332254453471691,  0.32337781059751103, -0.08928760593720944, -0.08914990301383557, 0.19146736372042583,  0.34628498339489699, -0.09290425309985131, -0.09269742679066141, 0.19978529664717548,  0.36849989976218822, -0.09649155120250313, -0.09621288382965747, 0.20825303230026262,  0.38915143680505826, -0.10003839047880873, -0.09968351196260299, 0.21685290223635492,  0.40737973041049202, -0.10353321248541911, -0.10309647246244749, 0.22557109735345471,  0.42225260062760034, -0.10696449380634662, -0.10643920190335200, 0.23439658806889352,  0.43271270640033899, -0.11032104844718801, -0.10969963395979600, 0.24332041966466161,  0.43712323548021881, -0.11357939358846696, -0.11277225427960132, 0.25233231529368649,  0.44011649003356479, -0.11665841117598591, -0.11581344390893213, 0.26149456293695200,  0.45665574959249472, -0.11976869591380095, -0.11906857542687402, 0.27099088451026349,  0.49359720139669694, -0.12311415858361298, -0.12247186720389780, 0.28089856452764828,  0.54817221315200193, -0.12657419894355940, -0.12594165166472532, 0.29115499561373626,  0.61879172548337624, -0.13011247751412444, -0.12971638317819814, 0.30169208152706284,  0.70537058299019650, -0.13398820658801849, -0.13378869915457109, 0.31245682036970446,  0.81162044555582791, -0.13815236427340125, -0.13812122259985932, 0.32343824571520668 ))

expect_equal(c(result$fixed_effects),
             c(numeric(0) ))

expect_equal(c(result$n_iter),
             c(155 ))

expect_equal(c(result$Q),
             c( 0.142998595679639462, -0.004474914532711241, -0.004474914532711241, 0.011173790883017135 ))

expect_equal(c(result$Q_0),
             c(1, 0, 0, 1 ))

expect_equal(c(result$n_risk),
             c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18, 18, 18, 18, 18, 18, 18, 17, 15, 14, 14, 14, 12, 12, 12, 11 ))

expect_equal(c(result$times),
             c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45 ))

expect_equal(c(result$risk_set),
             c(NULL ))

expect_equal(c(result$data),
             c(NULL ))

expect_equal(c(result$order),
             c(1 ))

expect_equal(c(result$F_),
             c(1, 0, 0, 1 ))

expect_equal(c(result$method),
             c("EKF" ))

expect_equal(c(result$model),
             c("logit" ))

expect_equal(c(result$est_Q_0),
             c(FALSE ))

expect_equal(c(result$LR),
             c(1 ))

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result$state_vecs), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result$state_vars)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result$Q_0)), rep(c("(Intercept)", "group1"), 2))
})

test_that("Invalid penalty terms throw error", {
  expect_error(
    ddhazard(
      formula = survival::Surv(start, stop, event) ~ group,
      data = head_neck_cancer,
      by = 1, # Use by month intervals
      control = list(ridge_eps = 0)),
    regexp = "Method not implemented with penalty term \\(control\\$ridge_eps\\) equal to 0")

  expect_error(
    ddhazard(
      formula = survival::Surv(start, stop, event) ~ group,
      data = head_neck_cancer,
      by = 1, # Use by month intervals
      control = list(ridge_eps = -1)),
    regexp = "Method not implemented with penalty term \\(control\\$ridge_eps\\) equal to -1")
})

# tmp <- file("tmp.txt")
# sink(tmp)
suppressMessages(
  result_exp <- ddhazard(
    formula = survival::Surv(start, stop, event) ~ group,
    data = head_neck_cancer,
    by = 1, Q_0 = diag(.1, 2),
    Q = diag(1e-3, 2),
    control = list(est_Q_0 = F, n_max = 10^3, eps = 10^-4,
                   ridge_eps = 6e-2, save_data = F, save_risk_set = F),
    max_T = 30,
    id = head_neck_cancer$id, order = 1,
    verbose = F,
    model = "exponential"))
# sink()
# close(tmp)

# matplot(result_exp$state_vecs, type = "l")
# plot(result_exp, cov_index = 1)
# get_expect_equal(result_exp, file = "tmp.txt")

test_that("Result of exponential model on head_neck_data match previous results", {
  expect_equal(c(result_exp$state_vecs),
               c(-3.394447244746940928, -3.395153862315309024, -3.196934232144033938, -2.971370346786660566, -2.822363247966916955, -2.590374297594293385, -2.845451418921749021, -3.208754849655392150, -3.195992238503036376, -3.240424933427576981, -3.326744568839408167, -3.486460861415831669, -3.541928860019987191, -3.555787834370727651, -3.500120792413564885, -3.537496720642140602, -3.619653771189799585, -3.674506083482546259, -3.674651986577258000, -3.721577918162045862, -3.728201675120116576, -3.805010414189156975, -3.888055436948069321, -3.941960186742282879, -3.974466929102445700, -4.020706260103636076, -4.050110181610269144, -4.066153562166032742, -4.097505411945125964, -4.116975796142062549, -4.126152028734782817, 0.122916801171788451, 0.122533990313387006, 0.229527436797392376, 0.351370734874934643,  0.431297003639860010, 0.556782716408514511, 0.418632585638882948, 0.222172318828795290, 0.230645591942916117,  0.207498087114898033, 0.161454926414956679, 0.075452660198855256, 0.046037773572253332, 0.039263985561146436,  0.070000816752319173, 0.050007468669361621, 0.005752906900555035, -0.023585512732629672, -0.023428508348726215, -0.048575868452773931, -0.051999554661921105, -0.093668183155480020, -0.138558245876324398, -0.167751472331311990, -0.185423032115404118, -0.210398017154723921, -0.226308766328840061, -0.235025858701956525, -0.251906418694424872, -0.262388738913313824, -0.267328586639344778 ))

  expect_equal(c(result_exp$state_vars),
               c( 0.0769109729673901760, 0.0024536580489280015, 0.0024536580489280032, 0.0698992385820926820, 0.1042941119147692275,  0.0150384675508058330, 0.0150384675508058382, 0.0759448389094937448, 0.1219728793991194521, 0.0231903058451575182,  0.0231903058451575286, 0.0800679656176722099, 0.1230432906455513065, 0.0223322095596818343, 0.0223322095596818412,  0.0793223844019501079, 0.1103004950688061120, 0.0138735447522551902, 0.0138735447522552041, 0.0744169746041761365,  0.0970627617237544010, 0.0052158068860564261, 0.0052158068860564365, 0.0694800066653862014, 0.0684019434883764849, -0.0120319071185752517, -0.0120319071185752483, 0.0598041160592471394, 0.0882051195996330223, -0.0003465937743108031, -0.0003465937743108031, 0.0674182539353717220, 0.1154779469923206681, 0.0156772204485779477, 0.0156772204485779477,  0.0776181230783223042, 0.1272127282062879561, 0.0229150724776038574, 0.0229150724776038608, 0.0828882130290883035,  0.1355465325022736645, 0.0281392010628513725, 0.0281392010628513725, 0.0870069181623930876, 0.1468915885519631037,  0.0350130485236963274, 0.0350130485236963204, 0.0920617412760395548, 0.1692065682033239149, 0.0479053005015653496,  0.0479053005015653635, 0.1004510102245208536, 0.1876054679883882303, 0.0584981337118647762, 0.0584981337118647832,  0.1075157569113651956, 0.2009721122650755254, 0.0662366601197965782, 0.0662366601197965921, 0.1129782227697642139,  0.2043995550809924733, 0.0684504302554253402, 0.0684504302554253541, 0.1153808161034944602, 0.2105592801998395214,  0.0720417136418841086, 0.0720417136418841225, 0.1184903098172603031, 0.2259541153201423125, 0.0806342874444740398,  0.0806342874444740398, 0.1243269906938002933, 0.2440338533475068794, 0.0906345387485875398, 0.0906345387485875537,  0.1309141887455235465, 0.2586345465007773292, 0.0986441193013575524, 0.0986441193013575524, 0.1363743609270683943,  0.2754463345565064669, 0.1078279486353412309, 0.1078279486353412447, 0.1424681063093525546, 0.2895308626534787155,  0.1154620255376587745, 0.1154620255376587329, 0.1476902588984260190, 0.3126473663631990640, 0.1278971261909256363,  0.1278971261909255808, 0.1554753949527016288, 0.3445473415315708499, 0.1450772192704306018, 0.1450772192704305463,  0.1658336656178109880, 0.3809290561832989752, 0.1646133235319788557, 0.1646133235319788279, 0.1774362201678598150,  0.4205881332338599066, 0.1858346074048432273, 0.1858346074048431995, 0.1899082289433333681, 0.4678716938627417443,  0.2111260537034579388, 0.2111260537034579110, 0.2045582772708172403, 0.5214745058633968311, 0.2397885695312690912,  0.2397885695312690912, 0.2210105524792665976, 0.5816098706683554553, 0.2719243960554488804, 0.2719243960554488804,  0.2393125890989960258, 0.6537036914529315013, 0.3104984222982312136, 0.3104984222982312136, 0.2610848294124529234,  0.7380428629117394834, 0.3556472659006939541, 0.3556472659006939541, 0.2863904657529356967 ))

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL ))

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) ))

  expect_equal(c(result_exp$n_iter),
               c(131 ))

  expect_equal(c(result_exp$Q),
               c(0.09771736591399401, 0.05231684402165718, 0.05231684402165718, 0.02914800107904403 ))

  expect_equal(c(result_exp$Q_0),
               c(0.1, 0.0, 0.0, 0.1 ))

  expect_equal(c(result_exp$n_risk),
               c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18 ))

  expect_equal(c(result_exp$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30 ))

  expect_equal(c(result_exp$risk_set),
               c(NULL ))

  expect_equal(c(result_exp$data),
               c(NULL ))

  expect_equal(c(result_exp$order),
               c(1 ))

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$method),
               c("EKF" ))

  expect_equal(c(result_exp$model),
               c("exponential" ))

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE ))

  expect_equal(c(result_exp$LR),
               c(1 ))
})

test_that("exponential model and logit moels hazzard functions differs", {
  expect_true(result_exp$model != result$model)
  expect_true(toString(body(result_exp$hazard_func)) !=
                toString(body(result$hazard_func)))
  expect_true(toString(body(result_exp$hazard_first_deriv)) !=
                toString(body(result$hazard_first_deriv)))
})

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result_exp$state_vecs), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result_exp$state_vars)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result_exp$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result_exp$Q_0)), rep(c("(Intercept)", "group1"), 2))
})


# Change by argument
suppressMessages(result_exp <- ddhazard(
  formula = survival::Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 2, Q_0 = diag(1, 2),
  Q = diag(1e-1, 2),
  control = list(est_Q_0 = F, n_max = 10^4, eps = 10^-3,
                 save_data = F, save_risk_set = F),
  max_T = 30,
  id = head_neck_cancer$id, order = 1,
  verbose = F,
  model = "exponential"
))

# matplot(result_exp$state_vecs, type = "l")
# plot(result_exp, cov_index = 1)
# get_expect_equal(result_exp, file = "tmp.txt")

test_that("Result of exponential model on head_neck_data match previous results with altered by argument", {
  expect_equal(c(result_exp$state_vecs),
               c(-3.62590778015360149, -3.62759233807803749, -2.17274432418045604, -2.52748918870900185, -3.50841310750728086, -3.10885732680564297, -4.22783510072752833, -3.92709402211447101, -3.60740634797076432, -4.03838533153281265, -3.94779597187891307, -4.09975230479413533, -4.30301823898316194, -4.47732030079043586, -4.40010697814281926, -4.60711268550504194, -0.19906428996289194, -0.19974683135526766, 0.41288470455339110, -0.16595800017238271, -0.38538944216808591, 0.03865120162576074, -0.60302569407267925, -0.23476757298182288,  0.01097060070719717, -0.12384370427173708, -0.07065118588144031, -0.28277216760105339, -0.43131777210679623, -0.53638945504109037, -0.52693077530256238, -0.61833435589597507 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$state_vars),
               c( 0.495078710287348289, 0.052625226565770712, 0.052625226565770691, 0.422238903395292908,  0.216268590983880071, -0.065797526809314250, -0.065797526809314250, 0.280482647557779519,  0.251034011473738161, -0.032764743391070134, -0.032764743391070134, 0.245974145036597536,  0.101690380179573270, -0.086367589713501502, -0.086367589713501502, 0.123638104872990803,  0.111896153276473800, -0.043030645624127950, -0.043030645624127950, 0.196345098331425605,  0.253527667538671175, 0.005632905132764862, 0.005632905132764852, 0.296100159999138801,  0.174078290284672699, -0.080639820854725236, -0.080639820854725236, 0.265438498931471756,  0.430860804728976809, 0.048938669963499118, 0.048938669963499111, 0.460148870095407003,  0.451322794547896089, 0.034678274217342327, 0.034678274217342292, 0.530469995430644436,  0.314665834789930488, -0.078784184381391897, -0.078784184381391925, 0.511710932973043597,  0.491512880420218790, -0.033527987375808983, -0.033527987375809004, 0.642131311853453846,  0.518909336565227419, -0.080082639659700930, -0.080082639659700916, 0.718561853746172652,  0.609843035628635732, -0.064115661965608139, -0.064115661965608139, 0.874261245528871855,  0.748002209853769640, -0.034249070871664539, -0.034249070871664539, 1.059739279758823205,  0.950292987492558860, 0.016591238532214475, 0.016591238532214475, 1.273909731624657260,  1.144172283367287379, 0.049840700536810646, 0.049840700536810646, 1.484669784484485833 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$n_iter),
               c(9 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$Q),
               c(0.3730515618113955, 0.1458540771026942, 0.1458540771026942, 0.1859692601221431 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$Q_0),
               c(1, 0, 0, 1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$n_risk),
               c(96, 91, 78, 53, 46, 39, 36, 33, 30, 25, 23, 21, 20, 19, 18 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$times),
               c( 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$risk_set),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$data),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$order),
               c(1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$method),
               c("EKF" )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$model),
               c("exponential" )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$LR),
               c(0.4444444444444444 )
               , tolerance = 1e-05)
})

# for(s in sample.int(1e6, 100, replace = F)){
# print(s)
# set.seed(s)
set.seed(599479)

sims <- test_sim_func_exp(n_series = 1e3, n_vars = 10, t_0 = 0, t_max = 10,
                          x_range = 1, x_mean = 0, re_draw = T, beta_start = 0,
                          intercept_start = -5, sds = c(.1, rep(1, 10)))
# tmp_file <- file("exponential.log")
# sink(tmp_file)
suppressMessages(result_exp <- ddhazard(
  formula = survival::Surv(tstart, tstop, event) ~ . - id - tstart - tstop - event,
  data = sims$res,
  by = (by_ <- 1),
  Q_0 = diag(10, 11),
  Q = diag(1e-2, 11),
  control = list(est_Q_0 = F, eps = 10^-2, n_max = 10^3,
                 save_data = F, save_risk_set = F, ridge_eps = 1e-2),
  max_T = 10,
  id = sims$res$id, order = 1,
  verbose = F,
  model = "exponential"))
# sink()
# close(tmp_file)

matplot(seq_len(nrow(sims$betas)) - 1, sims$betas, type = "l", lty = 1)
matplot(result_exp$times, result_exp$state_vecs, result_exp$state_vecs, type = "l", lty = 2, add = T)
# get_expect_equal(result_exp, eps = 1e-2, file = "tmp.txt")

test_that("Result of exponential model on simulated data match previous results", {
  expect_equal(c(result_exp$state_vecs),
               c(-5.07872608596536868, -5.08272698899318698, -4.47821907152965704, -4.55711659033740712, -3.77355134524433256, -4.06807825761109143, -4.10233637256440531, -3.87028726351097907, -3.77189696736534241, -3.39327887972167952, -3.11298344129774485, 0.09832895506657863, 0.08842932643230686, 0.29293821545864146, -0.49228884010482354, -0.09673940655896374, -0.48033783898571170, -1.76590367362402367, -2.67008699805099470, -2.79245863709676234, -1.25779412552592929, -0.28060384121361703, -0.09913940754070860, -0.07977674960540226, -1.36580212286798619, -2.21469972485730260, -5.78920205300872404, -4.92230002770736164, -4.48536048630945938, -4.18407698657516303, -3.38972532689482176, -2.37049335529395044, -1.65821621720172718, 0.15342598673345686, 0.13645283848644685,  0.85432915108018448, 0.58680129783290158, 2.51301138246105715, 1.85892927253342677, 0.64552402279561893, -0.27394732555356277, -0.77638808078283583, -0.03120250244389102, 0.48466348259473513, -0.05178808930154528, -0.05940044397653893, 0.87836326669539344, 1.51977058802354259, 3.55876442978964835, 3.08054357976342441,  3.33356043908029953, 3.73382639556066476, 3.50461526289647995, 2.72754538353266529, 2.25630002041405708, -0.58108959502201640, -0.58277191049523291, -0.60686690368182949, -0.56800521751008359, -0.39796337672278692, -0.44211363125774072, -0.58245770348258530, -0.77513821636115332, -0.85907973207449029, -0.92964384040818093, -0.99120712465291105, -0.21763066984878715, -0.21553566881376884, -0.27580825845487167, -0.39941281984911814, -0.73137819680074501, -0.65895771117443425, -0.57468762932909567, -0.47384850766949382, -0.35855258028620235, -0.15143288203016259, 0.03413374976609035, 3.13096112531667448, 3.13248769595813137, 3.40206711242696791,  2.81263905651351465, 2.39143202120144904, 2.32378282764119826, 2.22581358929696904, 2.46317321262473055,  2.94775944515515231, 4.10813515657577888, 4.89574111910982701, 1.24552513638519002, 1.24117630766322740,  1.64268050123873199, 1.82780276850869416, 2.72629076516208890, 2.46570378761898601, 2.41536183653684056,  2.42803585115145593, 2.37863655466326884, 2.18694502637768329, 1.94584354703589413, 0.52431550182494813,  0.51088678813673405, 0.87284814976485792, 0.45129048067034738, 1.60774171501283436, 1.15634364127584544, -0.05107404044334063, -1.03919004001507997, -1.50655158107339116, -0.61519088244460485, 0.08390072235628476, -3.39046668036432841, -3.38623972718172617, -4.18641504303866530, -4.06227442141247863, -5.01330966600714678, -4.62892011892447020, -4.63264508121882557, -4.96183567267715908, -5.17367083474895040, -5.72790447863891572, -6.10806942236412276 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$state_vars),
               c( 1.947996460792680e-01, 1.006538878904288e-01, -2.224904531086914e-01, 1.749817309404552e-01, 1.775134858357247e-01, -1.121746047626193e-02, 3.848178716829885e-03, 9.673392043484362e-02, 6.096107358684216e-02, 1.058880006580275e-01, -1.795339557991456e-01, 1.006538878904288e-01, 9.614091985596644e-01, 1.909904520999474e-01, 6.379900803905373e-01, -3.576609862936822e-01, 3.834832503320491e-02, 3.542635107839503e-02, 3.500803257361436e-01, -6.393224756538578e-02,  6.938762050807364e-01, -1.081789123615612e-01, -2.224904531086912e-01, 1.909904520999472e-01, 1.895609490698387e+00, -6.792124524550022e-01, -1.042364726296933e+00, -9.933894748494240e-02, 2.185955672252405e-01, 5.112295371389645e-01, -4.573262118496514e-01, -3.032761163235430e-01, 2.433141767978794e-01, 1.749817309404552e-01, 6.379900803905374e-01, -6.792124524550025e-01, 9.035161872970772e-01, 1.790212360155597e-01, 8.000374759679423e-02, -6.886239147532340e-02,  3.807565334261310e-02, 1.436176608244936e-01, 7.286815674306885e-01, -1.880585713692722e-01, 1.775134858357246e-01, -3.576609862936823e-01, -1.042364726296933e+00, 1.790212360155596e-01, 8.021950154011517e-01, 1.741831762028856e-02, -1.024038974267314e-01, -2.612130042566878e-01, 2.816964779880219e-01, -5.849264849450232e-02, -2.281240187496364e-01, -1.121746047626194e-02, 3.834832503320484e-02, -9.933894748494250e-02, 8.000374759679427e-02, 1.741831762028852e-02,  8.198186010097608e-02, -1.997448145549525e-02, -5.451657932586830e-02, 2.541775300945849e-02, 6.548387279517778e-02,  2.917038095294602e-02, 3.848178716829887e-03, 3.542635107839503e-02, 2.185955672252405e-01, -6.886239147532343e-02, -1.024038974267314e-01, -1.997448145549525e-02, 9.643115254212908e-02, 1.023037323583601e-01, -5.897913111462962e-02, -2.403345889286568e-02, -1.552379524892951e-02, 9.673392043484344e-02, 3.500803257361436e-01, 5.112295371389648e-01,  3.807565334261317e-02, -2.612130042566878e-01, -5.451657932586828e-02, 1.023037323583601e-01, 5.240456672818343e-01, -9.053514686843282e-02, 1.099828676638576e-01, -2.160297203451227e-01, 6.096107358684220e-02, -6.393224756538575e-02, -4.573262118496516e-01, 1.436176608244936e-01, 2.816964779880219e-01, 2.541775300945850e-02, -5.897913111462966e-02, -9.053514686843278e-02, 2.135753011198407e-01, 2.349279704223147e-02, -1.039861433471812e-01, 1.058880006580275e-01,  6.938762050807366e-01, -3.032761163235429e-01, 7.286815674306887e-01, -5.849264849450238e-02, 6.548387279517776e-02, -2.403345889286569e-02, 1.099828676638576e-01, 2.349279704223149e-02, 7.675676940134792e-01, -9.726723475725110e-02, -1.795339557991455e-01, -1.081789123615611e-01, 2.433141767978795e-01, -1.880585713692722e-01, -2.281240187496364e-01,  2.917038095294601e-02, -1.552379524892955e-02, -2.160297203451229e-01, -1.039861433471813e-01, -9.726723475725120e-02,  3.992800933614848e-01, 4.776614918536282e-02, -9.859076279355122e-03, -1.945608644964762e-02, -6.470554762103287e-04,  2.577743364748444e-02, -1.257385956878306e-03, 2.854853237555523e-03, -1.349721781431024e-02, -6.528241793225614e-03, -6.711251766116699e-03, 5.378638026257265e-03, -9.859076279355145e-03, 3.190251259616833e-01, 1.091561424354665e-01,  1.621021926452313e-01, -1.546111096464488e-01, 2.054858790399572e-02, 9.747860720263929e-03, 8.199788758996979e-02, -3.237201156444531e-02, 1.908145128293041e-01, 1.816821787670688e-02, -1.945608644964762e-02, 1.091561424354665e-01,  5.310555113252464e-01, -1.277321726118375e-01, -2.639642749283430e-01, -2.973114618029122e-02, 6.491898035600342e-02,  1.951006156190433e-01, -1.125406614391958e-01, -3.675134984143790e-02, 1.218125583555536e-02, -6.470554762103356e-04,  1.621021926452313e-01, -1.277321726118376e-01, 2.568875149156002e-01, -5.557906010505168e-03, 3.212820708637149e-02, -1.958458057946682e-02, -2.705586065223760e-02, 1.639160870019063e-02, 1.929895689146358e-01, 1.053440438170054e-02,  2.577743364748444e-02, -1.546111096464489e-01, -2.639642749283429e-01, -5.557906010505098e-03, 2.592819595580137e-01,  1.510812432618663e-03, -2.603314851007480e-02, -1.014775916732638e-01, 6.734176173580936e-02, -6.079394707026277e-02, -3.634823016288587e-02, -1.257385956878312e-03, 2.054858790399564e-02, -2.973114618029124e-02, 3.212820708637150e-02,  1.510812432618622e-03, 6.284339097685687e-02, -6.798888610109646e-03, -1.617946763815565e-02, 1.225685589172330e-02,  2.609106402722532e-02, 1.092304031048160e-02, 2.854853237555523e-03, 9.747860720263929e-03, 6.491898035600344e-02, -1.958458057946681e-02, -2.603314851007477e-02, -6.798888610109646e-03, 6.602877807907237e-02, 3.415970963979637e-02, -2.233777627702219e-02, -3.233218578252443e-03, -8.452383641533417e-03, -1.349721781431046e-02, 8.199788758996972e-02,  1.951006156190435e-01, -2.705586065223752e-02, -1.014775916732638e-01, -1.617946763815564e-02, 3.415970963979637e-02,  2.005828142591097e-01, -3.341878020182382e-02, 5.004506923065380e-03, -5.268433168274088e-02, -6.528241793225559e-03, -3.237201156444525e-02, -1.125406614391959e-01, 1.639160870019061e-02, 6.734176173580927e-02, 1.225685589172332e-02, -2.233777627702224e-02, -3.341878020182384e-02, 1.077839358095787e-01, -2.156470394955288e-02, -1.749705833448877e-02, -6.711251766116685e-03, 1.908145128293041e-01, -3.675134984143787e-02, 1.929895689146359e-01, -6.079394707026284e-02,  2.609106402722530e-02, -3.233218578252457e-03, 5.004506923065394e-03, -2.156470394955284e-02, 2.601645502986117e-01,  2.132742254159579e-02, 5.378638026257265e-03, 1.816821787670696e-02, 1.218125583555547e-02, 1.053440438170059e-02, -3.634823016288579e-02, 1.092304031048158e-02, -8.452383641533459e-03, -5.268433168274107e-02, -1.749705833448884e-02,  2.132742254159568e-02, 1.381922110611515e-01, 4.541587568977776e-02, -7.916478849482184e-03, -3.267977356772404e-02,  4.990800042136131e-03, 3.266072030382207e-02, -5.551423798434638e-04, -2.402181542698195e-04, -1.392413023689398e-02, -2.097886201281499e-03, -2.787344990664770e-03, 9.315207586216845e-04, -7.916478849482204e-03, 2.762240847599179e-01,  8.673555317282468e-02, 1.424797461478947e-01, -1.292063783090094e-01, 1.612586803305378e-02, 7.788567619987224e-03,  7.047112712826434e-02, -2.743249924185427e-02, 1.664670958776922e-01, 1.404411081459333e-02, -3.267977356772403e-02,  8.673555317282472e-02, 4.946449221527687e-01, -1.317499029387821e-01, -2.549622475186046e-01, -2.262287875232748e-02,  5.999375590672641e-02, 1.605176751968333e-01, -1.074420364076972e-01, -4.600939325762538e-02, 3.176055571594261e-02,  4.990800042136111e-03, 1.424797461478948e-01, -1.317499029387821e-01, 2.326826867447472e-01, 1.029119935523503e-02,  2.564525162249013e-02, -2.030925145640895e-02, -2.308868175624201e-02, 1.977290808222393e-02, 1.724015198840753e-01,  1.077331606416342e-03, 3.266072030382204e-02, -1.292063783090095e-01, -2.549622475186045e-01, 1.029119935523511e-02,  2.445076965463702e-01, 9.709127864565154e-04, -2.607798777255044e-02, -8.458654945561903e-02, 6.677923404542177e-02, -4.286214077951560e-02, -4.511335937858822e-02, -5.551423798434534e-04, 1.612586803305374e-02, -2.262287875232750e-02,  2.564525162249012e-02, 9.709127864564945e-04, 5.388486648370028e-02, -5.274276421457631e-03, -1.313163537478839e-02,  9.718729361262959e-03, 2.082175025012991e-02,
                  9.460617116275064e-03, -2.402181542698265e-04, 7.788567619987197e-03,  5.999375590672643e-02, -2.030925145640894e-02, -2.607798777255045e-02, -5.274276421457638e-03, 5.765450107849757e-02,  2.790865205649986e-02, -2.026290800784354e-02, -5.216057243441446e-03, -3.752552600220491e-03, -1.392413023689398e-02,  7.047112712826419e-02, 1.605176751968334e-01, -2.308868175624190e-02, -8.458654945561901e-02, -1.313163537478839e-02,  2.790865205649989e-02, 1.709477891135769e-01, -2.842081963790814e-02, 5.330278160626777e-03, -4.539557646168527e-02, -2.097886201281443e-03, -2.743249924185421e-02, -1.074420364076972e-01, 1.977290808222384e-02, 6.677923404542180e-02,  9.718729361262959e-03, -2.026290800784357e-02, -2.842081963790818e-02, 9.514574229908812e-02, -1.331528344651297e-02, -2.005355524194229e-02, -2.787344990664742e-03, 1.664670958776921e-01, -4.600939325762536e-02, 1.724015198840753e-01, -4.286214077951568e-02, 2.082175025012990e-02, -5.216057243441443e-03, 5.330278160626784e-03, -1.331528344651293e-02,  2.268212299788816e-01, 1.297317043206007e-02, 9.315207586217955e-04, 1.404411081459343e-02, 3.176055571594259e-02,  1.077331606416432e-03, -4.511335937858806e-02, 9.460617116275053e-03, -3.752552600220505e-03, -4.539557646168524e-02, -2.005355524194238e-02, 1.297317043206002e-02, 1.294590169416141e-01, 2.916131544811300e-02, -5.929415964629267e-03,  2.095746663323532e-03, -9.003173417279638e-03, 6.897121161055423e-03, -2.876797575800671e-04, 3.300588875816995e-03, -1.362685330045271e-02, -1.153264020571854e-02, -8.294443171563526e-03, 1.485886327408778e-02, -5.929415964629292e-03,  1.622765217893624e-01, 3.564063743019548e-02, 7.489763462844770e-02, -6.244377621311301e-02, 6.945989623264374e-03,  2.418791711016980e-03, 3.513815446506709e-02, -9.774128528630452e-03, 8.448252652388752e-02, 6.239604543667452e-03,  2.095746663323541e-03, 3.564063743019550e-02, 2.275850174346325e-01, -5.404201943285543e-02, -9.549849144273023e-02, -1.112128886263418e-02, 2.936824414129576e-02, 8.413658466982857e-02, -4.125868950968876e-02, -2.030254225464612e-02, -9.864593970273401e-04, -9.003173417279610e-03, 7.489763462844776e-02, -5.404201943285546e-02, 1.303725734557836e-01, -5.974332107795965e-03, 1.256330499641679e-02, -1.157968131253749e-02, -1.725591638594654e-02, 6.125229335074641e-03,  8.618993516331101e-02, 9.242917648844405e-03, 6.897121161055430e-03, -6.244377621311308e-02, -9.549849144273018e-02, -5.974332107795916e-03, 1.220337003668194e-01, 1.406431521558536e-04, -8.530802344348257e-03, -3.970514792662581e-02,  2.344556169779140e-02, -2.439144167723560e-02, -1.459245208883014e-02, -2.876797575800741e-04, 6.945989623264358e-03, -1.112128886263420e-02, 1.256330499641678e-02, 1.406431521558302e-04, 4.468851434232055e-02, -3.614974610497763e-03, -9.090359298481603e-03, 6.821844572959796e-03, 9.196230763794186e-03, 7.330317636774962e-03, 3.300588875816995e-03,  2.418791711016973e-03, 2.936824414129579e-02, -1.157968131253747e-02, -8.530802344348229e-03, -3.614974610497771e-03,  4.778059448911232e-02, 1.817573901770486e-02, -1.148635373027702e-02, -3.303647350133069e-03, -6.260307442104280e-03, -1.362685330045274e-02, 3.513815446506700e-02, 8.413658466982862e-02, -1.725591638594645e-02, -3.970514792662573e-02, -9.090359298481598e-03, 1.817573901770487e-02, 1.194892675648856e-01, -1.308516384018019e-02, -7.562587598733406e-04, -3.597402418538213e-02, -1.153264020571848e-02, -9.774128528630398e-03, -4.125868950968875e-02, 6.125229335074586e-03,  2.344556169779143e-02, 6.821844572959810e-03, -1.148635373027704e-02, -1.308516384018019e-02, 6.627707360085083e-02, -9.342786131843826e-03, -6.648679901046086e-03, -8.294443171563519e-03, 8.448252652388737e-02, -2.030254225464605e-02,  8.618993516331111e-02, -2.439144167723559e-02, 9.196230763794154e-03, -3.303647350133061e-03, -7.562587598733406e-04, -9.342786131843814e-03, 1.315392026620609e-01, 1.048671931216865e-02, 1.485886327408772e-02, 6.239604543667494e-03, -9.864593970273401e-04, 9.242917648844447e-03, -1.459245208883011e-02, 7.330317636774962e-03, -6.260307442104283e-03, -3.597402418538216e-02, -6.648679901046149e-03, 1.048671931216860e-02, 9.694071280696104e-02, 2.915510841369867e-02,  9.863273672870394e-03, 1.737035853703059e-02, -8.155131116281585e-04, -5.078608618326156e-03, -8.476938465910092e-04,  5.722505340451425e-03, 1.030154943947009e-03, -1.208533120517916e-02, 4.414435639029622e-04, 9.173100723787284e-03,  9.863273672870387e-03, 1.769504685771388e-01, 5.278648619003606e-02, 8.667053020838843e-02, -7.062343902539452e-02,  4.083847844199718e-03, 8.731763335488059e-03, 5.658973366501200e-02, -1.528612610537850e-02, 9.915133123622034e-02, -9.845611527521642e-03, 1.737035853703060e-02, 5.278648619003608e-02, 2.616207111573915e-01, -5.680924139090170e-02, -1.103511772482419e-01, -1.845866491351776e-02, 3.482453519497142e-02, 1.041920371429850e-01, -5.216637575052926e-02, -2.274471617311700e-02, -1.153297456688800e-02, -8.155131116281342e-04, 8.667053020838844e-02, -5.680924139090165e-02,  1.363340980813926e-01, -5.688281014623426e-03, 1.366355336209960e-02, -8.968534591144346e-03, -5.744065932312538e-03,  7.757510675202850e-03, 9.845761530438604e-02, -1.464204541516110e-03, -5.078608618326139e-03, -7.062343902539456e-02, -1.103511772482419e-01, -5.688281014623400e-03, 1.196380297910419e-01, 4.211363147815162e-03, -1.250053807425504e-02, -5.080924385656380e-02, 2.996931536297901e-02, -2.528391644166989e-02, -4.628126957365086e-03, -8.476938465910161e-04,  4.083847844199704e-03, -1.845866491351777e-02, 1.366355336209959e-02, 4.211363147815140e-03, 3.979802138459598e-02, -4.179284216329342e-03, -1.236589785839315e-02, 7.087999165873665e-03, 1.027951107117152e-02, 7.250041580160474e-03,  5.722505340451428e-03, 8.731763335488054e-03, 3.482453519497144e-02, -8.968534591144332e-03, -1.250053807425504e-02, -4.179284216329349e-03, 4.325544686878793e-02, 2.208398474921369e-02, -1.175053370541233e-02, -1.704118943820131e-03, -7.604991830851553e-03, 1.030154943947009e-03, 5.658973366501195e-02, 1.041920371429849e-01, -5.744065932312492e-03, -5.080924385656381e-02, -1.236589785839316e-02, 2.208398474921370e-02, 1.304999176767682e-01, -1.759232117452640e-02,  9.615638085725695e-03, -4.532350265684615e-02, -1.208533120517915e-02, -1.528612610537847e-02, -5.216637575052928e-02,  7.757510675202806e-03, 2.996931536297907e-02, 7.087999165873672e-03, -1.175053370541235e-02, -1.759232117452639e-02,  6.064158717889934e-02, -6.473975022139763e-03, -5.442479187205796e-03, 4.414435639029553e-04, 9.915133123622033e-02, -2.274471617311695e-02, 9.845761530438617e-02, -2.528391644166985e-02, 1.027951107117150e-02, -1.704118943820138e-03,  9.615638085725657e-03, -6.473975022139740e-03, 1.388624331640014e-01, 4.003977325208116e-04, 9.173100723787284e-03, -9.845611527521638e-03, -1.153297456688801e-02, -1.464204541516105e-03, -4.628126957365065e-03, 7.250041580160467e-03, -7.604991830851565e-03, -4.532350265684616e-02, -5.442479187205834e-03, 4.003977325207873e-04, 9.203294407850482e-02,  2.059585062207707e-02, 2.414473861172756e-03, 3.056984917633808e-02, -1.116465889900533e-02, -1.387769768177675e-02, -8.578475926878106e-04, 4.776371591143261e-03, -8.970260728317116e-04, -1.241549399879087e-02,
                  -8.118231303223648e-03,  1.561973706862997e-02, 2.414473861172747e-03, 6.263425408411924e-02, 9.925236782225016e-03, 1.750350290593276e-02, -1.668862760118341e-02, 8.832111106470721e-04, 3.376163343329839e-03, 9.373756917758443e-03, -3.385090991784640e-03,  2.075569120600253e-02, -7.391473099931629e-04, 3.056984917633808e-02, 9.925236782225066e-03, 1.117799208319561e-01, -2.123882050820617e-02, -3.122202088678844e-02, -5.275907815577805e-03, 1.474509986245957e-02, 2.452019326583954e-02, -2.109629650394977e-02, -1.485063714184732e-02, 7.690584380110249e-03, -1.116465889900530e-02, 1.750350290593275e-02, -2.123882050820611e-02, 5.585650952517116e-02, 1.675863480318495e-03, 4.614721078282275e-03, -3.800051169334189e-03, -4.316612904694823e-03, 3.884989039943813e-03, 2.683632001267790e-02, -4.990124112957350e-03, -1.387769768177675e-02, -1.668862760118344e-02, -3.122202088678844e-02, 1.675863480318538e-03, 5.817795558397708e-02, 9.100293866551664e-04, -4.281379864157074e-03, -6.391638493477612e-03, 1.332743713977281e-02, -2.516420484367603e-03, -8.545352771991289e-03, -8.578475926878117e-04, 8.832111106470589e-04, -5.275907815577813e-03, 4.614721078282279e-03, 9.100293866551494e-04,  3.250413484872455e-02, -1.371820055873442e-03, -4.781001835831885e-03, 3.378169255056386e-03, 3.702977308429434e-03,  2.899697583771327e-03, 4.776371591143264e-03, 3.376163343329839e-03, 1.474509986245958e-02, -3.800051169334191e-03, -4.281379864157080e-03, -1.371820055873443e-03, 3.478357792767890e-02, 7.590290625160303e-03, -6.567559590954778e-03, -6.365830418027627e-04, -4.499965748021029e-04, -8.970260728317081e-04, 9.373756917758387e-03, 2.452019326583958e-02, -4.316612904694782e-03, -6.391638493477572e-03, -4.781001835831888e-03, 7.590290625160300e-03, 6.537125984123543e-02,  5.858051650567729e-04, -3.724465411482544e-03, -2.237520533391391e-02, -1.241549399879086e-02, -3.385090991784616e-03, -2.109629650394978e-02, 3.884989039943784e-03, 1.332743713977279e-02, 3.378169255056386e-03, -6.567559590954794e-03,  5.858051650567617e-04, 4.598742864687834e-02, -2.621826029556346e-03, -1.020472987760974e-02, -8.118231303223651e-03,  2.075569120600257e-02, -1.485063714184730e-02, 2.683632001267787e-02, -2.516420484367569e-03, 3.702977308429432e-03, -6.365830418027737e-04, -3.724465411482589e-03, -2.621826029556312e-03, 6.138882660442036e-02, -2.380569258120593e-05,  1.561973706862998e-02, -7.391473099931609e-04, 7.690584380110284e-03, -4.990124112957378e-03, -8.545352771991291e-03,  2.899697583771331e-03, -4.499965748021193e-04, -2.237520533391394e-02, -1.020472987760976e-02, -2.380569258120073e-05,  6.981048730049502e-02, 2.463627407685796e-02, 9.405099247302037e-03, 3.808118577264658e-02, -9.211020160282236e-03, -1.551033362842426e-02, -2.316542138001418e-03, 5.933862025884433e-03, 8.413485684145121e-03, -1.244722809313040e-02, -6.101615289918852e-03, 8.129984675781170e-03, 9.405099247302021e-03, 1.074764723707951e-01, 3.772053199647793e-02,  4.155025480238153e-02, -4.175736528289767e-02, 2.827721107383142e-03, 3.625149454485042e-03, 3.139346439633814e-02, -9.619910493426231e-03, 5.103645516449964e-02, -5.931452547075098e-03, 3.808118577264658e-02, 3.772053199647796e-02,  1.633038928044040e-01, -2.694129443887470e-02, -5.611073595717973e-02, -8.467151854751923e-03, 2.295627229785794e-02,  5.876005447087978e-02, -2.973523837939215e-02, -9.116193739503318e-03, -1.152796754367310e-02, -9.211020160282210e-03,  4.155025480238147e-02, -2.694129443887467e-02, 7.792250563874585e-02, -6.359699927203396e-03, 8.342491421477100e-03, -7.685399380617823e-03, -3.839262801761913e-03, 3.640667928802683e-03, 4.935248762479269e-02, 4.733928228836193e-04, -1.551033362842427e-02, -4.175736528289768e-02, -5.611073595717973e-02, -6.359699927203343e-03, 7.679089898866051e-02, -4.005618378413456e-04, -6.698146293494504e-03, -2.090532332546218e-02, 1.856580625677334e-02, -1.740728871571235e-02, -4.843161520259485e-03, -2.316542138001422e-03, 2.827721107383126e-03, -8.467151854751940e-03, 8.342491421477104e-03, -4.005618378413495e-04, 3.283472599992149e-02, -2.303610262250743e-03, -8.084234634516123e-03, 3.304143126453176e-03,  7.403881414138423e-03, 6.721732432417960e-03, 5.933862025884432e-03, 3.625149454485047e-03, 2.295627229785792e-02, -7.685399380617824e-03, -6.698146293494525e-03, -2.303610262250741e-03, 3.514489591478989e-02, 1.202003785614975e-02, -7.310945393439119e-03, -3.214833097843872e-03, -3.823714689568449e-03, 8.413485684145149e-03, 3.139346439633810e-02,  5.876005447087982e-02, -3.839262801761887e-03, -2.090532332546220e-02, -8.084234634516125e-03, 1.202003785614974e-02,  9.094002821999791e-02, -4.285169137280142e-03, 1.996484951677865e-03, -3.892242721716995e-02, -1.244722809313038e-02, -9.619910493426226e-03, -2.973523837939215e-02, 3.640667928802700e-03, 1.856580625677333e-02, 3.304143126453175e-03, -7.310945393439126e-03, -4.285169137280144e-03, 4.584622384814465e-02, -5.140910955518811e-03, -7.689581250511883e-03, -6.101615289918866e-03, 5.103645516449968e-02, -9.116193739503333e-03, 4.935248762479260e-02, -1.740728871571234e-02,  7.403881414138425e-03, -3.214833097843875e-03, 1.996484951677852e-03, -5.140910955518795e-03, 8.517747927810299e-02,  4.503232390863189e-03, 8.129984675781167e-03, -5.931452547075109e-03, -1.152796754367308e-02, 4.733928228836158e-04, -4.843161520259483e-03, 6.721732432417963e-03, -3.823714689568456e-03, -3.892242721717000e-02, -7.689581250511881e-03,  4.503232390863252e-03, 7.936175355535764e-02, 2.507149855812582e-02, 1.421791362968356e-02, 3.319998680800504e-02, -2.709951923073640e-03, -1.674884960389012e-02, -5.301115279596690e-04, 6.108336683172011e-03, 6.413373570339971e-03, -1.288157211997375e-02, 1.070083262899305e-03, 9.423482245194459e-03, 1.421791362968354e-02, 1.002686979210702e-01,  2.120612227843072e-02, 4.332073906659888e-02, -3.218216587750572e-02, 4.117013832166330e-03, 3.359292711276672e-03,  1.871815554655922e-02, -7.444773058059225e-03, 4.973251146254078e-02, 4.375730936587094e-04, 3.319998680800504e-02,  2.120612227843071e-02, 1.463582737616592e-01, -3.117391967494091e-02, -4.597635710176762e-02, -9.522084587534311e-03,  1.784443539510782e-02, 4.615673530416377e-02, -2.707391344014232e-02, -1.425049853839065e-02, -7.671717719481923e-03, -2.709951923073634e-03, 4.332073906659890e-02, -3.117391967494095e-02, 8.075685164573720e-02, -4.381576043903563e-03,  9.780173442248880e-03, -4.921872992992394e-03, -6.431224088050034e-03, 4.289395276655803e-03, 5.004994354682127e-02,  3.287218383538984e-03, -1.674884960389011e-02, -3.218216587750571e-02, -4.597635710176764e-02, -4.381576043903530e-03,  6.930376762565035e-02, 1.059468133601241e-03, -4.706596093075528e-03, -1.518197134217063e-02, 1.567911117542494e-02, -1.289939420675715e-02, -5.705782808688112e-03, -5.301115279596747e-04, 4.117013832166320e-03, -9.522084587534323e-03,  9.780173442248878e-03, 1.059468133601236e-03, 3.327762625299904e-02, -2.071823678696639e-03, -7.109313266708916e-03,  4.142251705017478e-03, 7.670947428803067e-03, 5.362432975503536e-03, 6.108336683172005e-03, 3.359292711276674e-03,  1.784443539510782e-02, -4.921872992992395e-03, -4.706596093075541e-03, -2.071823678696638e-03, 3.478607853906523e-02,  1.058803047733213e-02,
                  -6.285183726928982e-03, -7.561684625962009e-04, -4.820442086224333e-03, 6.413373570339987e-03,  1.871815554655922e-02, 4.615673530416382e-02, -6.431224088050020e-03, -1.518197134217063e-02, -7.109313266708924e-03,  1.058803047733213e-02, 8.033440327955120e-02, -4.386657028076805e-03, -2.945089100443088e-04, -3.420558891771885e-02, -1.288157211997375e-02, -7.444773058059235e-03, -2.707391344014232e-02, 4.289395276655790e-03, 1.567911117542492e-02,  4.142251705017481e-03, -6.285183726928999e-03, -4.386657028076791e-03, 4.453497388449202e-02, -3.731008479022555e-03, -6.370315489851520e-03, 1.070083262899307e-03, 4.973251146254084e-02, -1.425049853839068e-02, 5.004994354682118e-02, -1.289939420675713e-02, 7.670947428803058e-03, -7.561684625962036e-04, -2.945089100443053e-04, -3.731008479022569e-03,  8.344398129003952e-02, 6.471549701205212e-03, 9.423482245194464e-03, 4.375730936587224e-04, -7.671717719481911e-03,  3.287218383538974e-03, -5.705782808688155e-03, 5.362432975503541e-03, -4.820442086224337e-03, -3.420558891771888e-02, -6.370315489851524e-03, 6.471549701205215e-03, 7.643556089089684e-02, 2.315583256205988e-02, 2.052515253425456e-02,  2.397027472831581e-02, 5.925181382039212e-03, -1.642620059028780e-02, 1.021802840421347e-03, 3.872108090627764e-03,  2.937718065271367e-03, -1.040954053050528e-02, 8.752990916877573e-03, 1.105709532770334e-02, 2.052515253425456e-02,  9.695182716618872e-02, 1.268993087930249e-02, 4.029058340670533e-02, -2.482087478330892e-02, 3.928004697257391e-03,  3.930355018320186e-03, 1.724574746941825e-02, -5.256275926445163e-03, 4.432486183747391e-02, 1.773861468268162e-04,  2.397027472831582e-02, 1.268993087930246e-02, 1.182102634225652e-01, -2.366843211873513e-02, -3.766728660490918e-02, -3.290503061085933e-03, 9.948520405308308e-03, 2.694822692206911e-02, -1.997665557445230e-02, -1.089272875760882e-02,  3.557145460010442e-03, 5.925181382039216e-03, 4.029058340670529e-02, -2.366843211873517e-02, 7.354680212389961e-02, -2.666246107282342e-03, 6.713741012279293e-03, -4.996300697585145e-04, 1.372910038436267e-04, 2.250511137851243e-03,  4.191391333988759e-02, -8.068216525855003e-04, -1.642620059028780e-02, -2.482087478330892e-02, -3.766728660490923e-02, -2.666246107282274e-03, 6.710035888291692e-02, -8.620249416438986e-04, -3.095939328844262e-03, -8.573833588935299e-03,  1.412426959038158e-02, -9.545939685677933e-03, -1.087047192960886e-02, 1.021802840421347e-03, 3.928004697257386e-03, -3.290503061085947e-03, 6.713741012279293e-03, -8.620249416439021e-04, 3.380806597607135e-02, -3.980539577969109e-04, -4.642040077619614e-03, 2.167599432021127e-03, 5.578480525871163e-03, 5.114652498547917e-03, 3.872108090627759e-03,  3.930355018320176e-03, 9.948520405308305e-03, -4.996300697585178e-04, -3.095939328844257e-03, -3.980539577969110e-04,  3.423014067931257e-02, 5.980897914483385e-03, -4.169093281653996e-03, 2.877954928350883e-03, -2.945062054333825e-03,  2.937718065271376e-03, 1.724574746941827e-02, 2.694822692206906e-02, 1.372910038436182e-04, -8.573833588935360e-03, -4.642040077619618e-03, 5.980897914483385e-03, 7.618031652923682e-02, 2.388423595703854e-03, 2.690372383650027e-03, -3.407871115924564e-02, -1.040954053050530e-02, -5.256275926445167e-03, -1.997665557445229e-02, 2.250511137851256e-03,  1.412426959038162e-02, 2.167599432021130e-03, -4.169093281654013e-03, 2.388423595703862e-03, 4.438192258896546e-02, -5.198197636848803e-03, -1.136621313976364e-02, 8.752990916877569e-03, 4.432486183747394e-02, -1.089272875760883e-02,  4.191391333988762e-02, -9.545939685677910e-03, 5.578480525871159e-03, 2.877954928350878e-03, 2.690372383650040e-03, -5.198197636848813e-03, 7.619172681805739e-02, 5.357571551481880e-03, 1.105709532770338e-02, 1.773861468268396e-04,  3.557145460010459e-03, -8.068216525855118e-04, -1.087047192960894e-02, 5.114652498547922e-03, -2.945062054333837e-03, -3.407871115924570e-02, -1.136621313976363e-02, 5.357571551481893e-03, 8.113829794566130e-02, 2.344217536802330e-02,  2.217505360251924e-02, 1.933914677043619e-02, 1.044468308092495e-02, -1.608803643637435e-02, 2.148086643070818e-03,  3.068731490151549e-03, -5.976562413195431e-04, -1.110302181872119e-02, 1.416263278408889e-02, 1.489890904872850e-02,  2.217505360251924e-02, 1.085181791599103e-01, 2.203029619860142e-02, 4.421607170510058e-02, -3.118428618692221e-02,  2.516198584153257e-03, 2.990488786206115e-03, 2.498955449051245e-02, -6.930277457239858e-03, 4.911803134707848e-02,  1.807428841732617e-03, 1.933914677043617e-02, 2.203029619860142e-02, 1.190409898776075e-01, -1.731555921422943e-02, -3.908528313377827e-02, -3.224172026797462e-03, 1.155206326248705e-02, 2.927469282293395e-02, -2.029085819575271e-02, -4.463222349005406e-03, 2.980928450791788e-03, 1.044468308092495e-02, 4.421607170510054e-02, -1.731555921422948e-02,  7.894063540926602e-02, -6.811601924140466e-03, 5.359179743613629e-03, -1.806038702276159e-03, 5.739116816215218e-03,  1.108159935501736e-03, 4.504026510163073e-02, -5.830487720013384e-05, -1.608803643637432e-02, -3.118428618692219e-02, -3.908528313377824e-02, -6.811601924140426e-03, 7.204672243250251e-02, -1.492649824423207e-04, -3.189914054322758e-03, -1.236782703119162e-02, 1.347018105005502e-02, -1.219085802715927e-02, -9.793284981383769e-03, 2.148086643070818e-03,  2.516198584153249e-03, -3.224172026797476e-03, 5.359179743613631e-03, -1.492649824423299e-04, 3.648214095512006e-02, -5.701908083633037e-04, -4.574303330603515e-03, 2.591797890112699e-03, 3.598098544194159e-03, 4.585840772327409e-03,  3.068731490151547e-03, 2.990488786206111e-03, 1.155206326248704e-02, -1.806038702276167e-03, -3.189914054322760e-03, -5.701908083633057e-04, 3.777870410662437e-02, 6.377120229017875e-03, -4.789491390713878e-03, 2.498951856647650e-03, -3.358033369491926e-03, -5.976562413195293e-04, 2.498955449051244e-02, 2.927469282293396e-02, 5.739116816215238e-03, -1.236782703119161e-02, -4.574303330603519e-03, 6.377120229017865e-03, 8.389926924662458e-02, 1.990226005113623e-03,  9.915287298125000e-03, -3.356833324798969e-02, -1.110302181872120e-02, -6.930277457239850e-03, -2.029085819575269e-02,  1.108159935501726e-03, 1.347018105005503e-02, 2.591797890112703e-03, -4.789491390713888e-03, 1.990226005113605e-03,  4.810187519981989e-02, -6.922014696907338e-03, -1.058025296618448e-02, 1.416263278408888e-02, 4.911803134707853e-02, -4.463222349005421e-03, 4.504026510163075e-02, -1.219085802715931e-02, 3.598098544194156e-03, 2.498951856647651e-03,  9.915287298125026e-03, -6.922014696907355e-03, 8.211251218058896e-02, 3.888302670222800e-03, 1.489890904872850e-02,  1.807428841732603e-03, 2.980928450791805e-03, -5.830487720007876e-05, -9.793284981383791e-03, 4.585840772327406e-03, -3.358033369491931e-03, -3.356833324798968e-02, -1.058025296618446e-02, 3.888302670222792e-03, 8.194848885564000e-02,  2.091731646891761e-02, 1.038525213377589e-02, 1.243606325033677e-02, 3.418459014905585e-03, -1.107402201800049e-02,  2.165964126720222e-03, 1.240872167211510e-03, -1.095553920507656e-02, -1.004280809592643e-02, 6.351618814768306e-03,  2.074600027338205e-02, 1.038525213377589e-02, 9.077841165704746e-02, 1.027214180214973e-02, 3.092494888548669e-02, -2.107561427685398e-02, 3.054818173397137e-03, -2.574505998782103e-03,
                  1.385861349271759e-02, -1.151701927809804e-03,  3.275405793066540e-02, 1.937918353018940e-03, 1.243606325033677e-02, 1.027214180214973e-02, 1.255444584852529e-01, -3.034498068737904e-02, -3.922106689267021e-02, -2.892051583756624e-03, 1.117443241051188e-02, 2.559237922401282e-02, -2.035007720867598e-02, -1.434420050950242e-02, 5.213926546803594e-03, 3.418459014905585e-03, 3.092494888548669e-02, -3.034498068737904e-02, 8.099506833085349e-02, 1.071539303141814e-03, 6.132646191119579e-03, -6.048689134751926e-03, -4.131060474209837e-03, 4.808727112410356e-03, 3.976911297430290e-02, 6.934274796726427e-04, -1.107402201800049e-02, -2.107561427685398e-02, -3.922106689267021e-02, 1.071539303141814e-03, 7.635179314768359e-02, -8.572588860098708e-04, -1.466194312313571e-03, -9.563783797862197e-03, 1.225135566130793e-02, -4.872906234463498e-03, -9.920405031825064e-03,  2.165964126720222e-03, 3.054818173397137e-03, -2.892051583756624e-03, 6.132646191119579e-03, -8.572588860098708e-04,  4.153437448541653e-02, -8.380325158228064e-04, -4.885344537955377e-03, 2.433695213688286e-03, 4.275588260015189e-03,  5.296176003724820e-03, 1.240872167211510e-03, -2.574505998782103e-03, 1.117443241051188e-02, -6.048689134751926e-03, -1.466194312313571e-03, -8.380325158228064e-04, 4.269636440940176e-02, 3.901003837489495e-03, -5.130095000966299e-03, -6.226364508819487e-04, -2.599459983664355e-03, -1.095553920507656e-02, 1.385861349271759e-02, 2.559237922401282e-02, -4.131060474209837e-03, -9.563783797862197e-03, -4.885344537955377e-03, 3.901003837489495e-03, 8.498835520148953e-02,  6.273864345683090e-03, -7.200386309267005e-04, -3.358382884597645e-02, -1.004280809592643e-02, -1.151701927809804e-03, -2.035007720867598e-02, 4.808727112410356e-03, 1.225135566130793e-02, 2.433695213688286e-03, -5.130095000966299e-03,  6.273864345683090e-03, 5.578086696904813e-02, -6.448679766086251e-03, -1.343881441913017e-02, 6.351618814768306e-03,  3.275405793066540e-02, -1.434420050950242e-02, 3.976911297430290e-02, -4.872906234463498e-03, 4.275588260015189e-03, -6.226364508819487e-04, -7.200386309267005e-04, -6.448679766086251e-03, 8.082054629417132e-02, 5.546495256122505e-03,  2.074600027338205e-02, 1.937918353018940e-03, 5.213926546803594e-03, 6.934274796726427e-04, -9.920405031825064e-03,  5.296176003724820e-03, -2.599459983664355e-03, -3.358382884597645e-02, -1.343881441913017e-02, 5.546495256122505e-03,  8.858761592720060e-02 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL )
               , tolerance = 0.01)

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) )
               , tolerance = 0.01)

  expect_equal(c(result_exp$n_iter),
               c(10 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$Q),
               c( 0.170774175745269374, 0.150601245426881192, -0.324411439259318701, 0.261310535974126901, 0.212502084268907404, -0.001182976527371735, -0.010389657982083290, 0.099007971300100819, 0.094983978103075795, 0.174758252120500557, -0.216664083930412893, 0.150601245426881192, 0.928275125179445437, 0.070594965324080675, 0.712115115254548847, -0.274281600040261753, 0.033720850171021707, 0.031953146249362824, 0.372905255726187268, -0.032040140332981450,  0.745412600799243874, -0.189591411756892259, -0.324411439259318701, 0.070594965324080675, 2.292785050164081184, -0.971372595071613665, -1.294483409880044178, -0.126641890728242223, 0.254291536552086472, 0.545447688280203957, -0.560527225642866167, -0.505308689053857618, 0.369159740943566961, 0.261310535974126901, 0.712115115254548847, -0.971372595071613665, 1.023911499066027186, 0.355073247570799055, 0.086050052388584042, -0.088464408027687805,  0.047589500949222797, 0.221358686523219966, 0.838654154522284201, -0.310018198159935698, 0.212502084268907404, -0.274281600040261753, -1.294483409880044178, 0.355073247570799055, 0.854499152624077718, 0.042468644652391072, -0.133521498502737035, -0.311227489311219574, 0.335318509535591613, 0.068725736841120447, -0.257899905112093430, -0.001182976527371735, 0.033720850171021707, -0.126641890728242223, 0.086050052388584042, 0.042468644652391072,  0.023624838919816250, -0.019213378078115177, -0.047755075807346350, 0.026572284816633970, 0.067000431509695452,  0.007880684854614295, -0.010389657982083290, 0.031953146249362824, 0.254291536552086472, -0.088464408027687805, -0.133521498502737035, -0.019213378078115177, 0.041661909603711911, 0.096690649350824498, -0.060612397704672048, -0.040064787711579369, 0.005156495699132680, 0.099007971300100819, 0.372905255726187268, 0.545447688280203957,  0.047589500949222797, -0.311227489311219574, -0.047755075807346350, 0.096690649350824498, 0.426880173675462271, -0.111253366696134573, 0.133491754049718248, -0.160159978793164626, 0.094983978103075795, -0.032040140332981450, -0.560527225642866167, 0.221358686523219966, 0.335318509535591613, 0.026572284816633970, -0.060612397704672048, -0.111253366696134573, 0.157130794994277234, 0.095932972757506535, -0.118251309692078754, 0.174758252120500557,  0.745412600799243874, -0.505308689053857618, 0.838654154522284201, 0.068725736841120447, 0.067000431509695452, -0.040064787711579369, 0.133491754049718248, 0.095932972757506535, 0.772445362062836871, -0.202786963224768246, -0.216664083930412893, -0.189591411756892259, 0.369159740943566961, -0.310018198159935698, -0.257899905112093430,  0.007880684854614295, 0.005156495699132680, -0.160159978793164626, -0.118251309692078754, -0.202786963224768246,  0.304165146762391925 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$Q_0),
               c(10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0,  0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0,  0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$n_risk),
               c(2041, 1968, 1876, 1813, 1684, 1539, 1448, 1262, 1189, 1042 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$risk_set),
               c(NULL )
               , tolerance = 0.01)

  expect_equal(c(result_exp$data),
               c(NULL )
               , tolerance = 0.01)

  expect_equal(c(result_exp$order),
               c(1 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 )
               , tolerance = 0.01)

  expect_equal(c(result_exp$method),
               c("EKF" )
               , tolerance = 0.01)

  expect_equal(c(result_exp$model),
               c("exponential" )
               , tolerance = 0.01)

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE )
               , tolerance = 0.01)

  expect_equal(c(result_exp$LR),
               c(0.1975308641975309 )
               , tolerance = 0.01)
})

test_that("Unmacthed control variable throw error",
          expect_error({
            result = ddhazard(
              formula = survival::Surv(start, stop, event) ~ group,
              data = head_neck_cancer,
              by = 1, # Use by month intervals
              a_0 = rep(0, 2), Q_0 = diag(1, 2), # Initial value
              max_T = 45,
              id = head_neck_cancer$id, order = 1,
              control = list("None_existing_parem" = 1)
            )}, regexp = "These control parameters are not recognized"))

#############
# Test ukf for exponential model
test_that("UKF and exp models give previous computed results with exponential estimation method",{
  suppressMessages(result_exp <- ddhazard(
    formula = survival::Surv(start, stop, event) ~ group,
    data = head_neck_cancer,
    by = 1,
    Q_0 = diag(1, 2),
    Q = diag(1e-1, 2),
    control = list(est_Q_0 = F, n_max = 10^4, eps = 10^-4,
                   method = "UKF", beta = 0, alpha = 1, save_risk_set = F,
                   save_data = F),
    max_T = 30,
    id = head_neck_cancer$id, order = 1,
    verbose = F,
    model = "exponential"))

  # plot(result_exp, cov_index = 1)
  # get_expect_equal(result_exp, file = "tmp.txt")

  expect_equal(c(result_exp$state_vecs),
               c(-3.69824910038536681, -3.69826065307419105, -3.26859707903190611, -2.95268233222984611, -2.77543499709954977, -2.30794811268055700, -2.42439356837259012, -2.81149408862572647, -2.96604835642004883, -3.07858919668809561, -3.20063414968332038, -3.41926978204197374, -3.52994455186449541, -3.55641905123767721, -3.37491862878595850, -3.44499480899945176, -3.58227233617389818, -3.68103585148111367, -3.63065354518771377, -3.71200873204608328, -3.67032845288164422, -3.81395837158664808, -3.99381412724516816, -4.11150917245706715, -4.16695822942270855, -4.28767616986713485, -4.36004225410994461, -4.38670995220066917, -4.49278911604918907, -4.56290234223730184, -4.59769109320577751, 0.11807985586911025, 0.11808530336174596, 0.27632089931661302, 0.39441596880613600,  0.44475387808013933, 0.62553592624579213, 0.58700138241384914, 0.44698311793234968, 0.41573489470184921,  0.38651047757107021, 0.35020473931936630, 0.27393947697249116, 0.24291147143516253, 0.24814219767729603,  0.32890209135425325, 0.30181476068198732, 0.24962479163596751, 0.21627433894170778, 0.23651753893562372,  0.20830070281157384, 0.22414450177235412, 0.16171554778759148, 0.09051806014666031, 0.04117246851472023,  0.01374834998307983, -0.03268537836081864, -0.06211552824670100, -0.07542661687135926, -0.11279018769181048, -0.13746377408854771, -0.14969203785384111 ))

  expect_equal(c(result_exp$state_vars),
               c( 0.2564700426806703071, 0.0193186468689041067, 0.0193186468689036800, 0.1460679280286585335, 0.1728246489568892597, -0.0103853264130547573, -0.0103853264130552569, 0.1245967614459552730, 0.1636068616711931767, -0.0111959308819632730, -0.0111959308819639114, 0.1157155704057426515, 0.1365216670876577831, -0.0195022107404757561, -0.0195022107404763667,  0.1040987073854811595, 0.1088375823506339268, -0.0295253088367425226, -0.0295253088367430361, 0.0922122755274398243,  0.0999342564870863564, -0.0282906762882705470, -0.0282906762882710328, 0.0878067097506801952, 0.0761398448221971558, -0.0355081971451097628, -0.0355081971451101652, 0.0807934996775148823, 0.0812534168716248228, -0.0315515210821908920, -0.0315515210821913500, 0.0824053001504273380, 0.0979061630803494398, -0.0233180542765690779, -0.0233180542765695636,  0.0887772943842919937, 0.1091170148401460760, -0.0190664945155813240, -0.0190664945155818374, 0.0944788549118243948,  0.1182914827457968998, -0.0162006846878412492, -0.0162006846878417522, 0.1005302060185183921, 0.1282544104358352977, -0.0131465079714294733, -0.0131465079714299625, 0.1075358609811898902, 0.1460849851380808251, -0.0071849005684081965, -0.0071849005684086944, 0.1164908309144385978, 0.1610515286206129770, -0.0029014446928423386, -0.0029014446928428174,  0.1250620445695320437, 0.1714332977747100861, -0.0009241896977249184, -0.0009241896977254145, 0.1328601799079411339,  0.1633019047119910749, -0.0065095597550550131, -0.0065095597550555214, 0.1376802972770761468, 0.1665792881782757751, -0.0079532327386078842, -0.0079532327386084081, 0.1446630721132587949, 0.1800091224566259807, -0.0054513004701847341, -0.0054513004701852476, 0.1539260354743817172, 0.1959445847411625530, -0.0021116460115749511, -0.0021116460115754680,  0.1640443628399728127, 0.2029690571334170079, -0.0024857963115429149, -0.0024857963115434596, 0.1729761367209960432,  0.2137256119087934947, -0.0015423366061816310, -0.0015423366061821930, 0.1828936731151880046, 0.2146132972968490260, -0.0045835080219415875, -0.0045835080219421738, 0.1915432375761303707, 0.2282835894504103291, -0.0030645417715430660, -0.0030645417715436454, 0.2025428104461669543, 0.2509516423207453495, 0.0020564607669640231, 0.0020564607669634610,  0.2156260536991032595, 0.2749757908163666942, 0.0075651377915518583, 0.0075651377915513171, 0.2292765668001862933,  0.2973751834460302002, 0.0121401558254466482, 0.0121401558254461209, 0.2428204459950295269, 0.3300729581246119038,  0.0201865451705297780, 0.0201865451705292437, 0.2579818829645606493, 0.3688951390670381913, 0.0302760385673999377,  0.0302760385673994034, 0.2741578304716998926, 0.4144867036031239516, 0.0424556108013083577, 0.0424556108013077957,  0.2912416011837608565, 0.4868508931419497920, 0.0640569472414180274, 0.0640569472414174584, 0.3120384092986653313,  0.5895922959581253453, 0.0961793387860182258, 0.0961793387860176568, 0.3368047533002774263 ))

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL ))

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) ))

  expect_equal(c(result_exp$n_iter),
               c(92 ))

  expect_equal(c(result_exp$Q),
               c(0.14161964589735906, 0.04550611673022104, 0.04550611673022104, 0.02948981054928508 ))

  expect_equal(c(result_exp$Q_0),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$n_risk),
               c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18 ))

  expect_equal(c(result_exp$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30 ))

  expect_equal(c(result_exp$risk_set),
               c(NULL ))

  expect_equal(c(result_exp$data),
               c(NULL ))

  expect_equal(c(result_exp$order),
               c(1 ))

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$method),
               c("UKF" ))

  expect_equal(c(result_exp$model),
               c("exponential" ))

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE ))

  expect_equal(c(result_exp$LR),
               c(1 ))




  set.seed(44334)
  sims <- test_sim_func_exp(n_series = 1e3, n_vars = 10, t_0 = 0, t_max = 10,
                            x_range = 1, x_mean = 0, re_draw = T, beta_start = 0,
                            intercept_start = -5, sds = c(.1, rep(1, 10)))
  # sum(sims$res$event)

  arg_list <- list(
    formula = survival::Surv(tstart, tstop, event) ~ . - id - tstart - tstop - event,
    data = sims$res,
    by = (by_ <- 1),
    Q_0 = diag(1, 11),
    Q = diag(1e-2, 11),
    control = list(est_Q_0 = F, n_max = 10^2, eps = 10^-2,
                   method = "UKF", beta = 0, save_risk_set = F,
                   save_data = F, alpha = 1),
    max_T = 10,
    id = sims$res$id, order = 1,
    model = "exponential")

  suppressWarnings(suppressMessages(fit <- do.call(ddhazard, arg_list)))

  # matplot(fit$state_vecs, lty = 2, type = "l", ylim = range(fit$state_vecs, sims$betas))
  # matplot(sims$betas, lty = 1, add = T, type = "l")
  # get_expect_equal(fit, eps = 1e-6, file = "tmp.txt")

  expect_equal(c(fit$state_vecs),
               c(-5.55596071795522750, -5.56994330281473271, -5.47689448436752269, -5.38793541512054119, -5.21429346433077257, -5.06707911210309891, -5.03707944211337111, -4.94352150162690318, -4.87185144619147437, -4.86554726374850777, -4.78894763492490494, 1.29999868485253467, 1.30307585289973016, 1.47774739447913062, 1.33884940920273410,  1.29707437066499454, 1.24904735969331737, 1.12087916547118005, 1.63410742259599084, 2.15868281733513578,  2.42562338875773031, 2.63219402999858909, 1.49272721176549950, 1.43732150945292103, 1.72574580636434649,  2.15842563026728129, 2.90562207503666059, 3.57025966532525452, 3.76575479011061898, 3.94747184486900915,  4.03901196640563853, 3.95270655282910433, 4.13522182208106681, -0.27885010346086636, -0.24963726399557681,  0.07534231340038378, -0.45691074923146047, -0.84266278212089285, -1.18094164598099649, -1.53395504619747669, -0.24637184968808046, 1.10284050170390602, 1.83803505477622275, 2.33426813385907694, 0.02078099042395620,  0.10490281129282830, 0.07327038873602221, -0.82862833912243894, -1.96976471657602792, -2.99134311646635531, -3.52306165646384040, -2.65833749262610253, -1.64506209976289530, -0.91795885637259400, -0.65939667597762130,  1.18860394548060389, 1.22984682609031171, 1.40323632764705253, 0.83364203354611432, 0.27811017192791843, -0.22178654491102698, -0.56703848145922586, 0.42682093645585750, 1.46078847592952110, 2.11292303913317392,  2.54619430283935211, -0.30754840690248714, -0.29237306830484600, 0.02962773282481754, -0.33245032016104681, -0.52944038582821307, -0.70471047175291368, -0.97018899884246079, 0.10156840797995847, 1.23920607011676243,  1.84101202188925206, 2.29811150793390384, -1.12993179598458360, -1.07887994235466800, -1.44561856197917216, -1.78091443275995243, -2.47421402057239881, -3.09494273063691816, -3.23934312525480594, -3.70636758094830343, -4.10009293033647904, -4.15587715343927488, -4.42952011092997733, -0.06459103533476443, -0.04401720840447931, -0.47211147149827803, -0.43925151731062023, -0.73156516235836899, -0.99448352804730078, -0.88495315379438499, -1.84733009153873340, -2.84393035292687912, -3.29287633230710197, -3.75086202746032482, 0.30714960728769941,  0.29294040939087085, 0.58292828629070526, 0.57293039644299237, 0.77612980457228653, 0.93658710064529993,  0.86677028650819965, 1.51850334264821307, 2.15767936167917096, 2.43755378789837707, 2.73838952830004523,  0.28554674147999470, 0.28776449657512970, 0.38399364275267411, 0.30432007178652010, 0.26776597527882151,  0.23986911746485004, 0.19099545575716717, 0.49895596751496624, 0.78111752069757578, 0.94152809289256278,  1.16196370779521274 )
               , tolerance = 1e-06)

  expect_equal(c(fit$state_vars),
               c( 5.428323918659683e-02, 6.828319106633629e-03, 3.562055678772259e-02, 7.867252268149756e-03, -3.953699535271971e-02, -1.400447441693450e-02, 1.256156463997895e-02, -3.632649937805758e-02, -3.281466285267567e-02, 2.228672048744447e-02,  7.372224908608878e-03, 6.828319106633301e-03, 9.965498388274285e-02, 2.027485247422458e-02, 7.374666550411850e-02,  4.050843487279526e-02, 4.840215970483507e-02, 6.183444775230796e-02, -3.662551383813264e-02, -6.217858636386067e-02,  4.521863079618784e-02, 1.112576847873031e-02, 3.562055678771938e-02, 2.027485247422460e-02, 2.391130965208168e-01, -8.620385190704965e-03, -1.535594143363059e-01, -4.287219639285533e-02, 2.070874405464775e-02, -1.409695427415606e-01, -9.944626168031730e-02, 6.774072318027202e-02, 1.759201599224404e-02, 7.867252268151041e-03, 7.374666550411793e-02, -8.620385190704898e-03, 2.691325534834618e-01, 1.544917981080607e-01, 1.423296487988132e-01, 1.506961892217125e-01, -3.818859316254582e-02, -1.155365383625339e-01, 7.751934222834458e-02, 3.607735330491409e-02, -3.953699535271872e-02,  4.050843487279588e-02, -1.535594143363061e-01, 1.544917981080606e-01, 3.948680070316337e-01, 1.714951849130901e-01,  1.020854665879710e-01, 1.261358897834986e-01, 6.468549727754451e-03, -8.004187750250382e-03, 1.875309386223769e-02, -1.400447441693874e-02, 4.840215970483466e-02, -4.287219639285505e-02, 1.423296487988133e-01, 1.714951849130902e-01,  2.529337911036064e-01, 1.152435278914924e-01, 1.660910239209631e-02, -6.458320670591815e-02, 3.993783237940832e-02,  4.585033002533691e-02, 1.256156463997769e-02, 6.183444775230812e-02, 2.070874405464773e-02, 1.506961892217126e-01,  1.020854665879714e-01, 1.152435278914918e-01, 2.280719455898476e-01, -5.107369132091402e-02, -1.152799248336780e-01,  7.285366940619832e-02, 3.458967360632654e-02, -3.632649937805540e-02, -3.662551383813349e-02, -1.409695427415599e-01, -3.818859316254560e-02, 1.261358897834988e-01, 1.660910239209602e-02, -5.107369132091400e-02, 2.696096362101996e-01,  1.234187259587724e-01, -8.227150577631705e-02, -1.641014809965517e-02, -3.281466285267579e-02, -6.217858636386046e-02, -9.944626168031695e-02, -1.155365383625339e-01, 6.468549727754417e-03, -6.458320670591805e-02, -1.152799248336783e-01,  1.234187259587723e-01, 2.611862021997762e-01, -9.852589086182106e-02, -3.049172285766424e-02, 2.228672048744487e-02,  4.521863079618853e-02, 6.774072318027226e-02, 7.751934222834425e-02, -8.004187750250573e-03, 3.993783237940863e-02,  7.285366940619868e-02, -8.227150577631774e-02, -9.852589086182106e-02, 1.740454641986210e-01, 2.128721158863927e-02,  7.372224908609572e-03, 1.112576847872982e-02, 1.759201599224437e-02, 3.607735330491448e-02, 1.875309386223752e-02,  4.585033002533717e-02, 3.458967360632630e-02, -1.641014809965440e-02, -3.049172285766418e-02, 2.128721158863884e-02,  1.364980431492050e-01, 4.799789819037709e-02, 5.441452227615710e-03, 3.544338256334856e-02, 5.903256245629858e-03, -4.216848550437481e-02, -1.648270878415659e-02, 1.093784362062969e-02, -3.694717409541864e-02, -3.206112979761090e-02,  2.165965488993177e-02, 6.185109241825424e-03, 5.441452227614531e-03, 1.013764853459888e-01, 1.921728422520904e-02,  9.028329843615308e-02, 5.787356845455780e-02, 6.708026778424259e-02, 7.975987589883135e-02, -4.041561625019539e-02, -7.667242309814384e-02, 5.369724980208937e-02, 1.701245039219794e-02, 3.544338256334417e-02, 1.921728422520927e-02,  2.471259890837695e-01, -1.478201344338423e-02, -1.766500994496679e-01, -5.582804828553284e-02, 1.753888965371743e-02, -1.570163765818481e-01, -1.065218563664263e-01, 7.288646569227457e-02, 1.588048348922941e-02, 5.903256245629502e-03,  9.028329843615233e-02, -1.478201344338419e-02, 2.951124270026151e-01, 1.968917863008016e-01, 1.834871069053798e-01,  1.876479122856238e-01, -4.021509821688596e-02, -1.428165323690476e-01, 9.398843953154976e-02, 4.758130693685855e-02, -4.216848550437403e-02, 5.787356845455814e-02, -1.766500994496683e-01, 1.968917863008015e-01, 4.574190656535225e-01,  2.252122395678915e-01, 1.424443203902462e-01, 1.413120411182909e-01, -1.197475874665821e-02, 2.321536158950926e-03,  2.992335659902632e-02, -1.648270878416205e-02, 6.708026778424209e-02, -5.582804828553306e-02, 1.834871069053802e-01,  2.252122395678924e-01, 2.917436509495464e-01, 1.559981479844745e-01, 1.909074942796399e-02, -9.133256685343344e-02,  5.595737559202858e-02, 5.412331709956784e-02, 1.093784362062678e-02, 7.975987589883135e-02, 1.753888965371708e-02,  1.876479122856239e-01, 1.424443203902468e-01, 1.559981479844738e-01, 2.612109613694222e-01, -5.799377664710675e-02, -1.454692405605157e-01, 9.204944499890885e-02, 4.573291934584014e-02, -3.694717409541483e-02, -4.041561625019647e-02, -1.570163765818471e-01, -4.021509821688590e-02, 1.413120411182906e-01, 1.909074942796304e-02, -5.799377664710720e-02,  2.836348408906617e-01, 1.401542168026184e-01, -9.339068108699461e-02, -1.877641863702911e-02, -3.206112979760906e-02, -7.667242309814375e-02, -1.065218563664258e-01, -1.428165323690477e-01, -1.197475874665863e-02, -9.133256685343367e-02, -1.454692405605164e-01, 1.401542168026181e-01, 2.844334950838674e-01, -1.180649239645828e-01, -4.024146019393968e-02,  2.165965488993100e-02, 5.369724980209028e-02, 7.288646569227508e-02, 9.398843953154973e-02, 2.321536158950773e-03,  5.595737559202918e-02, 9.204944499890977e-02, -9.339068108699575e-02, -1.180649239645832e-01, 1.802937468172428e-01,  2.716822867466095e-02, 6.185109241825580e-03, 1.701245039219735e-02, 1.588048348922960e-02, 4.758130693685876e-02,  2.992335659902617e-02, 5.412331709956800e-02, 4.573291934583976e-02, -1.877641863702813e-02, -4.024146019393938e-02,  2.716822867466026e-02, 1.296179270117577e-01, 4.036417484609059e-02, 3.011790801388393e-03, 2.877232859743313e-02,  3.728831451802854e-03, -3.812857391721963e-02, -1.709523415542760e-02, 8.103628285156858e-03, -3.068392949997178e-02, -2.656572389826149e-02, 1.776288968425226e-02, 4.389242817967175e-03, 3.011790801387224e-03, 9.492127879232448e-02,  1.614567486212890e-02, 8.782991824901268e-02, 6.038148379786979e-02, 6.835017863842018e-02, 7.931582118664195e-02, -3.760630583446757e-02, -7.536956560118532e-02, 5.228289734131707e-02, 1.760721450320955e-02, 2.877232859742878e-02,  1.614567486212910e-02, 2.316204196291864e-01, -1.736101075831219e-02, -1.712661690974228e-01, -5.740059709004307e-02,  1.435158829547043e-02, -1.490330804013401e-01, -9.974901978279503e-02, 6.810966765111537e-02, 1.299750412765511e-02,  3.728831451802452e-03, 8.782991824901180e-02, -1.736101075831215e-02, 2.765443537543624e-01, 1.943883580625409e-01,  1.796046747530529e-01, 1.814225498523945e-01, -3.529961802105821e-02, -1.377644686398671e-01, 9.072610067716398e-02,  4.706405969330638e-02, -3.812857391721892e-02, 6.038148379787005e-02, -1.712661690974230e-01, 1.943883580625407e-01,  4.500427653148210e-01, 2.266815197039402e-01, 1.440466100035826e-01, 1.375173081046702e-01, -1.611604926828770e-02,  5.368925027955734e-03, 3.163570299757492e-02, -1.709523415543307e-02, 6.835017863841970e-02, -5.740059709004319e-02,  1.796046747530536e-01, 2.266815197039414e-01, 2.847276312793682e-01, 1.558134296937111e-01, 2.039720975664346e-02, -9.200784193859284e-02, 5.631378885957406e-02,
                  5.157254516447842e-02, 8.103628285153940e-03, 7.931582118664195e-02,  1.435158829547019e-02, 1.814225498523949e-01, 1.440466100035833e-01, 1.558134296937102e-01, 2.537158043795482e-01, -5.471022417057865e-02, -1.430030353685322e-01, 9.088841240099471e-02, 4.535687887676954e-02, -3.068392949996798e-02, -3.760630583446863e-02, -1.490330804013389e-01, -3.529961802105827e-02, 1.375173081046698e-01, 2.039720975664253e-02, -5.471022417057904e-02, 2.713275261107813e-01, 1.347526847505134e-01, -8.945960725515190e-02, -1.702324915546247e-02, -2.656572389825965e-02, -7.536956560118512e-02, -9.974901978279450e-02, -1.377644686398674e-01, -1.611604926828821e-02, -9.200784193859284e-02, -1.430030353685328e-01, 1.347526847505132e-01, 2.739862121071220e-01, -1.156059437310415e-01, -4.006425259314273e-02, 1.776288968425151e-02, 5.228289734131796e-02, 6.810966765111597e-02, 9.072610067716395e-02,  5.368925027955533e-03, 5.631378885957438e-02, 9.088841240099550e-02, -8.945960725515308e-02, -1.156059437310419e-01,  1.726752863974074e-01, 2.679340199137069e-02, 4.389242817967331e-03, 1.760721450320896e-02, 1.299750412765531e-02,  4.706405969330669e-02, 3.163570299757483e-02, 5.157254516447854e-02, 4.535687887676918e-02, -1.702324915546150e-02, -4.006425259314243e-02, 2.679340199137004e-02, 1.199223378168219e-01, 3.206847580086782e-02, -1.548404229998322e-03,  1.518733028374152e-02, -8.919949541708015e-04, -2.859093671855872e-02, -1.759152971836864e-02, 2.000283128727050e-03, -1.638098754474370e-02, -1.435192846556775e-02, 9.253543706064998e-03, 1.785516695721505e-03, -1.548404229999460e-03,  7.531777287410363e-02, 8.257992345620002e-03, 5.609847875953178e-02, 4.199846067222682e-02, 4.538668894855559e-02,  5.233109938971870e-02, -2.287268323825339e-02, -4.962488663914665e-02, 3.483607886783503e-02, 1.060837589387442e-02,  1.518733028373708e-02, 8.257992345620170e-03, 1.853401523601706e-01, -1.946165169586594e-02, -1.314729964645545e-01, -4.905381776833138e-02, 6.842696566051639e-03, -1.081370477091877e-01, -7.111467081391823e-02, 4.824814214650125e-02,  8.480352930945125e-03, -8.919949541711450e-04, 5.609847875953054e-02, -1.946165169586596e-02, 1.916094119757109e-01,  1.308580087468096e-01, 1.161322659870077e-01, 1.157659109439662e-01, -1.518614183255382e-02, -8.450529022394553e-02,  5.611139152295759e-02, 2.971188999209162e-02, -2.859093671855793e-02, 4.199846067222684e-02, -1.314729964645549e-01,  1.308580087468092e-01, 3.507172262365826e-01, 1.639030094224727e-01, 9.685987567684812e-02, 1.116051673239599e-01, -8.412698240777353e-04, -3.324469189231580e-03, 2.016992928749079e-02, -1.759152971837407e-02, 4.538668894855494e-02, -4.905381776833154e-02, 1.161322659870086e-01, 1.639030094224743e-01, 2.224774356913670e-01, 1.043585904053795e-01,  2.524628138437109e-02, -5.675223493863209e-02, 3.354344985919725e-02, 3.483930965805750e-02, 2.000283128724160e-03,  5.233109938971854e-02, 6.842696566051423e-03, 1.157659109439667e-01, 9.685987567684907e-02, 1.043585904053786e-01,  1.931223323787202e-01, -3.288680931739516e-02, -9.450388266047402e-02, 5.964200042471774e-02, 2.983608536020855e-02, -1.638098754473984e-02, -2.287268323825440e-02, -1.081370477091866e-01, -1.518614183255406e-02, 1.116051673239592e-01,  2.524628138437007e-02, -3.288680931739561e-02, 2.209740278264548e-01, 9.480449802312788e-02, -6.217300914288462e-02, -9.443015843824492e-03, -1.435192846556592e-02, -4.962488663914626e-02, -7.111467081391779e-02, -8.450529022394612e-02, -8.412698240784638e-04, -5.675223493863202e-02, -9.450388266047466e-02, 9.480449802312760e-02, 2.134027569830098e-01, -7.971241612495389e-02, -2.655495146596925e-02, 9.253543706064252e-03, 3.483607886783575e-02, 4.824814214650192e-02,  5.611139152295756e-02, -3.324469189231769e-03, 3.354344985919741e-02, 5.964200042471846e-02, -6.217300914288579e-02, -7.971241612495410e-02, 1.431474877678496e-01, 1.768206182575079e-02, 1.785516695721677e-03, 1.060837589387375e-02,  8.480352930945335e-03, 2.971188999209195e-02, 2.016992928749074e-02, 3.483930965805760e-02, 2.983608536020816e-02, -9.443015843823507e-03, -2.655495146596897e-02, 1.768206182575013e-02, 1.063726446585493e-01, 2.803025384255298e-02, -8.793181275190409e-04, 1.073053463514007e-02, 3.468147486588202e-03, -2.039025292457087e-02, -1.259298537581270e-02,  4.404906123274793e-03, -1.272277861568344e-02, -1.372272645930150e-02, 8.366169789825562e-03, 1.924041089290991e-03, -8.793181275201685e-04, 6.923462302147906e-02, 6.886265846395858e-03, 5.478005122659609e-02, 4.250472780478729e-02,  4.569195439119639e-02, 5.120980245575694e-02, -2.143108509879223e-02, -4.755795324071779e-02, 3.303442896131664e-02,  1.060392302710838e-02, 1.073053463513563e-02, 6.886265846395976e-03, 1.755104860343868e-01, -1.927511541821129e-02, -1.249802106407780e-01, -4.735433966066568e-02, 5.893976476715667e-03, -1.022702627561686e-01, -6.713844453579332e-02,  4.473792294943070e-02, 7.174366361759527e-03, 3.468147486587830e-03, 5.478005122659500e-02, -1.927511541821151e-02,  1.857375802004353e-01, 1.294848294384809e-01, 1.152868053110318e-01, 1.143919338786248e-01, -1.529830643143281e-02, -8.239161149325464e-02, 5.504978754127321e-02, 2.927181593411540e-02, -2.039025292457014e-02, 4.250472780478758e-02, -1.249802106407786e-01, 1.294848294384801e-01, 3.365637924604047e-01, 1.596966069340465e-01, 9.633006627372055e-02,  1.037048717053566e-01, -3.629124894126274e-03, -2.323801159329932e-04, 1.979965610773287e-02, -1.259298537581816e-02,  4.569195439119596e-02, -4.735433966066588e-02, 1.152868053110326e-01, 1.596966069340480e-01, 2.137367956865923e-01,  1.034682866806209e-01, 2.233404631831018e-02, -5.693713027227676e-02, 3.413029546637233e-02, 3.164919120284454e-02,  4.404906123271889e-03, 5.120980245575688e-02, 5.893976476715398e-03, 1.143919338786250e-01, 9.633006627372138e-02,  1.034682866806199e-01, 1.866279405892745e-01, -3.203344469974207e-02, -9.110701781593702e-02, 5.797459844579871e-02,  2.870139432873263e-02, -1.272277861567967e-02, -2.143108509879322e-02, -1.022702627561676e-01, -1.529830643143320e-02,  1.037048717053558e-01, 2.233404631830921e-02, -3.203344469974258e-02, 2.099198643765041e-01, 9.033819507096091e-02, -5.824811004252133e-02, -8.661027244706011e-03, -1.372272645929969e-02, -4.755795324071752e-02, -6.713844453579296e-02, -8.239161149325533e-02, -3.629124894127086e-03, -5.693713027227672e-02, -9.110701781593773e-02, 9.033819507096065e-02,  2.020635423866806e-01, -7.564822871606018e-02, -2.575445359901398e-02, 8.366169789824832e-03, 3.303442896131743e-02,  4.473792294943149e-02, 5.504978754127322e-02, -2.323801159332291e-04, 3.413029546637247e-02, 5.797459844579950e-02, -5.824811004252258e-02, -7.564822871606039e-02, 1.352473629203306e-01, 1.694606321367134e-02, 1.924041089291161e-03,  1.060392302710772e-02, 7.174366361759761e-03, 2.927181593411562e-02, 1.979965610773274e-02, 3.164919120284458e-02,  2.870139432873220e-02, -8.661027244705020e-03, -2.575445359901362e-02, 1.694606321367065e-02, 9.779568467890826e-02,  2.379250550141343e-02, -1.150027786211014e-03, 2.335067441615480e-03, 6.450909229905735e-03, -8.778234329574298e-03, -7.384622626984689e-03, 5.030415473222489e-03, -4.444337612437186e-03, -8.999895718499427e-03,
                  4.466940852149900e-03,  1.857000029455910e-03, -1.150027786212229e-03, 5.875585055214633e-02, 6.083417068662601e-03, 4.278671858963570e-02,  3.358485112580163e-02, 3.645285124306060e-02, 4.044310059365233e-02, -1.758804888657369e-02, -3.817765766952677e-02,  2.625978071768810e-02, 8.531735647881875e-03, 2.335067441610973e-03, 6.083417068662877e-03, 1.496752126668880e-01, -1.142312187333393e-02, -9.384392979037129e-02, -3.363167131509268e-02, 8.850984928014061e-03, -8.050160173444555e-02, -5.562162844746796e-02, 3.485188080224673e-02, 7.304595837388780e-03, 6.450909229905167e-03, 4.278671858963475e-02, -1.142312187333472e-02, 1.567963328532487e-01, 9.957306640022003e-02, 9.030279902334540e-02, 9.182188141012325e-02, -1.667388487354323e-02, -6.854220279525831e-02, 4.595701254006827e-02, 2.444773066003875e-02, -8.778234329573744e-03,  3.358485112580170e-02, -9.384392979037248e-02, 9.957306640021833e-02, 2.719630280875677e-01, 1.220446481521309e-01,  7.359380362187697e-02, 7.757050371546155e-02, -4.664698771368517e-03, 3.161033473316185e-03, 1.422888901312352e-02, -7.384622626990333e-03, 3.645285124306015e-02, -3.363167131509319e-02, 9.030279902334587e-02, 1.220446481521326e-01,  1.801461351085511e-01, 8.224907723583333e-02, 1.346238806531214e-02, -4.869618761528287e-02, 2.946856751815838e-02,  2.409971968786763e-02, 5.030415473219432e-03, 4.044310059365236e-02, 8.850984928013481e-03, 9.182188141012342e-02,  7.359380362187830e-02, 8.224907723583244e-02, 1.613530811029753e-01, -2.918055673359446e-02, -7.501678428945992e-02,  4.754152788929795e-02, 2.359351994030717e-02, -4.444337612433463e-03, -1.758804888657487e-02, -8.050160173444484e-02, -1.667388487354404e-02, 7.757050371546061e-02, 1.346238806531095e-02, -2.918055673359528e-02, 1.824941348972613e-01,  7.408369439652630e-02, -4.502184079857958e-02, -7.844049957421150e-03, -8.999895718497535e-03, -3.817765766952670e-02, -5.562162844746762e-02, -6.854220279525947e-02, -4.664698771369751e-03, -4.869618761528316e-02, -7.501678428946103e-02,  7.408369439652593e-02, 1.764428138304692e-01, -6.061106246772131e-02, -2.261252625038358e-02, 4.466940852149105e-03,  2.625978071768899e-02, 3.485188080224760e-02, 4.595701254006845e-02, 3.161033473316146e-03, 2.946856751815868e-02,  4.754152788929893e-02, -4.502184079858080e-02, -6.061106246772150e-02, 1.198072826536249e-01, 1.452563338145894e-02,  1.857000029456023e-03, 8.531735647881246e-03, 7.304595837388933e-03, 2.444773066003899e-02, 1.422888901312354e-02,  2.409971968786774e-02, 2.359351994030676e-02, -7.844049957420064e-03, -2.261252625038315e-02, 1.452563338145821e-02,  8.909598925263865e-02, 2.101533190310689e-02, -1.138334620542587e-03, -4.177560084311614e-03, 8.732056145654095e-03,  1.461093900622113e-03, -2.545837772746731e-03, 5.341483434808109e-03, 2.693180938647776e-03, -4.382043417120176e-03,  1.492321346868445e-03, 1.807746713173752e-03, -1.138334620543940e-03, 4.864805022200422e-02, 5.110709062479370e-03,  3.138825659833371e-02, 2.571121843702391e-02, 2.708038228962917e-02, 2.988263425688566e-02, -1.336236737396834e-02, -2.890794487749887e-02, 1.997173777616028e-02, 6.435267352784119e-03, -4.177560084316266e-03, 5.110709062479661e-03,  1.294026074827695e-01, -6.922424810402849e-03, -6.653403714743510e-02, -2.105902226774943e-02, 9.401478897615247e-03, -6.064219496620974e-02, -4.256103110196145e-02, 2.595362203282254e-02, 6.900226529722359e-03, 8.732056145653169e-03,  3.138825659833315e-02, -6.922424810404299e-03, 1.375311351012076e-01, 7.947746880303352e-02, 7.033383799570435e-02,  7.493159025736516e-02, -1.624274846102531e-02, -5.806784636048026e-02, 3.913229340133340e-02, 2.123791975349211e-02,  1.461093900622386e-03, 2.571121843702431e-02, -6.653403714743683e-02, 7.947746880303105e-02, 2.151356222977870e-01,  8.779700806334682e-02, 5.778155681558834e-02, 5.114281552973651e-02, -1.227527344441899e-02, 9.003798743808938e-03,  1.081794786718009e-02, -2.545837772752707e-03, 2.708038228962883e-02, -2.105902226775038e-02, 7.033383799570425e-02,  8.779700806334849e-02, 1.485246179809321e-01, 6.414974019197672e-02, 4.329146405082952e-03, -4.345457663697533e-02,  2.644935364876264e-02, 1.791685893810505e-02, 5.341483434804727e-03, 2.988263425688596e-02, 9.401478897614344e-03,  7.493159025736543e-02, 5.778155681559014e-02, 6.414974019197626e-02, 1.400124838056145e-01, -2.437097853061022e-02, -6.046203435895912e-02, 3.849833121214443e-02, 1.950138668544300e-02, 2.693180938651443e-03, -1.336236737396968e-02, -6.064219496620961e-02, -1.624274846102672e-02, 5.114281552973565e-02, 4.329146405081428e-03, -2.437097853061142e-02,  1.548704108466773e-01, 5.496736392323182e-02, -3.193507802429082e-02, -6.341109250054811e-03, -4.382043417118096e-03, -2.890794487749906e-02, -4.256103110196126e-02, -5.806784636048162e-02, -1.227527344442030e-02, -4.345457663697601e-02, -6.046203435896038e-02, 5.496736392323118e-02, 1.507665700430140e-01, -4.632762440341543e-02, -1.966539421792585e-02,  1.492321346867542e-03, 1.997173777616132e-02, 2.595362203282361e-02, 3.913229340133378e-02, 9.003798743808892e-03,  2.644935364876318e-02, 3.849833121214553e-02, -3.193507802429200e-02, -4.632762440341573e-02, 1.066136390817806e-01,  1.254032637467094e-02, 1.807746713173771e-03, 6.435267352783596e-03, 6.900226529722434e-03, 2.123791975349244e-02,  1.081794786718030e-02, 1.791685893810532e-02, 1.950138668544263e-02, -6.341109250053607e-03, -1.966539421792540e-02,  1.254032637467020e-02, 8.168736323502687e-02, 2.060974508222378e-02, -2.290846198886847e-05, -6.637547026952505e-03,  1.173689773914268e-02, 7.982565990597131e-03, 9.470043064709202e-04, 7.066205823625500e-03, 6.159985366848272e-03, -3.679714051768366e-03, 1.006865992587409e-03, 1.160246182459149e-03, -2.290846199011747e-05, 4.227714787024963e-02,  3.449807081078541e-03, 2.529698051347544e-02, 2.203189550191487e-02, 2.250689524744676e-02, 2.481971234032501e-02, -1.057000085049651e-02, -2.296887091554520e-02, 1.589629825653492e-02, 5.128357224034333e-03, -6.637547026956568e-03,  3.449807081078293e-03, 1.188772295120567e-01, -7.528841651649455e-03, -5.186084423161388e-02, -1.719073785357055e-02,  7.050595566273771e-03, -4.615127105179175e-02, -3.317263801685223e-02, 1.923915278948841e-02, 2.127619966788486e-03,  1.173689773914181e-02, 2.529698051347578e-02, -7.528841651649865e-03, 1.309521650280075e-01, 7.150684649468647e-02,  6.275388468881671e-02, 6.949613840041582e-02, -1.649505341120486e-02, -5.133564285750819e-02, 3.470452470399710e-02,  2.090167989629882e-02, 7.982565990596914e-03, 2.203189550191634e-02, -5.186084423161383e-02, 7.150684649468432e-02,  1.800980631025815e-01, 7.087254848075678e-02, 5.245559040920825e-02, 3.000392424948638e-02, -1.761459831485154e-02,  1.361970162951274e-02, 1.411717481761710e-02, 9.470043064648626e-04, 2.250689524744722e-02, -1.719073785357019e-02,  6.275388468881665e-02, 7.087254848075805e-02, 1.337003011546112e-01, 5.729621030891822e-02, -1.683499061644384e-03, -3.934019430644706e-02, 2.424505410734291e-02, 1.626012735909505e-02, 7.066205823622188e-03, 2.481971234032578e-02,  7.050595566273690e-03, 6.949613840041545e-02, 5.245559040920938e-02, 5.729621030891720e-02, 1.313729634535650e-01, -2.125796894654926e-02,
                  -5.137015476927791e-02, 3.291062601621698e-02, 1.766832126355153e-02, 6.159985366851327e-03, -1.057000085049761e-02, -4.615127105179146e-02, -1.649505341120581e-02, 3.000392424948646e-02, -1.683499061645135e-03, -2.125796894655020e-02, 1.327304940447324e-01, 4.076722951478842e-02, -2.189845365328855e-02, -1.239491654328408e-03, -3.679714051766657e-03, -2.296887091554546e-02, -3.317263801685236e-02, -5.133564285750877e-02, -1.761459831485176e-02, -3.934019430644674e-02, -5.137015476927883e-02, 4.076722951478791e-02, 1.322160304023869e-01, -3.561321243857993e-02, -1.502383506231199e-02, 1.006865992586758e-03, 1.589629825653605e-02, 1.923915278948970e-02, 3.470452470399697e-02,  1.361970162951200e-02, 2.424505410734283e-02, 3.291062601621790e-02, -2.189845365328974e-02, -3.561321243858026e-02,  9.700371667822991e-02, 9.551863630964252e-03, 1.160246182459193e-03, 5.128357224033923e-03, 2.127619966788729e-03,  2.090167989629901e-02, 1.411717481761711e-02, 1.626012735909513e-02, 1.766832126355117e-02, -1.239491654327235e-03, -1.502383506231161e-02, 9.551863630963536e-03, 7.661859617647032e-02, 2.065983214100071e-02, -8.718113714007436e-04, -8.639318253181110e-03, 6.679350335606291e-03, 6.110882143818124e-03, -2.688545863770244e-03, 2.394736130713085e-03,  9.808063938386817e-03, 5.946193476487160e-04, -2.503844434679151e-03, -8.756445431861795e-04, -8.718113714021496e-04,  3.949111323163727e-02, 1.913261929544722e-05, 1.781573904448141e-02, 2.066331140755954e-02, 1.876328886960250e-02,  1.880439388106926e-02, -5.080984484728683e-03, -1.635065432655240e-02, 1.188224828751969e-02, 3.152258945592943e-03, -8.639318253185478e-03, 1.913261929538694e-05, 1.115869029984338e-01, -1.999813966283418e-02, -5.270371083547130e-02, -2.423593439768761e-02, -4.350396986855637e-03, -3.514616374852337e-02, -2.187683064978797e-02, 9.216828101972789e-03, -3.303704542306914e-03, 6.679350335605153e-03, 1.781573904448230e-02, -1.999813966283510e-02, 1.086112216817587e-01,  6.735277273282560e-02, 4.863857157785137e-02, 4.850427775533299e-02, 2.765251073158592e-03, -2.635552697406059e-02,  1.981217602821696e-02, 1.451336238526825e-02, 6.110882143817909e-03, 2.066331140756114e-02, -5.270371083547185e-02,  6.735277273282261e-02, 1.744107998841834e-01, 6.575479022961761e-02, 4.763832845468190e-02, 3.228265588851602e-02, -1.072983383953302e-02, 1.345133663755599e-02, 1.425505190594880e-02, -2.688545863776455e-03, 1.876328886960327e-02, -2.423593439768770e-02, 4.863857157785090e-02, 6.575479022961926e-02, 1.227626600660603e-01, 4.320505994859815e-02,  9.796434963026641e-03, -2.295427150840091e-02, 1.565461595628198e-02, 1.185900139061946e-02, 2.394736130709540e-03,  1.880439388107051e-02, -4.350396986855902e-03, 4.850427775533267e-02, 4.763832845468349e-02, 4.320505994859734e-02,  1.109008626027499e-01, -3.301817792564440e-03, -2.810337721866652e-02, 1.886135556225788e-02, 1.075349843303573e-02,  9.808063938390146e-03, -5.080984484729980e-03, -3.514616374852307e-02, 2.765251073157380e-03, 3.228265588851568e-02,  9.796434963025628e-03, -3.301817792565367e-03, 1.161346443305122e-01, 2.155720905160667e-02, -6.984253441661561e-03,  6.756882798605783e-03, 5.946193476507817e-04, -1.635065432655302e-02, -2.187683064978797e-02, -2.635552697406127e-02, -1.072983383953380e-02, -2.295427150840081e-02, -2.810337721866740e-02, 2.155720905160617e-02, 1.072061914809437e-01, -1.897226703794403e-02, -6.189268358314516e-03, -2.503844434680058e-03, 1.188224828752110e-02, 9.216828101973822e-03,  1.981217602821708e-02, 1.345133663755593e-02, 1.565461595628225e-02, 1.886135556225884e-02, -6.984253441662579e-03, -1.897226703794435e-02, 8.480874565414076e-02, 4.198366149124307e-03, -8.756445431862159e-04, 3.152258945592643e-03, -3.303704542306685e-03, 1.451336238526841e-02, 1.425505190594889e-02, 1.185900139061956e-02, 1.075349843303530e-02,  6.756882798606959e-03, -6.189268358314137e-03, 4.198366149123567e-03, 7.311809148390068e-02, 2.138453042851975e-02, -3.921476424153277e-03, -9.999328172476037e-03, -4.772304547439268e-03, -2.504440417633179e-03, -1.175390691247253e-02, -7.464982479540464e-03, 1.315972405710519e-02, 9.131500934633207e-03, -6.779974824439885e-03, -2.509896959282681e-03, -3.921476424154613e-03, 4.239743596031619e-02, -2.750575588236780e-03, 2.299519439846057e-02, 2.789329483672434e-02,  2.291306815946659e-02, 2.086688699106802e-02, -4.023321261654864e-03, -1.696460476585217e-02, 1.290062658146775e-02,  5.419399267423436e-03, -9.999328172480573e-03, -2.750575588237291e-03, 1.074823592034171e-01, -3.153589041435804e-02, -5.614631880289653e-02, -2.980013020433600e-02, -1.339344557825111e-02, -2.971417526304706e-02, -1.140104839531224e-02,  7.302783537961896e-03, -1.832918749942045e-03, -4.772304547440281e-03, 2.299519439846030e-02, -3.153589041435809e-02,  1.276711936611526e-01, 9.180536974728949e-02, 6.031791193553969e-02, 5.277734432908347e-02, 1.131783425479166e-02, -2.410008448315309e-02, 1.702187348965702e-02, 1.860771634443023e-02, -2.504440417633192e-03, 2.789329483672548e-02, -5.614631880289652e-02, 9.180536974728740e-02, 1.952156838798405e-01, 7.801756241461796e-02, 5.800468296401484e-02,  3.423329060652575e-02, -1.870787320818221e-02, 1.197061126274942e-02, 1.439013651494101e-02, -1.175390691247852e-02,  2.291306815946696e-02, -2.980013020433522e-02, 6.031791193554009e-02, 7.801756241461959e-02, 1.293313803699249e-01,  4.371680392086591e-02, 1.440795476269768e-02, -2.173859189166563e-02, 1.236969068354921e-02, 1.326164502511749e-02, -7.464982479543850e-03, 2.086688699106860e-02, -1.339344557825037e-02, 5.277734432908347e-02, 5.800468296401573e-02,  4.371680392086436e-02, 1.072718864231636e-01, 5.075156316693887e-03, -1.981428591960441e-02, 1.358127781395969e-02,  1.216589382535338e-02, 1.315972405710839e-02, -4.023321261655740e-03, -2.971417526304754e-02, 1.131783425479082e-02,  3.423329060652641e-02, 1.440795476269753e-02, 5.075156316693540e-03, 1.136094289167991e-01, 1.157055047011840e-02, -5.804891352640396e-03, 4.686584769976056e-03, 9.131500934635120e-03, -1.696460476585218e-02, -1.140104839531330e-02, -2.410008448315402e-02, -1.870787320818221e-02, -2.173859189166481e-02, -1.981428591960514e-02, 1.157055047011821e-02,  9.670620415320116e-02, -1.390531647360911e-02, -8.365413822059103e-03, -6.779974824440711e-03, 1.290062658146876e-02,  7.302783537963558e-03, 1.702187348965749e-02, 1.197061126274909e-02, 1.236969068354918e-02, 1.358127781396067e-02, -5.804891352641556e-03, -1.390531647360945e-02, 8.482311303802527e-02, 6.183148733142592e-03, -2.509896959282687e-03,  5.419399267422928e-03, -1.832918749941573e-03, 1.860771634443055e-02, 1.439013651494096e-02, 1.326164502511748e-02,  1.216589382535302e-02, 4.686584769977124e-03, -8.365413822058777e-03, 6.183148733141857e-03, 7.597461971544209e-02,  2.456504826491050e-02, -5.520276351994414e-03, -7.851909450056350e-03, -1.303398396789118e-02, -1.213755065627969e-02, -1.888017320077412e-02, -1.379230639596984e-02, 1.396995566429146e-02, 1.392036888737180e-02, -1.000831559231787e-02, -3.995594050692027e-03, -5.520276351997786e-03, 5.032406658409677e-02, -2.306170883797538e-03, 3.330388708432208e-02,  3.530296522626319e-02, 3.104461234193429e-02, 2.894586069880514e-02,
                  -4.599595839864232e-03, -2.301876478254286e-02,  1.566980567894849e-02, 6.700830388263551e-03, -7.851909450060382e-03, -2.306170883791630e-03, 1.237481603361494e-01, -3.688046308761547e-02, -7.453985361413651e-02, -3.554027310198028e-02, -1.464661894043396e-02, -3.784962256958713e-02, -1.433725823843565e-02, 9.315843053762457e-03, -1.913345889563626e-03, -1.303398396789689e-02, 3.330388708432142e-02, -3.688046308763025e-02, 1.565904011342188e-01, 1.150249667518732e-01, 8.026228557193726e-02, 6.937278891946563e-02,  1.575242596462026e-02, -3.337875996498907e-02, 1.776321795522529e-02, 2.083433232912249e-02, -1.213755065628416e-02,  3.530296522625731e-02, -7.453985361414872e-02, 1.150249667518558e-01, 2.346588263716883e-01, 9.853791068009565e-02,  6.982497683373634e-02, 4.833777490400437e-02, -2.131146741387560e-02, 8.678216315978426e-03, 1.542638125350537e-02, -1.888017320078409e-02, 3.104461234193251e-02, -3.554027310199148e-02, 8.026228557193360e-02, 9.853791068010631e-02,  1.514397666611699e-01, 5.653393291434566e-02, 1.909005454137064e-02, -2.877702949106559e-02, 1.287329142838278e-02,  1.708798680239348e-02, -1.379230639597697e-02, 2.894586069880661e-02, -1.464661894044523e-02, 6.937278891946841e-02,  6.982497683375211e-02, 5.653393291434972e-02, 1.219142939418878e-01, 7.381422590613668e-03, -2.688704556369964e-02,  1.385910242470767e-02, 1.346091688138082e-02, 1.396995566429522e-02, -4.599595839871476e-03, -3.784962256958421e-02,  1.575242596460455e-02, 4.833777490398919e-02, 1.909005454135743e-02, 7.381422590601830e-03, 1.212556683191295e-01,  1.026647893413637e-02, -4.234636902812783e-03, 5.879477479045790e-03, 1.392036888737655e-02, -2.301876478254719e-02, -1.433725823842671e-02, -3.337875996500084e-02, -2.131146741389495e-02, -2.877702949107636e-02, -2.688704556370730e-02,  1.026647893412860e-02, 1.057874011368111e-01, -1.271288958074412e-02, -7.759681279506214e-03, -1.000831559232054e-02,  1.566980567895243e-02, 9.315843053757517e-03, 1.776321795523311e-02, 8.678216315991055e-03, 1.287329142839053e-02,  1.385910242471339e-02, -4.234636902808953e-03, -1.271288958074462e-02, 8.623901792893357e-02, 4.897086092398098e-03, -3.995594050693035e-03, 6.700830388263704e-03, -1.913345889566436e-03, 2.083433232912449e-02, 1.542638125351015e-02,  1.708798680239579e-02, 1.346091688138124e-02, 5.879477479049801e-03, -7.759681279504618e-03, 4.897086092396488e-03,  8.193496156512459e-02 )
               , tolerance = 1e-06)

  expect_equal(c(fit$lag_one_cov),
               c(NULL )
               , tolerance = 1e-06)

  expect_equal(c(fit$fixed_effects),
               c(numeric(0) )
               , tolerance = 1e-06)

  expect_equal(c(fit$n_iter),
               c(19 )
               , tolerance = 1e-06)

  expect_equal(c(fit$Q),
               c( 0.021964034863330231, 0.014316760756824767, 0.063024660014879968, 0.013023668264957084, -0.056719851171780536, -0.008490777919755974, 0.021369191311888087, -0.067589475849311742, -0.054532204665104111, 0.036582603561075740,  0.009200579263664372, 0.014316760756824767, 0.112920387233807512, 0.014478637176649899, 0.272105630469700654,  0.212612476001798389, 0.217670653577722251, 0.227224330663046037, -0.072706595536605578, -0.192733982560595762,  0.126813206830725778, 0.062175392561057870, 0.063024660014879968, 0.014478637176649899, 0.261076048419547180, -0.054786303790622472, -0.320579145543623045, -0.122873446348084975, -0.003733231353859226, -0.251093133003368718, -0.147834566043921367, 0.099585813186606489, 0.010470476160406878, 0.013023668264957084, 0.272105630469700654, -0.054786303790622472, 0.740342065104288460, 0.672372678076431862, 0.616919325106298100, 0.597349584500389330, -0.100021104852921816, -0.451400362536735988, 0.294351610995536805, 0.161641591961863146, -0.056719851171780536,  0.212612476001798389, -0.320579145543623045, 0.672372678076431862, 0.919920225998842489, 0.653101990260101184,  0.504799576492812485, 0.190354151045869113, -0.218346556732260361, 0.138845038868360665, 0.127009585206176057, -0.008490777919755974, 0.217670653577722251, -0.122873446348084975, 0.616919325106298100, 0.653101990260101184,  0.557537701435354305, 0.491129437482700770, -0.002018396264815337, -0.323280536519813588, 0.209919857780930252,  0.136025637605303812, 0.021369191311888087, 0.227224330663046037, -0.003733231353859226, 0.597349584500389330,  0.504799576492812485, 0.491129437482700770, 0.501134843458191481, -0.122914415519579184, -0.398684140576798962,  0.259715474910659716, 0.136409157060167596, -0.067589475849311742, -0.072706595536605578, -0.251093133003368718, -0.100021104852921816, 0.190354151045869113, -0.002018396264815337, -0.122914415519579184, 0.289533938530543045,  0.248817970149291690, -0.165659327227622166, -0.043572117926406570, -0.054532204665104111, -0.192733982560595762, -0.147834566043921367, -0.451400362536735988, -0.218346556732260361, -0.323280536519813588, -0.398684140576798962,  0.248817970149291690, 0.419800467487968731, -0.269806404487484663, -0.114541107670625836, 0.036582603561075740,  0.126813206830725778, 0.099585813186606489, 0.294351610995536805, 0.138845038868360665, 0.209919857780930252,  0.259715474910659716, -0.165659327227622166, -0.269806404487484663, 0.185217445917811918, 0.075259294377460179,  0.009200579263664372, 0.062175392561057870, 0.010470476160406878, 0.161641591961863146, 0.127009585206176057,  0.136025637605303812, 0.136409157060167596, -0.043572117926406570, -0.114541107670625836, 0.075259294377460179,  0.052043980638921440 )
               , tolerance = 1e-06)

  expect_equal(c(fit$Q_0),
               c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 )
               , tolerance = 1e-06)

  expect_equal(c(fit$n_risk),
               c(2012, 1938, 1929, 1935, 1824, 1832, 1789, 1707, 1600, 1507 )
               , tolerance = 1e-06)

  expect_equal(c(fit$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 )
               , tolerance = 1e-06)

  expect_equal(c(fit$risk_set),
               c(NULL )
               , tolerance = 1e-06)

  expect_equal(c(fit$data),
               c(NULL )
               , tolerance = 1e-06)

  expect_equal(c(fit$order),
               c(1 )
               , tolerance = 1e-06)

  expect_equal(c(fit$F_),
               c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 )
               , tolerance = 1e-06)

  expect_equal(c(fit$method),
               c("UKF" )
               , tolerance = 1e-06)

  expect_equal(c(fit$model),
               c("exponential" )
               , tolerance = 1e-06)

  expect_equal(c(fit$est_Q_0),
               c(FALSE )
               , tolerance = 1e-06)

  expect_equal(c(fit$LR),
               c(1 )
               , tolerance = 1e-06)
})


