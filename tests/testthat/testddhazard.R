library(survival)

test_that("The head_neck_cancer must be defined for the ddhazard tests",
          expect_true(exists("head_neck_cancer")))

# Test on data set that is one of Farhmiers papers
result = ddhazard(
  formula = Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 1, # Use by month intervals
  n_max = 10^4, eps = 10^-4,
  a_0 = rep(0, 2), Q_0 = diag(1, 2), # Initial value
  est_Q_0 = T,
  max_T = 45,
  id = head_neck_cancer$id, order_ = 1
)

test_that("Testing previous computed values vs. current on head and neck cancer set assuming that the previous is correct", {
  expect_equal(c(result$a_t_d_s),
               c(-3.5084644693000375, -3.5148844600373153, -3.1891314791814929, -2.8181185126716946, -2.5133150253138181, -2.0686431883814391, -2.1337664829927272, -2.5088816216986980, -2.7261252524003838, -2.8656346839715456, -3.0022690651419150, -3.2103909019454631, -3.3296886621454438, -3.3797024676574670, -3.2387762301797576, -3.2832268974011902, -3.4010378429506498, -3.4996364628495664, -3.4640927580381167, -3.5454306632739097, -3.5193437650355053, -3.6429455602328522, -3.8148529400485618, -3.9315760725295390, -3.9912270162929087, -4.1221212755199144, -4.2111505273306804, -4.2593181086540230, -4.3955501412991156, -4.5056360495292482, -4.5891834181979796, -4.6463491829253352, -4.6772452961075963, -4.6818100380470060, -4.6597979866888570, -4.6108005184078964, -4.5342715329240795, -4.4295511232451679, -4.4288880723551687, -4.5320293776581728, -4.6212298063525905, -4.6940739120459574, -4.7499759978712248, -4.7915369057959181, -4.8188789577153992, -4.8320508432930724, 0.4360755600018228, 0.4376620032308990,  0.4489331535887380, 0.4629877155198045, 0.4717967889720516, 0.4892432325019014, 0.4906015100905337, 0.4811672226212869, 0.4812410655726153, 0.4807008058089728,  0.4795022646846021, 0.4752694673136330, 0.4750540102025831, 0.4782488768524199, 0.4871715112202827, 0.4868843094919623, 0.4843562325887174, 0.4835935130835331,  0.4867226287750569, 0.4863614783282632, 0.4891031221907462, 0.4848002061937289, 0.4802281967614200, 0.4772168219924643, 0.4758176353352087, 0.4735558899381061,  0.4724962572592801, 0.4726240459881104, 0.4714467634180154, 0.4710489177360688, 0.4714390992094060, 0.4726106938155138, 0.4745588596923577, 0.4772841101671843,  0.4807925107278950, 0.4850950220887917, 0.4902067111479924, 0.4961460340659207, 0.4977474633246664, 0.4949782740709857, 0.4925889375015259, 0.4906451477362695,  0.4891628332671372, 0.4880589755764653, 0.4873303205106824, 0.4869755787235325 ))

  expect_equal(c(result$V_t_d_s),
               c( 0.0011007577913296656, -0.0001733451115550633, -0.0001733451115550633, 0.0004392322044566420, 0.0682991240249047060, 0.0003834452042018443,  0.0003834452042018442, 0.0029230271218272539, 0.0912395007549733350, -0.0003397914632747466, -0.0003397914632747466, 0.0052119615712443315,  0.0932049749695377378, -0.0016092541197089715, -0.0016092541197089711, 0.0073429567284740965, 0.0849686813506122934, -0.0030571106681653009, -0.0030571106681653005, 0.0093460739808944281, 0.0774928836229536178, -0.0044064881508436658, -0.0044064881508436658, 0.0112576788942480542,  0.0625786071371585012, -0.0058040178177705924, -0.0058040178177705924, 0.0131038581718835520, 0.0663037854506360463, -0.0066152078662832037, -0.0066152078662832037, 0.0149859903532218054, 0.0802636516361565355, -0.0072606054091964422, -0.0072606054091964422, 0.0169064138433351260,  0.0925945303565963995, -0.0077694160284284882, -0.0077694160284284891, 0.0188521666403896025, 0.1028653949187706279, -0.0082893243691400179, -0.0082893243691400196, 0.0208108298970566402, 0.1134521022635953669, -0.0087341231657698665, -0.0087341231657698665, 0.0227878464846351519,  0.1282127482321499812, -0.0091281359070864241, -0.0091281359070864224, 0.0247818173504978020, 0.1412262999503804406, -0.0096021138204995977, -0.0096021138204995960, 0.0267801536095240260, 0.1518039844431364749, -0.0100679733114127437, -0.0100679733114127437, 0.0287860644548110257,  0.1503781552817381462, -0.0107654864975719258, -0.0107654864975719258, 0.0307850681462566306, 0.1529892913432942814, -0.0114268209514253039, -0.0114268209514253039, 0.0328022104304094425, 0.1623989951758836869, -0.0119988254560485837, -0.0119988254560485837, 0.0348470071785677502,  0.1751405465177472420, -0.0124767948762201323, -0.0124767948762201323, 0.0369196593146410082, 0.1826262222670714253, -0.0130763410888457762, -0.0130763410888457762, 0.0390042849193854013, 0.1921213871302026865, -0.0136031573461606395, -0.0136031573461606395, 0.0411148217076838310,  0.1952137792451406062, -0.0142700820537257390, -0.0142700820537257390, 0.0432374522277687856, 0.2045009115946196943, -0.0150037228119862687, -0.0150037228119862670, 0.0453817496599724785, 0.2197992615605408318, -0.0156403530269492337, -0.0156403530269492302, 0.0475580384562985375,  0.2351742387248771660, -0.0163387197002041323, -0.0163387197002041323, 0.0497535112080704153, 0.2471786691448959739, -0.0171983898818672161, -0.0171983898818672196, 0.0519599789846230259, 0.2633406508519972045, -0.0179758501250396573, -0.0179758501250396607, 0.0541928396098181331,  0.2783570585162779554, -0.0187578421049752302, -0.0187578421049752336, 0.0564447233177911220, 0.2898617445280329274, -0.0196256986326030711, -0.0196256986326030711, 0.0587095922537396175, 0.3070089074201384216, -0.0202566671302706752, -0.0202566671302706752, 0.0610078966170546910,  0.3265517822464923947, -0.0207566923998554545, -0.0207566923998554545, 0.0633316746524540397, 0.3468613597848555496, -0.0211777326575118136, -0.0211777326575118136, 0.0656762424587988280, 0.3669330349624608245, -0.0215496836790728778, -0.0215496836790728778, 0.0680384930107222063,  0.3859999570458617635, -0.0218930814893318545, -0.0218930814893318545, 0.0704161786213701735, 0.4033580584084034970, -0.0222249753911356145, -0.0222249753911356145, 0.0728075543038044365, 0.4182756228156945255, -0.0225620115551172298, -0.0225620115551172298, 0.0752111771525787870,  0.4299395711487184468, -0.0229222709068044872, -0.0229222709068044872, 0.0776257813361121429, 0.4374185315654753881, -0.0233265169857653290, -0.0233265169857653290, 0.0800501930267311507, 0.4389396398028437285, -0.0237873509608388274, -0.0237873509608388274, 0.0824839842388029043,  0.4444370473634537966, -0.0241089985969926528, -0.0241089985969926528, 0.0849399776770060483, 0.4705099679725334716, -0.0239711015900734327, -0.0239711015900734327, 0.0874386019174675511, 0.5127677482774826156, -0.0234537793009185619, -0.0234537793009185619, 0.0899729190136854540,  0.5710035270105234817, -0.0225390051857156867, -0.0225390051857156867, 0.0925406272428825755, 0.6422966612793774566, -0.0213827332568293886, -0.0213827332568293886, 0.0951287192064125264, 0.7296350793987446126, -0.0198916154467032036, -0.0198916154467032036, 0.0977389611802057523,  0.8366982297826955906, -0.0179580979280018482, -0.0179580979280018482, 0.1003735699436583140 ))

  expect_equal(c(result$lag_one_cor),
               c( 0.0006319914823851234, -0.0001813450353835426, -0.0002126117899357636, 0.0004231047677557611, 0.0374926594959537965, -0.0005380017294018889, -0.0005485720017780360, 0.0027985731084827336, 0.0481658093802995874, -0.0016000013589881627, -0.0015949751696787691, 0.0050048137282718962,  0.0456878855983472026, -0.0029587363809467785, -0.0029189483751894322, 0.0070703673493283329, 0.0396604087798715019, -0.0043033008270456190, -0.0042589644753056816, 0.0090269214295090917, 0.0312294200116858406, -0.0056445383104769611, -0.0055052058435728288, 0.0109053718415916372,  0.0277604858121243067, -0.0066868592103896726, -0.0065493515470886115, 0.0127664150516888786, 0.0339237983194087267, -0.0074374459108181770, -0.0074140515313897131, 0.0146609784134950454, 0.0440622779829562689, -0.0081876860923845354, -0.0080158162771978795, 0.0165879425442369867,  0.0532613145041970354, -0.0087846810550449832, -0.0085842409359943670, 0.0185356890963747287, 0.0620030758351880484, -0.0093425048092310777, -0.0091025684196418474, 0.0204997891156617623, 0.0728513701255290580, -0.0097823345080032802, -0.0096128728534951753, 0.0224819052110776137,  0.0852163441699832769, -0.0102462632327539986, -0.0101088730406997656, 0.0244754314202132520, 0.0959330788853532263, -0.0107781511795978276, -0.0105860202161019556, 0.0264754322364910526, 0.1002061921916009707, -0.0114127390024465029, -0.0111391949292140822, 0.0284766937737128793,  0.1007636418466745787, -0.0120573912090688583, -0.0118570640836160000, 0.0304836792486671525, 0.1062366995263799574, -0.0126455551196479089, -0.0125325810037256995, 0.0325131894616143557, 0.1164479435890595910, -0.0131968007123752003, -0.0130824399573795571, 0.0345702739070011394,  0.1259739156939710947, -0.0137649784666452300, -0.0136274381705102868, 0.0366477215003125287, 0.1339397670426479281, -0.0143510749271825982, -0.0141996145156178810, 0.0387441154191005901, 0.1399397952275374390, -0.0149739632061277085, -0.0147895226744024933, 0.0408598614778161312,  0.1457693177465160805, -0.0155839512939056103, -0.0155955638120855878, 0.0429925035951635587, 0.1573951226983123508, -0.0162626012661845898, -0.0163227628857992857, 0.0451516935211992362, 0.1720884528462469087, -0.0169267713220890778, -0.0170279042024082637, 0.0473366336214868441,  0.1853207193021612631, -0.0176966192481461081, -0.0178397971217273306, 0.0495369101392598918, 0.1988822844190729910, -0.0185218493681163360, -0.0186795043672042492, 0.0517557651622434362, 0.2140265293846420891, -0.0193324169287155505, -0.0194536391053007109, 0.0539974391987324484,  0.2269743551126637005, -0.0201775348081844191, -0.0202760450098242243, 0.0562552827877792691, 0.2408827346519127055, -0.0209761004349988504, -0.0210013621236798051, 0.0585361402693362204, 0.2587873461391665963, -0.0215840832784766519, -0.0215509137876134238, 0.0608464935722820149,  0.2783108156512931197, -0.0220822328593056443, -0.0219982908028953338, 0.0631800531920647668, 0.2981521380750243311, -0.0225129962129074074, -0.0223819658897505894, 0.0655329263193361600, 0.3174279954979510876, -0.0229027366724126047, -0.0227258619326826256, 0.0679024304099249548,  0.3354014001863034333, -0.0232710946107934427, -0.0230480112171346438, 0.0702865626215162104, 0.3513521643906739600, -0.0236355450370131226, -0.0233647677843556098, 0.0726837231452698296, 0.3645059125021066215, -0.0240139196073090484, -0.0236931428694739724, 0.0750925529047788837,  0.3739890959881940757, -0.0244259932862989082, -0.0240522839920852098, 0.0775118285517998884, 0.3784535347735979438, -0.0249012435710693411, -0.0244462789870596130, 0.0799407418619832999, 0.3819151740934059180, -0.0253026050600785556, -0.0248317275156184590, 0.0823853873046871965,  0.3973498624532323387, -0.0253572058863496402, -0.0249807749061207209, 0.0848621500522364069, 0.4309121681052292541, -0.0250169074096886247, -0.0246995171538831222, 0.0873779395067437042, 0.4804161596009360879, -0.0243022568530614422, -0.0240233709749064703, 0.0899281997898045693,  0.5444877914482062486, -0.0232369005433537522, -0.0230542772574000854, 0.0925054925093105329, 0.6230475261289992739, -0.0218919395921305972, -0.0217917741796725788, 0.0951040211830674886, 0.7194167882990079033, -0.0201652844689610457, -0.0201377013624211842, 0.0977257666720493107 ))

  # expect_equal(c(result$n_iter),
  #              c(274 ))

  expect_equal(c(result$Q),
               c(0.129221898731263357, 0.002475034806031055, 0.002475034806031055, 0.002645631948634509 ))

  expect_equal(c(result$Q_0),
               c( 0.0011007577913296656, -0.0001733451115550633, -0.0001733451115550633, 0.0004392322044566420 ))

  expect_equal(c(result$n_risk),
               c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18, 18, 18, 18, 18, 18, 18, 17, 15, 14, 14, 14, 12, 12, 12, 11 ))

  expect_equal(c(result$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45 ))

  # expect_equal(c(result$hazard_func),
  #              c([[1]]function (eta) {    exp_ = exp(eta)    exp_/(1 + exp_)}<environment: 0x000000001fb07d38> ))
  #
  # expect_equal(c(result$hazard_first_deriv),
  #              c([[1]]function (beta, x_) {    exp_ = exp(beta %*% x_)    x_ * exp_/(exp_ + 1)^2}<environment: 0x000000001fb07d38> ))

  expect_equal(c(result$risk_set),
               c(NA ))

  expect_equal(c(result$order),
               c(1 ))

  expect_equal(c(result$F_),
               c(1, 0, 0, 1 ))
})

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result$a_t_d_s), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result$V_t_d_s)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result$Q_0)), rep(c("(Intercept)", "group1"), 2))
})

result_pois = ddhazard(
  formula = Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 1, # Use by month intervals
  n_max = 10^4, eps = 10^-4,
  a_0 = rep(0, 2), Q_0 = diag(1, 2), # Initial value
  est_Q_0 = T,
  max_T = 45,
  id = head_neck_cancer$id, order_ = 1,
  model = "poisson"
)

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result$a_t_d_s), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result$V_t_d_s)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result$Q_0)), rep(c("(Intercept)", "group1"), 2))
})

# get_expect_equal(result_pois)

test_that("Outcome of poisson model on head neck compares with previous outcome", {
  expect_equal(c(result_pois$a_t_d_s),
               c(-3.4890522626379998, -3.5007072466756193, -3.2116228167907512, -2.8717769657666690, -2.5768976142323732, -2.1851234646900837, -2.2437206792664068, -2.5654145163195308, -2.7730083116082231, -2.9092403794806847, -3.0408540663334667, -3.2300644985224070, -3.3444529822594271, -3.4005622553350294, -3.2941821965369997, -3.3351683210080076, -3.4399736588993521, -3.5316558505570934, -3.5103371705007356, -3.5884657360802215, -3.5772713648262888, -3.6880725594075350, -3.8429584879869716, -3.9509319641758944, -4.0102903591081542, -4.1322151643049807, -4.2181502632924346, -4.2690078389917776, -4.3964852349644481, -4.5011457326926685, -4.5826788567826160, -4.6412261615741901, -4.6769191061697448, -4.6897660406555364, -4.6796356710336457, -4.6462682247296918, -4.5892931134800214, -4.5082463591277442, -4.5115875712276079, -4.6004689987047982, -4.6766347246904614, -4.7387368073113842, -4.7864034819855723, -4.8218654633796527, -4.8452023060427258, -4.8564449865662764, 0.4341993785723879, 0.4360005946612393,  0.4301800841732181, 0.4243648497551314, 0.4168991909509389, 0.4107617640105296, 0.4150016806494599, 0.4244351967891167,  0.4350218187246536, 0.4413188817266143, 0.4468588026035059, 0.4530651692737111, 0.4585691811805287, 0.4637655032770999,  0.4649403427904812, 0.4666697496172403, 0.4699506806814651, 0.4739218398344968, 0.4749854528002537, 0.4785334924502592,  0.4797722107615082, 0.4818692952621369, 0.4860698892273680, 0.4890340765534138, 0.4907147656940617, 0.4950361023011731,  0.4984265158994560, 0.5009213292827085, 0.5064580717405138, 0.5114321010853724, 0.5158326200910381, 0.5196612727856703,  0.5229199482208722, 0.5256077231409289, 0.5277203489146302, 0.5292504813546834, 0.5301880946960811, 0.5305209000609390,  0.5319178672099123, 0.5343727469282861, 0.5364828310356913, 0.5382102906901317, 0.5395445330665753, 0.5405356653529001,  0.5411858431918912, 0.5414958861236239 ))

  expect_equal(c(result_pois$V_t_d_s),
               c( 0.0009994222542623109, -0.0002080071710844569, -0.0002080071710844569, 0.0003971647267207373, 0.0613195401293190334, -0.0029373567327140161, -0.0029373567327140157, 0.0025711426634560598, 0.0829418380844703929, -0.0046696511775727858, -0.0046696511775727850, 0.0045924829319856000, 0.0862601732852475711, -0.0058775868039099184, -0.0058775868039099184,  0.0064832360138902360, 0.0799018735042954786, -0.0067414464101860274, -0.0067414464101860274, 0.0082604404014443439,  0.0718747672275600741, -0.0075091120800606691, -0.0075091120800606691, 0.0099530160252984980, 0.0559492407144848020, -0.0079613280497317813, -0.0079613280497317813, 0.0115761397942494189, 0.0586047612910940707, -0.0088277428541308524, -0.0088277428541308524, 0.0132294113764268029, 0.0719545849467421450, -0.0100304345306710691, -0.0100304345306710674,  0.0149327409465657302, 0.0838816104217625924, -0.0110538112978089617, -0.0110538112978089617, 0.0166454619448376667,  0.0938181328234365952, -0.0119933152517901920, -0.0119933152517901920, 0.0183673938588366087, 0.1038876151425256050, -0.0128878652885442320, -0.0128878652885442320, 0.0201002783313952160, 0.1173326170163240256, -0.0139286284781946004, -0.0139286284781946004, 0.0218537888564654080, 0.1292986504237437773, -0.0149586782263282994, -0.0149586782263282994,  0.0236150906543945889, 0.1392532006555832202, -0.0158757545587764233, -0.0158757545587764233, 0.0253773578249945377,  0.1397886970747834745, -0.0164521399011348657, -0.0164521399011348657, 0.0271271499832323980, 0.1428051381351082560, -0.0171578680599350220, -0.0171578680599350220, 0.0288964532344219011, 0.1512381590650367924, -0.0180915552619329567, -0.0180915552619329567, 0.0306953049417220750, 0.1625865043184972214, -0.0191076826890029007, -0.0191076826890029007,  0.0325161167935385728, 0.1699614063943477582, -0.0199970799122596299, -0.0199970799122596299, 0.0343448170614137072,  0.1788252605549230934, -0.0209191668159131906, -0.0209191668159131906, 0.0361921421738600133, 0.1828043626875036631, -0.0216817302315976818, -0.0216817302315976818, 0.0380462446222551015, 0.1913821778094783599, -0.0227577246545027749, -0.0227577246545027749, 0.0399360035035540503, 0.2048701514520503419, -0.0240310111353989678, -0.0240310111353989678,  0.0418563598146056842, 0.2185340635473047854, -0.0253653337090336273, -0.0253653337090336238, 0.0437972219786250186,  0.2296570566945234371, -0.0266864494617970044, -0.0266864494617970009, 0.0457527520536694654, 0.2441346938325104077, -0.0281303539829766483, -0.0281303539829766414, 0.0477317613761740062, 0.2578005874908642081, -0.0295332464686318893, -0.0295332464686318824, 0.0497236399997248099, 0.2688738806599343389, -0.0308557136304472186, -0.0308557136304472117,  0.0517251567058799600, 0.2843911766212471881, -0.0322410178105733969, -0.0322410178105733899, 0.0537459285000561268,  0.3019427154255915347, -0.0336321096723655177, -0.0336321096723655108, 0.0557813738528872283, 0.3203024356745124979, -0.0349984777862976590, -0.0349984777862976520, 0.0578285435588666574, 0.3387333583055067709, -0.0363198684508548586, -0.0363198684508548517, 0.0598852764299804483, 0.3567068473921093386, -0.0375798625849827553, -0.0375798625849827483,  0.0619498403695430896, 0.3737731865033384615, -0.0387629917828460555, -0.0387629917828460485, 0.0640207539210577020,  0.3894950470706116663, -0.0398532920823596037, -0.0398532920823595899, 0.0660966861440739767, 0.4034093605939982896, -0.0408334887638756791, -0.0408334887638756652, 0.0681763944938002103, 0.4150027576441983612, -0.0416844718966717931, -0.0416844718966717792, 0.0702586828286973636, 0.4230827541820252335, -0.0423435837884342386, -0.0423435837884342317,  0.0723402165574415779, 0.4346985925267772277, -0.0430782962031706490, -0.0430782962031706421, 0.0744360526518385579,  0.4617895696482632872, -0.0443256491025322760, -0.0443256491025322691, 0.0765704034483568607, 0.5020692595524974822, -0.0459920835721058102, -0.0459920835721058102, 0.0787365712069094253, 0.5556964183242528721, -0.0480625329925433789, -0.0480625329925433789, 0.0809315518182273236, 0.6204116065475210329, -0.0505266086384308782, -0.0505266086384308782,  0.0831519162016868540, 0.6984708773625839529, -0.0534370741478038536, -0.0534370741478038536, 0.0853981838350031386,  0.7926077245870872812, -0.0568629798427651226, -0.0568629798427651226, 0.0876715214479361071 ))

  expect_equal(c(result_pois$lag_one_cor),
               c( 0.0005912103632506223, -0.0001926206757991367, -0.0002184577720105643, 0.0003846286676941192, 0.0347749581802480751, -0.0022768113279909010, -0.0022861365679154788, 0.0024767791804366358, 0.0456099254228852363, -0.0037172392191876218, -0.0037129401553446387, 0.0044305281258233426, 0.0444160657615864513, -0.0047773384540244455, -0.0047454258778205916,  0.0062633026115976815, 0.0386671274810335280, -0.0056274486169561825, -0.0055955257390183080, 0.0079971005913407993,  0.0292986275521119194, -0.0063333206323960157, -0.0062403761444927916, 0.0096544788741523453, 0.0250841171629590728, -0.0070639194267096044, -0.0069512933413129032, 0.0112900501085486209, 0.0306891834227549301, -0.0080123322601102602, -0.0079557751134083400, 0.0129631205468459069, 0.0405644227629994025, -0.0091212265069141370, -0.0089516734824252320,  0.0146673903298406814, 0.0496002350488911892, -0.0100680469347096332, -0.0098826203748588783, 0.0163819190946147483,  0.0581153598472834293, -0.0109654714791474102, -0.0107536281372502887, 0.0181070602739351813, 0.0683313297208555659, -0.0118658671486684374, -0.0117132846862909243, 0.0198479899740965741, 0.0797758230179642924, -0.0128552948667398168, -0.0127322788544112064, 0.0216036312350496029, 0.0898308425161218893, -0.0138286700178352120, -0.0136644469831956709,  0.0233641249522993089, 0.0947582137922274442, -0.0146034106212951133, -0.0143723672323789499, 0.0251194879913003676,  0.0964061303453414009, -0.0152119635882140697, -0.0150404290106493036, 0.0268782082818733829, 0.1016831591038309945, -0.0159840458370510211, -0.0158838316687479365, 0.0286611771386770173, 0.1108968612408586935, -0.0169400111655422791, -0.0168432648740244398, 0.0304698885803003604, 0.1197793515839066930, -0.0178896691855159259, -0.0177755090690511763,  0.0322938476820076176, 0.1274623397063431307, -0.0187875285548273832, -0.0186674481890039337, 0.0341310538200862781,  0.1336205848825634812, -0.0196354286625612350, -0.0194919617620475764, 0.0359812164656445332, 0.1395850811514801060, -0.0204675920102973218, -0.0204776676555489187, 0.0378523184262489001, 0.1501013086105097982, -0.0216047938382192169, -0.0216603341556823314, 0.0397564832164676654, 0.1631832423430402690, -0.0228763115835193126, -0.0229683419118247613,  0.0416863261924655462, 0.1752146859256631106, -0.0241764555517018018, -0.0243026018315468592, 0.0436339204575171488,  0.1876023461309676288, -0.0255395896549234641, -0.0256810577722440016, 0.0456005229787378452, 0.2013226026050914108, -0.0269672216623146541, -0.0270815026864531065, 0.0475854554662099652, 0.2134347521826087390, -0.0283326969067753745, -0.0284276744938508630, 0.0495817504630509734, 0.2263936938295106338, -0.0297047671015452132, -0.0297464494238893623,  0.0515924111687796477, 0.2425810161047356472, -0.0311069362982746012, -0.0311033858190965032, 0.0536200815252902002,  0.2602170484194964439, -0.0324984807678500576, -0.0324535747626720564, 0.0556610069097855931, 0.2783302912360753334, -0.0338554677883452018, -0.0337706778634423097, 0.0577126301485832160, 0.2962890915481474208, -0.0351603464334622126, -0.0350356193783285808, 0.0597729996399264385, 0.3136026848878008533, -0.0363976460042021097, -0.0362318918789523089,  0.0618405034709980650, 0.3298253536267834463, -0.0375519638457939425, -0.0373433463058494355, 0.0639137309371350798,  0.3445048573246239365, -0.0386069081566987049, -0.0383530258611097935, 0.0659913915875772888, 0.3571513373719589768, -0.0395444661931624586, -0.0392424704084855872, 0.0680722631311528603, 0.3669164478563881615, -0.0403340038626587502, -0.0399611375939828498, 0.0701540938544015918, 0.3766547033353667695, -0.0410329052391301755, -0.0406513916209923082,  0.0722426148148373054, 0.3956763430409968030, -0.0419750007423082619, -0.0416734592792002145, 0.0743572900722163921,  0.4288891146695905654, -0.0433926817525074685, -0.0431439418849365944, 0.0765070561163092855, 0.4752815044176779691, -0.0452279272964690171, -0.0450151325066935337, 0.0786870920193155493, 0.5339335007410548339, -0.0474437743838753909, -0.0473043052807085931, 0.0808942573117912567, 0.6047577082615165356, -0.0500836615132745425, -0.0500069858242957188,  0.0831270398013765760, 0.6902414749444462094, -0.0532069318852194453, -0.0531852266292224887, 0.0853862754725515788 ))

  expect_equal(c(result_pois$Q),
               c( 0.111862119579795666, -0.003962543183810913, -0.003962543183810913, 0.002286447933887747 ))

  expect_equal(c(result_pois$Q_0),
               c( 0.0009994222542623109, -0.0002080071710844569, -0.0002080071710844569, 0.0003971647267207373 ))

  expect_equal(c(result_pois$order),
               c(1 ))

  expect_equal(c(result_pois$F_),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_pois$method),
               c("EKF" ))

  expect_equal(c(result_pois$model),
               c("poisson" ))
})

test_that("poisson model and logit moels hazzard functions differs", {
  expect_true(result_pois$model != result$model)
  expect_true(toString(body(result_pois$hazard_func)) !=
                toString(body(result$hazard_func)))
  expect_true(toString(body(result_pois$hazard_first_deriv)) !=
                toString(body(result$hazard_first_deriv)))
})
