if(interactive()){
  library(survival); library(dynamichazard); library(testthat)
  source("./R/test_utils.R")
}

# Test on data set that is one of Farhmiers papers
result = ddhazard(
  formula = survival::Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 1, # Use by month intervals
  control = list(est_Q_0 = F, n_max = 10^4, eps = 10^-4,
                 save_data = F, save_risk_set = F),
  a_0 = rep(0, 2), Q_0 = diag(1, 2), # Initial value
  max_T = 45,
  id = head_neck_cancer$id, order = 1
)

# plot(result, cov_index = 2)
# get_expect_equal(result, file = "tmp.txt")

expect_equal(c(result$state_vecs),
             c(-3.5025281961134787, -3.5025877576033477, -3.1321088612085983, -2.7757440091832057, -2.4919226130185796, -2.0481629213672718, -2.1192831215763093, -2.5081974639847040, -2.7397385003032992, -2.8845741297267971, -3.0249425773489134, -3.2400528773087220, -3.3649953385374434, -3.4209971757442106, -3.2738906455544505, -3.3169512577607794, -3.4382520761838764, -3.5423227286382666, -3.5025280610662426, -3.5881855240853717, -3.5581765201478746, -3.6816191615343223, -3.8597566904517313, -3.9786676622646073, -4.0361038571766708, -4.1732583956028995, -4.2656563848289011, -4.3141579768727913, -4.4604842005904972, -4.5793523090954995, -4.6702239867590185, -4.7332575267101360, -4.7685792576318100, -4.7761302924183315, -4.7556545004572994, -4.7067217620380086, -4.6287569806218709, -4.5210666088772840, -4.5211246420955638, -4.6290434142170565, -4.7225212272260517, -4.7987715172838055, -4.8571588039855502, -4.9005507089961524, -4.9291008412739341, -4.9428800599987603, 0.4611869044292034, 0.4611973957569191, 0.4644812524045190, 0.4736355394554351,  0.4669827742862612, 0.4837779729722258, 0.4898265943380803, 0.4860728861187437, 0.5052218028384193,  0.5135282631906429, 0.5190721140735243, 0.5202520241841503, 0.5286518809011893, 0.5439737247040330,  0.5619043578043230, 0.5619249621124215, 0.5611736349659849, 0.5660506677350730, 0.5722505331289359,  0.5773467910015616, 0.5834634039203218, 0.5769074684671019, 0.5749777881080025, 0.5734079048915875,  0.5722037907454223, 0.5757739716021596, 0.5797523773232870, 0.5841753632079369, 0.5934274294860569,  0.6031478029556855, 0.6132990871420009, 0.6238518360306121, 0.6347839458711073, 0.6460791936890807,  0.6577259525203066, 0.6697161933542817, 0.6820447299834685, 0.6947086479136694, 0.7009643574480928,  0.7006518516294673, 0.7004158564901843, 0.7002594597824986, 0.7001824345106531, 0.7001175765838670,  0.7000642351810415, 0.7000221623978419 ))

expect_equal(c(result$state_vars),
             c( 0.24966773368218786, -0.04852029000361392, -0.04852029000361389, 0.10685530511125829,  0.16324645041995289, -0.05271757666862437, -0.05271757666862434, 0.09828781852130458,  0.15325430938443149, -0.05162795076841659, -0.05162795076841659, 0.09136058704366490,  0.13495516427714296, -0.04929835651868680, -0.04929835651868683, 0.08496667085337734,  0.11565049223272644, -0.04726320825775959, -0.04726320825775961, 0.07932121905215284,  0.10178753695006632, -0.04274365026883695, -0.04274365026883695, 0.07487249696497597,  0.08289059384724072, -0.03967528470467367, -0.03967528470467367, 0.07163527330767552,  0.08578092764648139, -0.03846953031547166, -0.03846953031547165, 0.07084598469140357,  0.09989891251830449, -0.03828003928875170, -0.03828003928875170, 0.07199997499224448,  0.11295375016727069, -0.03890277688215408, -0.03890277688215407, 0.07418835553444229,  0.12373842571401289, -0.03974565037309754, -0.03974565037309753, 0.07705264985807921,  0.13473520084838175, -0.04057675152505523, -0.04057675152505523, 0.08045959690347994,  0.15058105305824362, -0.04169144974851560, -0.04169144974851560, 0.08433515349608449,  0.16475487689604817, -0.04313298868294341, -0.04313298868294340, 0.08844909148216468,  0.17649960812428095, -0.04469608555201694, -0.04469608555201694, 0.09271710753685869,  0.17457340811056918, -0.04624984779405965, -0.04624984779405965, 0.09698071771152830,  0.17729143834732247, -0.04793202830663135, -0.04793202830663135, 0.10153069332180298,  0.18781431644426710, -0.04988371630787453, -0.04988371630787453, 0.10645602554255014,  0.20226968890371799, -0.05200709477099941, -0.05200709477099941, 0.11169506602767454,  0.21057571962387894, -0.05417688326323991, -0.05417688326323991, 0.11709140194506812,  0.22152250807520027, -0.05647512985785519, -0.05647512985785519, 0.12275524191816919,  0.22514073774398694, -0.05881421064946086, -0.05881421064946086, 0.12856556534008104,  0.23575065936263351, -0.06169553642911084, -0.06169553642911083, 0.13471898476829020,  0.25340692731452963, -0.06480570637453512, -0.06480570637453510, 0.14123036954284510,  0.27107977399326072, -0.06808713214761060, -0.06808713214761059, 0.14798506451979404,  0.28472014812725088, -0.07152287576324623, -0.07152287576324623, 0.15491381998439313,  0.30339422994056781, -0.07518177129671275, -0.07518177129671275, 0.16212017559769024,  0.32068511056675808, -0.07881456491481259, -0.07881456491481259, 0.16951965225692336,  0.33378230195915271, -0.08244341708455906, -0.08244341708455906, 0.17707023560687726,  0.35358556972543320, -0.08605941482097960, -0.08605941482097960, 0.18490296127670985,  0.37617971793236965, -0.08966669605211727, -0.08966669605211727, 0.19295926473176217,  0.39964313796565276, -0.09325935310968274, -0.09325935310968275, 0.20120153675928507,  0.42279983339880933, -0.09682742127231320, -0.09682742127231321, 0.20960319710208880,  0.44474826795908584, -0.10035929363122134, -0.10035929363122136, 0.21814439918955283,  0.46465242556313213, -0.10384280859001971, -0.10384280859001972, 0.22680979489598740,  0.48163515765033976, -0.10726579703353845, -0.10726579703353846, 0.23558722226836393,  0.49471515025978507, -0.11061639909706367, -0.11061639909706368, 0.24446686862305730,  0.50276354516355681, -0.11388328248736546, -0.11388328248736547, 0.25344070457840195,  0.50362840905683237, -0.11694708051804112, -0.11694708051804113, 0.26249616065860049,  0.50886077519654149, -0.12000602290451649, -0.12000602290451649, 0.27177305917769967,  0.53753940894196228, -0.12331671148414861, -0.12331671148414861, 0.28150057273930468,  0.58422478156386226, -0.12675788251307221, -0.12675788251307221, 0.29159871019358652,  0.64854604358809853, -0.13024962589839847, -0.13024962589839847, 0.30202284254748069,  0.72726312575007357, -0.13408461161855237, -0.13408461161855237, 0.31268054143506063,  0.82372145328515756, -0.13821320036111659, -0.13821320036111659, 0.32355970964820718,  0.94204781019899575, -0.14259877676047242, -0.14259877676047242, 0.33465057109659269 ))

expect_equal(c(result$lag_one_cov),
             c( 0.14263116443415219, -0.04574920743260352, -0.05150543127174809, 0.09699079285706530,  0.10452193073617830, -0.04874739256245561, -0.05088688773815839, 0.08928873888007144,  0.09205816511743103, -0.04756288533170949, -0.04850365075455021, 0.08264748691502014,  0.07619687084467806, -0.04535505584257066, -0.04622466673349493, 0.07665184030229086,  0.06287176863202983, -0.04325886709103238, -0.04160716987308177, 0.07163427585559659,  0.04986944205987141, -0.03926405432290643, -0.03806053191486011, 0.06781573294293351,  0.04420678758208781, -0.03685812925848052, -0.03626291638490246, 0.06582468960959215,  0.04965011164211783, -0.03619367549364379, -0.03566682153220575, 0.06600412552478148,  0.05984037617699758, -0.03636192416054163, -0.03603336054933529, 0.06766354299450550,  0.06941035250370327, -0.03719088862092337, -0.03674084832627796, 0.07017664132977827,  0.07843493570034743, -0.03816550473187627, -0.03750684008628748, 0.07329844218824491,  0.08981493623946754, -0.03911819040254304, -0.03855808469632750, 0.07692587692407565,  0.10310658635478691, -0.04033010070998009, -0.03993869643713704, 0.08090961285689185,  0.11484463103360977, -0.04182722190206258, -0.04147133842862829, 0.08509110857921251,  0.11943889701282755, -0.04342857676366355, -0.04299835576581806, 0.08934994645705957,  0.11985243543009538, -0.04503133111582946, -0.04463580013043104, 0.09374691854979829,  0.12588538775084249, -0.04678858788297480, -0.04651894024076669, 0.09847389307447472,  0.13738385412440385, -0.04880681824779191, -0.04858628426379726, 0.10354633878610373,  0.14810467051698023, -0.05097881767359873, -0.05071611232481709, 0.10885655043099464,  0.15713971417898470, -0.05320244372983142, -0.05296561856819847, 0.11437825391674580,  0.16409749051278422, -0.05554564899105975, -0.05526366996309488, 0.12010875527332561,  0.17082169764926447, -0.05798517239621716, -0.05803435922163328, 0.12608210458780958,  0.18419244224951820, -0.06094157095036142, -0.06106650077427613, 0.13240606956799864,  0.20111915566759409, -0.06411857444864097, -0.06428014648816466, 0.13903231308527825,  0.21626339706997472, -0.06746230932018556, -0.06765132467092075, 0.14586836604869613,  0.23182744393716970, -0.07096532642848453, -0.07123809751737308, 0.15292935143336489,  0.24930432312366094, -0.07466552730666579, -0.07483158079442649, 0.16022691389911348,  0.26415101326279677, -0.07833917344388450, -0.07842064208601737, 0.16769729388739543,  0.28012526849294306, -0.08200216252035231, -0.08200453448237387, 0.17538307791434882,  0.30081469440241881, -0.08565137931089720, -0.08558233025367115, 0.18332254453471691,  0.32337781059751103, -0.08928760593720944, -0.08914990301383557, 0.19146736372042583,  0.34628498339489699, -0.09290425309985131, -0.09269742679066141, 0.19978529664717548,  0.36849989976218822, -0.09649155120250313, -0.09621288382965747, 0.20825303230026262,  0.38915143680505826, -0.10003839047880873, -0.09968351196260299, 0.21685290223635492,  0.40737973041049202, -0.10353321248541911, -0.10309647246244749, 0.22557109735345471,  0.42225260062760034, -0.10696449380634662, -0.10643920190335200, 0.23439658806889352,  0.43271270640033899, -0.11032104844718801, -0.10969963395979600, 0.24332041966466161,  0.43712323548021881, -0.11357939358846696, -0.11277225427960132, 0.25233231529368649,  0.44011649003356479, -0.11665841117598591, -0.11581344390893213, 0.26149456293695200,  0.45665574959249472, -0.11976869591380095, -0.11906857542687402, 0.27099088451026349,  0.49359720139669694, -0.12311415858361298, -0.12247186720389780, 0.28089856452764828,  0.54817221315200193, -0.12657419894355940, -0.12594165166472532, 0.29115499561373626,  0.61879172548337624, -0.13011247751412444, -0.12971638317819814, 0.30169208152706284,  0.70537058299019650, -0.13398820658801849, -0.13378869915457109, 0.31245682036970446,  0.81162044555582791, -0.13815236427340125, -0.13812122259985932, 0.32343824571520668 ))

expect_equal(c(result$fixed_effects),
             c(numeric(0) ))

expect_equal(c(result$n_iter),
             c(155 ))

expect_equal(c(result$Q),
             c( 0.142998595679639462, -0.004474914532711241, -0.004474914532711241, 0.011173790883017135 ))

expect_equal(c(result$Q_0),
             c(1, 0, 0, 1 ))

expect_equal(c(result$n_risk),
             c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18, 18, 18, 18, 18, 18, 18, 17, 15, 14, 14, 14, 12, 12, 12, 11 ))

expect_equal(c(result$times),
             c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45 ))

expect_equal(c(result$risk_set),
             c(NULL ))

expect_equal(c(result$data),
             c(NULL ))

expect_equal(c(result$order),
             c(1 ))

expect_equal(c(result$F_),
             c(1, 0, 0, 1 ))

expect_equal(c(result$method),
             c("EKF" ))

expect_equal(c(result$model),
             c("logit" ))

expect_equal(c(result$est_Q_0),
             c(FALSE ))

expect_equal(c(result$LR),
             c(1 ))

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result$state_vecs), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result$state_vars)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result$Q_0)), rep(c("(Intercept)", "group1"), 2))
})

test_that("Invalid penalty terms throw error", {
  expect_error(
    ddhazard(
      formula = survival::Surv(start, stop, event) ~ group,
      data = head_neck_cancer,
      by = 1, # Use by month intervals
      control = list(ridge_eps = 0)),
    regexp = "Method not implemented with penalty term \\(control\\$ridge_eps\\) equal to 0")

  expect_error(
    ddhazard(
      formula = survival::Surv(start, stop, event) ~ group,
      data = head_neck_cancer,
      by = 1, # Use by month intervals
      control = list(ridge_eps = -1)),
    regexp = "Method not implemented with penalty term \\(control\\$ridge_eps\\) equal to -1")
})

# tmp <- file("tmp.txt")
# sink(tmp)
suppressMessages(
  result_exp <- ddhazard(
    formula = survival::Surv(start, stop, event) ~ group,
    data = head_neck_cancer,
    by = 1, Q_0 = diag(.1, 2),
    Q = diag(1e-3, 2),
    control = list(est_Q_0 = F, n_max = 10^3, eps = 10^-4,
                   ridge_eps = 6e-2, save_data = F, save_risk_set = F),
    max_T = 30,
    id = head_neck_cancer$id, order = 1,
    verbose = F,
    model = "exponential"))
# sink()
# close(tmp)

# matplot(result_exp$state_vecs, type = "l")
# plot(result_exp, cov_index = 1)
# get_expect_equal(result_exp, file = "tmp.txt")

test_that("Result of exponential model on head_neck_data match previous results", {
  expect_equal(c(result_exp$state_vecs),
               c(-3.394447244746940928, -3.395153862315309024, -3.196934232144033938, -2.971370346786660566, -2.822363247966916955, -2.590374297594293385, -2.845451418921749021, -3.208754849655392150, -3.195992238503036376, -3.240424933427576981, -3.326744568839408167, -3.486460861415831669, -3.541928860019987191, -3.555787834370727651, -3.500120792413564885, -3.537496720642140602, -3.619653771189799585, -3.674506083482546259, -3.674651986577258000, -3.721577918162045862, -3.728201675120116576, -3.805010414189156975, -3.888055436948069321, -3.941960186742282879, -3.974466929102445700, -4.020706260103636076, -4.050110181610269144, -4.066153562166032742, -4.097505411945125964, -4.116975796142062549, -4.126152028734782817, 0.122916801171788451, 0.122533990313387006, 0.229527436797392376, 0.351370734874934643,  0.431297003639860010, 0.556782716408514511, 0.418632585638882948, 0.222172318828795290, 0.230645591942916117,  0.207498087114898033, 0.161454926414956679, 0.075452660198855256, 0.046037773572253332, 0.039263985561146436,  0.070000816752319173, 0.050007468669361621, 0.005752906900555035, -0.023585512732629672, -0.023428508348726215, -0.048575868452773931, -0.051999554661921105, -0.093668183155480020, -0.138558245876324398, -0.167751472331311990, -0.185423032115404118, -0.210398017154723921, -0.226308766328840061, -0.235025858701956525, -0.251906418694424872, -0.262388738913313824, -0.267328586639344778 ))

  expect_equal(c(result_exp$state_vars),
               c( 0.0769109729673901760, 0.0024536580489280015, 0.0024536580489280032, 0.0698992385820926820, 0.1042941119147692275,  0.0150384675508058330, 0.0150384675508058382, 0.0759448389094937448, 0.1219728793991194521, 0.0231903058451575182,  0.0231903058451575286, 0.0800679656176722099, 0.1230432906455513065, 0.0223322095596818343, 0.0223322095596818412,  0.0793223844019501079, 0.1103004950688061120, 0.0138735447522551902, 0.0138735447522552041, 0.0744169746041761365,  0.0970627617237544010, 0.0052158068860564261, 0.0052158068860564365, 0.0694800066653862014, 0.0684019434883764849, -0.0120319071185752517, -0.0120319071185752483, 0.0598041160592471394, 0.0882051195996330223, -0.0003465937743108031, -0.0003465937743108031, 0.0674182539353717220, 0.1154779469923206681, 0.0156772204485779477, 0.0156772204485779477,  0.0776181230783223042, 0.1272127282062879561, 0.0229150724776038574, 0.0229150724776038608, 0.0828882130290883035,  0.1355465325022736645, 0.0281392010628513725, 0.0281392010628513725, 0.0870069181623930876, 0.1468915885519631037,  0.0350130485236963274, 0.0350130485236963204, 0.0920617412760395548, 0.1692065682033239149, 0.0479053005015653496,  0.0479053005015653635, 0.1004510102245208536, 0.1876054679883882303, 0.0584981337118647762, 0.0584981337118647832,  0.1075157569113651956, 0.2009721122650755254, 0.0662366601197965782, 0.0662366601197965921, 0.1129782227697642139,  0.2043995550809924733, 0.0684504302554253402, 0.0684504302554253541, 0.1153808161034944602, 0.2105592801998395214,  0.0720417136418841086, 0.0720417136418841225, 0.1184903098172603031, 0.2259541153201423125, 0.0806342874444740398,  0.0806342874444740398, 0.1243269906938002933, 0.2440338533475068794, 0.0906345387485875398, 0.0906345387485875537,  0.1309141887455235465, 0.2586345465007773292, 0.0986441193013575524, 0.0986441193013575524, 0.1363743609270683943,  0.2754463345565064669, 0.1078279486353412309, 0.1078279486353412447, 0.1424681063093525546, 0.2895308626534787155,  0.1154620255376587745, 0.1154620255376587329, 0.1476902588984260190, 0.3126473663631990640, 0.1278971261909256363,  0.1278971261909255808, 0.1554753949527016288, 0.3445473415315708499, 0.1450772192704306018, 0.1450772192704305463,  0.1658336656178109880, 0.3809290561832989752, 0.1646133235319788557, 0.1646133235319788279, 0.1774362201678598150,  0.4205881332338599066, 0.1858346074048432273, 0.1858346074048431995, 0.1899082289433333681, 0.4678716938627417443,  0.2111260537034579388, 0.2111260537034579110, 0.2045582772708172403, 0.5214745058633968311, 0.2397885695312690912,  0.2397885695312690912, 0.2210105524792665976, 0.5816098706683554553, 0.2719243960554488804, 0.2719243960554488804,  0.2393125890989960258, 0.6537036914529315013, 0.3104984222982312136, 0.3104984222982312136, 0.2610848294124529234,  0.7380428629117394834, 0.3556472659006939541, 0.3556472659006939541, 0.2863904657529356967 ))

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL ))

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) ))

  expect_equal(c(result_exp$n_iter),
               c(131 ))

  expect_equal(c(result_exp$Q),
               c(0.09771736591399401, 0.05231684402165718, 0.05231684402165718, 0.02914800107904403 ))

  expect_equal(c(result_exp$Q_0),
               c(0.1, 0.0, 0.0, 0.1 ))

  expect_equal(c(result_exp$n_risk),
               c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18 ))

  expect_equal(c(result_exp$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30 ))

  expect_equal(c(result_exp$risk_set),
               c(NULL ))

  expect_equal(c(result_exp$data),
               c(NULL ))

  expect_equal(c(result_exp$order),
               c(1 ))

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$method),
               c("EKF" ))

  expect_equal(c(result_exp$model),
               c("exponential" ))

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE ))

  expect_equal(c(result_exp$LR),
               c(1 ))
})

test_that("exponential model and logit moels hazzard functions differs", {
  expect_true(result_exp$model != result$model)
  expect_true(toString(body(result_exp$hazard_func)) !=
                toString(body(result$hazard_func)))
  expect_true(toString(body(result_exp$hazard_first_deriv)) !=
                toString(body(result$hazard_first_deriv)))
})

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result_exp$state_vecs), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result_exp$state_vars)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result_exp$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result_exp$Q_0)), rep(c("(Intercept)", "group1"), 2))
})


# Change by argument
suppressMessages(result_exp <- ddhazard(
  formula = survival::Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 2, Q_0 = diag(1, 2),
  Q = diag(1e-1, 2),
  control = list(est_Q_0 = F, n_max = 10^4, eps = 10^-3,
                 save_data = F, save_risk_set = F),
  max_T = 30,
  id = head_neck_cancer$id, order = 1,
  verbose = F,
  model = "exponential"
))

# matplot(result_exp$state_vecs, type = "l")
# plot(result_exp, cov_index = 1)
# get_expect_equal(result_exp, file = "tmp.txt")

test_that("Result of exponential model on head_neck_data match previous results with altered by argument", {
  expect_equal(c(result_exp$state_vecs),
               c(-3.62590778015360149, -3.62759233807803749, -2.17274432418045604, -2.52748918870900185, -3.50841310750728086, -3.10885732680564297, -4.22783510072752833, -3.92709402211447101, -3.60740634797076432, -4.03838533153281265, -3.94779597187891307, -4.09975230479413533, -4.30301823898316194, -4.47732030079043586, -4.40010697814281926, -4.60711268550504194, -0.19906428996289194, -0.19974683135526766, 0.41288470455339110, -0.16595800017238271, -0.38538944216808591, 0.03865120162576074, -0.60302569407267925, -0.23476757298182288,  0.01097060070719717, -0.12384370427173708, -0.07065118588144031, -0.28277216760105339, -0.43131777210679623, -0.53638945504109037, -0.52693077530256238, -0.61833435589597507 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$state_vars),
               c( 0.495078710287348289, 0.052625226565770712, 0.052625226565770691, 0.422238903395292908,  0.216268590983880071, -0.065797526809314250, -0.065797526809314250, 0.280482647557779519,  0.251034011473738161, -0.032764743391070134, -0.032764743391070134, 0.245974145036597536,  0.101690380179573270, -0.086367589713501502, -0.086367589713501502, 0.123638104872990803,  0.111896153276473800, -0.043030645624127950, -0.043030645624127950, 0.196345098331425605,  0.253527667538671175, 0.005632905132764862, 0.005632905132764852, 0.296100159999138801,  0.174078290284672699, -0.080639820854725236, -0.080639820854725236, 0.265438498931471756,  0.430860804728976809, 0.048938669963499118, 0.048938669963499111, 0.460148870095407003,  0.451322794547896089, 0.034678274217342327, 0.034678274217342292, 0.530469995430644436,  0.314665834789930488, -0.078784184381391897, -0.078784184381391925, 0.511710932973043597,  0.491512880420218790, -0.033527987375808983, -0.033527987375809004, 0.642131311853453846,  0.518909336565227419, -0.080082639659700930, -0.080082639659700916, 0.718561853746172652,  0.609843035628635732, -0.064115661965608139, -0.064115661965608139, 0.874261245528871855,  0.748002209853769640, -0.034249070871664539, -0.034249070871664539, 1.059739279758823205,  0.950292987492558860, 0.016591238532214475, 0.016591238532214475, 1.273909731624657260,  1.144172283367287379, 0.049840700536810646, 0.049840700536810646, 1.484669784484485833 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$n_iter),
               c(9 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$Q),
               c(0.3730515618113955, 0.1458540771026942, 0.1458540771026942, 0.1859692601221431 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$Q_0),
               c(1, 0, 0, 1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$n_risk),
               c(96, 91, 78, 53, 46, 39, 36, 33, 30, 25, 23, 21, 20, 19, 18 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$times),
               c( 0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$risk_set),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$data),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$order),
               c(1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$method),
               c("EKF" )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$model),
               c("exponential" )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$LR),
               c(0.4444444444444444 )
               , tolerance = 1e-05)
})

# for(s in sample.int(1e6, 100, replace = F)){
# print(s)
# set.seed(s)
set.seed(599479)

sims <- test_sim_func_exp(n_series = 1e3, n_vars = 10, t_0 = 0, t_max = 10,
                          x_range = 1, x_mean = 0, re_draw = T, beta_start = 0,
                          intercept_start = -5, sds = c(.1, rep(1, 10)))
# tmp_file <- file("exponential.log")
# sink(tmp_file)
suppressMessages(result_exp <- ddhazard(
  formula = survival::Surv(tstart, tstop, event) ~ . - id - tstart - tstop - event,
  data = sims$res,
  by = (by_ <- 1),
  Q_0 = diag(10, 11),
  Q = diag(1e-2, 11),
  control = list(est_Q_0 = F, eps = 10^-2, n_max = 10^3,
                 save_data = F, save_risk_set = F, ridge_eps = 1e-2),
  max_T = 10,
  id = sims$res$id, order = 1,
  verbose = F,
  model = "exponential"))
# sink()
# close(tmp_file)

# matplot(seq_len(nrow(sims$betas)) - 1, sims$betas, type = "l", lty = 1)
# matplot(result_exp$times, result_exp$state_vecs, result_exp$state_vecs, type = "l", lty = 2, add = T)
# get_expect_equal(result_exp, eps = 1e-5, file = "tmp.txt")

test_that("Result of exponential model on simulated data match previous results", {
  expect_equal(c(result_exp$state_vecs),
               c(-4.87098613004176606, -4.86809658760155273, -4.17239134372609133, -3.64298038035336402, -3.68923883968043498, -3.99986115546653354, -3.97383602318074702, -4.26721666796822507, -3.84942946173652034, -2.75643993372530494, -3.47487135429318439, 0.60133396481297952, 0.60093065130536338, 0.83673726042660268, -0.16696061905586151, -0.39226169596984461, -1.71815943829804274, -2.12865530989928287, -2.77590605534152157, -1.72363720000415221, -0.42832572240361860, -1.31050618803115015, -2.05243969428341622, -2.06648164867629136, -1.36108297111572685, -4.34613756576528232, -3.06586032506085360, -4.67527453593745523, -4.60042941918569781, -4.86914028523089204, -4.12277196787331324, -2.84345734854403664, -1.81325221519512469, 0.51870706403420930, 0.53371770029207277, -0.05648836086790288, 0.06205136372106167, 0.50581404376743377, 0.92235830867727564, 1.73210436240291399,  0.17142041926838203, 0.22330674438239392, 0.72543234691872460, 0.46661898364057031, -0.27499729541289747, -0.31249870358322929, 1.48541129259834737, 1.71704760190196271, 3.11580044620500907, 3.20667190605315966,  1.70056579858691537, 5.04725133770979095, 3.03279135635349739, 0.32803957438379094, 2.90820603948697753,  1.70335465509573947, 1.73289539423081651, 0.53879787340291163, -0.10931667585888025, 0.18116747822701693, -0.14190457533631312, 1.04906285548681488, -2.45304471234616051, -1.26434201950845515, 0.70393098544997934, -0.77064452451365639, -0.77351456994885548, -0.78757829220832520, -0.16905987950408971, -0.72470742883528882,  0.09736766944059885, -0.20923990108613821, -0.63985427300064113, 0.25649862196117235, -0.29136442899511383, -0.97712714312455362, 0.08623552620452923, 0.76852064010428023, 0.76001682970751516, 1.92118062777371579,  1.56748686626076106, 1.87445154153259086, 1.69908258455837746, 2.21545045544848707, 3.00493128330604176,  3.33192368887520463, 4.49053819876036808, 5.01762688738048279, 1.59239964084751118, 1.61435995180660030,  1.30893925227527363, 2.41474371693216217, 1.69394667001071864, 1.99284079576350059, 2.69146619065053017,  1.04149245828289549, 2.03541390084229734, 3.76950853669704999, 1.96039674825782595, 0.50842462960282975,  0.48972400567762142, 1.13503419690069141, -1.46119534336473578, 1.46872477212907326, 0.46027424539114947,  0.06290035982256044, -0.23964194407476253, -1.17783261809158502, -2.06248090485492375, 0.31685554722075526, -2.09843519063239592, -2.08119821829581042, -3.99912684978430732, -3.60776648296259683, -4.77421144789206231, -4.14545038091752094, -3.98697485753880576, -5.01920928215269146, -4.88076013169537681, -5.65621186755513605, -6.61206458387844265 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$state_vars),
               c( 3.280352359941094e-01, 2.740957664539776e-01, 5.461261701355979e-02, -2.061022108842295e-02, -2.559576052468147e-01, 1.750556244821720e-01, -8.838663540337396e-02, 1.446334586173968e-01,  3.129832473435102e-01, -2.650068510114775e-01, -1.989902182846583e-01, 2.740957664539774e-01,  1.017854052389970e+00, 7.364709691239686e-01, -2.385141765556651e-01, -6.603868681431914e-01,  4.445706730038987e-01, -8.540789422833940e-02, -9.082547007883702e-03, 2.090839748460317e-01, -1.429815372317665e-02, -7.737215611651931e-02, 5.461261701355977e-02, 7.364709691239687e-01,  1.841792289760706e+00, -9.907709496206492e-02, -2.827776826364317e-01, 4.130941347624754e-01,  2.468238509468466e-01, 6.001178569248905e-01, -3.009249408070026e-01, 1.135798688645071e+00, -6.333577791783217e-01, -2.061022108842304e-02, -2.385141765556651e-01, -9.907709496206503e-02,  5.497506755662265e-01, -4.884605787144627e-01, 6.745503402267905e-01, -1.395978080224048e-01, -7.337394690056691e-02, 2.843242382942127e-01, 2.233449816096167e-01, 1.405142010767201e-01, -2.559576052468146e-01, -6.603868681431915e-01, -2.827776826364318e-01, -4.884605787144629e-01,  2.347730577011613e+00, -1.616429919756363e+00, 6.771432025739202e-01, 6.129115367672491e-02, -1.044236955090275e+00, 8.158405847195910e-01, -5.941932996449008e-01, 1.750556244821721e-01,  4.445706730038986e-01, 4.130941347624753e-01, 6.745503402267904e-01, -1.616429919756362e+00,  1.710747067081627e+00, -3.823751477168730e-01, -1.930599908770150e-01, 7.405135388897152e-01,  2.261347050917355e-01, 3.277207473850733e-01, -8.838663540337391e-02, -8.540789422833944e-02,  2.468238509468466e-01, -1.395978080224050e-01, 6.771432025739204e-01, -3.823751477168731e-01,  3.314715406487583e-01, 8.738307786786503e-02, -4.147851714391390e-01, 5.581665177798127e-01, -2.777536149649448e-01, 1.446334586173968e-01, -9.082547007883782e-03, 6.001178569248904e-01, -7.337394690056691e-02, 6.129115367672479e-02, -1.930599908770151e-01, 8.738307786786502e-02,  8.693821299528768e-01, -6.320446078423717e-03, 2.050705944151804e-02, -6.631239158686475e-01,  3.129832473435100e-01, 2.090839748460318e-01, -3.009249408070027e-01, 2.843242382942127e-01, -1.044236955090276e+00, 7.405135388897147e-01, -4.147851714391388e-01, -6.320446078423723e-03,  8.643003645859171e-01, -7.466767519210731e-01, 1.786462446356397e-01, -2.650068510114774e-01, -1.429815372317674e-02, 1.135798688645072e+00, 2.233449816096167e-01, 8.158405847195911e-01,  2.261347050917354e-01, 5.581665177798126e-01, 2.050705944151798e-02, -7.466767519210732e-01,  2.216850353938611e+00, -5.202254119102816e-01, -1.989902182846583e-01, -7.737215611651926e-02, -6.333577791783218e-01, 1.405142010767202e-01, -5.941932996449010e-01, 3.277207473850732e-01, -2.777536149649449e-01, -6.631239158686476e-01, 1.786462446356397e-01, -5.202254119102816e-01,  9.453616714905735e-01, 6.111079510055056e-02, 5.603610463397862e-02, 2.525858796146219e-02, -4.275941745714360e-02, 2.200460405774110e-02, -3.363341085677371e-02, 1.109865427675456e-02,  6.916848700969119e-03, 1.027130371034635e-04, -2.963453679086293e-02, -2.565215930542353e-02,  5.603610463397857e-02, 4.052193512602031e-01, 2.359840360519136e-01, -1.556755586494249e-01, -1.244735256346670e-01, 5.126368056206404e-02, 8.403314432449266e-04, -7.122800051338149e-02, -7.351461734060219e-03, 7.541337929202176e-03, 1.201602240761298e-02, 2.525858796146219e-02,  2.359840360519136e-01, 6.242717718391025e-01, -6.374620398974763e-02, -1.255007452469489e-01,  8.902660001578890e-02, 6.002340556682516e-02, 2.356359797193713e-01, -8.599639818604725e-02,  2.550276062788886e-01, -1.940933379492329e-01, -4.275941745714367e-02, -1.556755586494248e-01, -6.374620398974774e-02, 2.242058436388747e-01, -8.357173744575400e-02, 1.720474861144865e-01, -2.668162098902034e-02, -1.645037766384920e-02, 5.111589383300097e-02, 1.102628205664715e-01,  3.895159454978548e-02, 2.200460405774107e-02, -1.244735256346670e-01, -1.255007452469490e-01, -8.357173744575405e-02, 5.556296150997004e-01, -3.099109341045130e-01, 1.371642082702276e-01, -5.774335671843026e-04, -1.536339746601565e-01, 1.635069748138021e-01, -1.767352204873024e-01, -3.363341085677374e-02, 5.126368056206405e-02, 8.902660001578881e-02, 1.720474861144864e-01, -3.099109341045129e-01, 4.204620592220439e-01, -5.957843551132236e-02, -9.707205276667610e-02,  9.916574992820873e-02, 1.519538227700721e-01, 1.203227773924599e-01, 1.109865427675462e-02,  8.403314432449092e-04, 6.002340556682518e-02, -2.668162098902041e-02, 1.371642082702276e-01, -5.957843551132233e-02, 1.094898757522471e-01, 2.581889651803603e-02, -7.479091873343005e-02,  1.248621005999987e-01, -7.988669812340501e-02, 6.916848700969119e-03, -7.122800051338155e-02,  2.356359797193712e-01, -1.645037766384920e-02, -5.774335671843859e-04, -9.707205276667616e-02,  2.581889651803605e-02, 4.073078190255613e-01, -2.530574961101975e-02, -2.755925581031523e-02, -2.325666838020915e-01, 1.027130371034080e-04, -7.351461734060177e-03, -8.599639818604733e-02,  5.111589383300094e-02, -1.536339746601568e-01, 9.916574992820840e-02, -7.479091873342994e-02, -2.530574961101976e-02, 1.784009606209533e-01, -1.287773218554362e-01, 6.884529861301192e-02, -2.963453679086292e-02, 7.541337929202092e-03, 2.550276062788888e-01, 1.102628205664715e-01,  1.635069748138020e-01, 1.519538227700720e-01, 1.248621005999987e-01, -2.755925581031526e-02, -1.287773218554362e-01, 6.235771514556634e-01, -1.375130662768897e-01, -2.565215930542364e-02,  1.201602240761304e-02, -1.940933379492329e-01, 3.895159454978560e-02, -1.767352204873024e-01,  1.203227773924598e-01, -7.988669812340507e-02, -2.325666838020916e-01, 6.884529861301203e-02, -1.375130662768896e-01, 3.252397664709445e-01, 5.969593483877020e-02, 4.668372733366652e-02,  3.016980211257192e-02, -3.924502379462838e-02, 3.804405280283941e-02, -4.032286188921783e-02,  1.373970459925273e-02, 2.314036938589119e-02, -1.704275340597305e-03, -1.859892941794586e-02, -4.658227778038852e-02, 4.668372733366649e-02, 3.159413821366559e-01, 2.058118538641713e-01, -1.157570033516740e-01, -8.673764538879600e-02, 4.107540140402216e-02, 4.938755276791086e-03, -3.049380404291296e-02, -8.092359796901170e-03, 2.890389043087702e-02, -1.859076657109219e-02,  3.016980211257192e-02, 2.058118538641714e-01, 5.250761410726861e-01, -4.507318123362501e-02, -9.650238008392707e-02, 9.498463208508667e-02, 5.474596707343428e-02, 1.807409547750310e-01, -6.939215837155942e-02, 2.491437851149091e-01, -1.662210976806596e-01, -3.924502379462844e-02, -1.157570033516740e-01, -4.507318123362512e-02, 1.878811541957759e-01, -8.754359634309715e-02,  1.561062073669897e-01, -2.697683056842464e-02, -2.479599366542983e-02, 4.598938745598268e-02,  9.295357517143685e-02, 4.277838767512564e-02, 3.804405280283939e-02, -8.673764538879586e-02, -9.650238008392718e-02, -8.754359634309711e-02, 4.706624238392267e-01, -2.768365642056790e-01,  1.190604804559484e-01, 1.799214795863469e-02, -1.240711762592108e-01, 1.096379386640666e-01, -1.615197728554487e-01, -4.032286188921774e-02, 4.107540140402215e-02, 9.498463208508662e-02,  1.561062073669895e-01, -2.768365642056790e-01, 3.735545420498818e-01, -5.450101104178780e-02, -7.877216420635241e-02, 8.220496523894399e-02, 1.505881897171271e-01,
                  9.967404659237970e-02,  1.373970459925275e-02, 4.938755276791069e-03, 5.474596707343428e-02, -2.697683056842464e-02,  1.190604804559485e-01, -5.450101104178783e-02, 9.620161761290258e-02, 2.466815314677624e-02, -6.404039151993099e-02, 1.046890867715383e-01, -7.027318745983242e-02, 2.314036938589118e-02, -3.049380404291294e-02, 1.807409547750309e-01, -2.479599366542985e-02, 1.799214795863458e-02, -7.877216420635252e-02, 2.466815314677626e-02, 3.135336046522404e-01, -1.500029573981360e-02, -1.418681808829231e-02, -1.971875513556473e-01, -1.704275340597333e-03, -8.092359796901157e-03, -6.939215837155935e-02, 4.598938745598263e-02, -1.240711762592109e-01, 8.220496523894415e-02, -6.404039151993099e-02, -1.500029573981356e-02, 1.489319269551888e-01, -1.031542420847307e-01,  4.583083367491508e-02, -1.859892941794588e-02, 2.890389043087698e-02, 2.491437851149092e-01,  9.295357517143682e-02, 1.096379386640666e-01, 1.505881897171272e-01, 1.046890867715383e-01, -1.418681808829236e-02, -1.031542420847306e-01, 5.378885087181484e-01, -1.187681130746853e-01, -4.658227778038854e-02, -1.859076657109214e-02, -1.662210976806595e-01, 4.277838767512575e-02, -1.615197728554488e-01, 9.967404659237965e-02, -7.027318745983240e-02, -1.971875513556473e-01,  4.583083367491499e-02, -1.187681130746853e-01, 3.015999781360512e-01, 3.043978109127655e-02,  1.397494780137230e-02, -1.431354488424776e-02, -1.460033768334751e-03, -1.997023613268045e-02,  1.096601468960877e-02, -6.635222190981566e-03, -1.944607574005820e-02, 1.380877364342104e-02, -3.243629285358185e-02, 2.221315815797958e-02, 1.397494780137228e-02, 1.618383698580136e-01,  5.947451321093207e-02, -5.597425990965546e-02, -5.372685913473549e-02, 1.783392758527634e-02, -8.047689554771632e-03, -3.939587287345574e-02, 2.929459248898177e-03, -1.957076875162398e-02,  2.255454228988917e-02, -1.431354488424776e-02, 5.947451321093209e-02, 2.012359990691520e-01, -2.408491948552042e-02, -4.062517711576096e-02, 1.303974830719050e-02, 1.469978566140788e-02,  5.483291788494361e-02, -4.136795480232007e-02, 7.022182037638239e-02, -2.880798099368694e-02, -1.460033768334803e-03, -5.597425990965546e-02, -2.408491948552044e-02, 1.019945200116460e-01, -2.370535128769845e-02, 6.268480605571024e-02, -8.430667382766308e-03, 2.562589777981095e-03,  2.936203706577188e-02, 4.153662481412328e-02, -3.446000887347626e-03, -1.997023613268046e-02, -5.372685913473538e-02, -4.062517711576108e-02, -2.370535128769847e-02, 2.070719205278944e-01, -1.061943147253169e-01, 4.588009700598870e-02, -1.236892594201356e-02, -6.810900554150146e-02,  6.569763069120807e-02, -3.994663018902574e-02, 1.096601468960881e-02, 1.783392758527636e-02,  1.303974830719043e-02, 6.268480605571017e-02, -1.061943147253169e-01, 1.687885105993885e-01, -2.336638831862713e-02, -2.512037331741796e-02, 5.730557999207860e-02, 3.647933732766599e-02,  2.389605900385549e-02, -6.635222190981585e-03, -8.047689554771668e-03, 1.469978566140793e-02, -8.430667382766313e-03, 4.588009700598870e-02, -2.336638831862719e-02, 5.694725800808867e-02,  1.924485228833106e-03, -3.412998327388811e-02, 4.272106176074711e-02, -1.451169919211750e-02, -1.944607574005816e-02, -3.939587287345576e-02, 5.483291788494362e-02, 2.562589777981097e-03, -1.236892594201361e-02, -2.512037331741804e-02, 1.924485228833128e-03, 1.463174101310511e-01, -8.308589177477444e-03, -1.861908760214458e-02, -5.778075698825820e-02, 1.380877364342104e-02,  2.929459248898215e-03, -4.136795480232004e-02, 2.936203706577186e-02, -6.810900554150141e-02,  5.730557999207871e-02, -3.412998327388815e-02, -8.308589177477446e-03, 1.079671422207949e-01, -5.517265376359157e-02, 1.663431906436722e-02, -3.243629285358185e-02, -1.957076875162401e-02,  7.022182037638244e-02, 4.153662481412327e-02, 6.569763069120803e-02, 3.647933732766599e-02,  4.272106176074703e-02, -1.861908760214463e-02, -5.517265376359148e-02, 2.373708723019124e-01, -3.429694579680545e-02, 2.221315815797960e-02, 2.255454228988919e-02, -2.880798099368693e-02, -3.446000887347524e-03, -3.994663018902574e-02, 2.389605900385544e-02, -1.451169919211753e-02, -5.778075698825828e-02, 1.663431906436711e-02, -3.429694579680548e-02, 1.088084676144534e-01,  1.864657517484697e-02, 1.188256078391958e-02, 2.242579214090228e-02, -1.644818269898665e-03, -1.070985541709880e-02, 7.872586046935878e-03, 3.943220880868546e-03, -4.864483350678196e-03, -3.141279408289330e-03, 8.185255050488453e-03, 9.200667195493666e-03, 1.188256078391960e-02,  8.499046010716294e-02, 3.267813178507981e-02, -2.523934153890156e-02, -1.710753242518338e-02,  4.654149251490771e-03, -3.866643383107589e-04, -9.740234312155973e-03, -7.558749400659985e-04,  6.316903404712194e-04, -2.294588404901288e-03, 2.242579214090226e-02, 3.267813178507982e-02,  1.211464320239611e-01, -1.354290755607667e-02, -1.799182140276897e-02, 5.051475410333189e-03,  6.883837620714544e-03, 3.366897410828100e-02, -1.124026904343590e-02, 2.780536792031696e-02, -2.730921894583772e-02, -1.644818269898674e-03, -2.523934153890155e-02, -1.354290755607671e-02,  5.721803615651333e-02, -3.192633180367703e-03, 1.948934231060535e-02, -2.610889150564995e-03, -7.948952085353664e-04, 1.173995596700737e-02, 1.526578605694906e-02, -3.248507567762265e-04, -1.070985541709876e-02, -1.710753242518335e-02, -1.799182140276898e-02, -3.192633180367672e-03,  9.140538880676531e-02, -2.703611795918584e-02, 1.483397128910545e-02, -1.133402503177503e-02, -2.082885750962347e-02, 2.916086871908971e-02, -9.689736958829629e-03, 7.872586046935904e-03,  4.654149251490762e-03, 5.051475410333172e-03, 1.948934231060533e-02, -2.703611795918584e-02,  7.087246974390476e-02, -3.747748474290457e-03, -6.900168639375526e-03, 1.748756900977174e-02,  1.540322970181824e-02, 2.742324738682255e-03, 3.943220880868547e-03, -3.866643383107779e-04,  6.883837620714532e-03, -2.610889150565011e-03, 1.483397128910540e-02, -3.747748474290528e-03,  3.949398277749755e-02, -1.556291044314210e-05, -1.166175348576581e-02, 1.681666615669705e-02, -5.367254048138178e-03, -4.864483350678179e-03, -9.740234312155982e-03, 3.366897410828102e-02, -7.948952085353594e-04, -1.133402503177505e-02, -6.900168639375581e-03, -1.556291044312909e-05,  8.279893802372824e-02, 1.915772004275226e-03, -3.769188132260732e-03, -3.128460974382662e-02, -3.141279408289305e-03, -7.558749400660037e-04, -1.124026904343588e-02, 1.173995596700731e-02, -2.082885750962337e-02, 1.748756900977174e-02, -1.166175348576581e-02, 1.915772004275238e-03,  5.799496225330166e-02, -1.271726326342869e-02, -5.642091281755392e-05, 8.185255050488453e-03,  6.316903404712105e-04, 2.780536792031700e-02, 1.526578605694908e-02, 2.916086871908965e-02,  1.540322970181818e-02, 1.681666615669702e-02, -3.769188132260781e-03, -1.271726326342877e-02,  1.022939354670514e-01, -2.353362741827339e-02, 9.200667195493693e-03, -2.294588404901294e-03, -2.730921894583764e-02, -3.248507567761910e-04, -9.689736958829617e-03, 2.742324738682182e-03, -5.367254048138148e-03, -3.128460974382662e-02, -5.642091281758688e-05, -2.353362741827334e-02,  7.848815138610575e-02, 2.198083872087300e-02, 1.897863043744658e-02, 1.221361552477069e-02, -5.491113387208257e-03, -2.447544109688193e-02, 8.954159675305249e-03, -4.432599867842203e-03, -6.309059411579865e-03, 7.400751951504257e-03,
                  -1.635835424981179e-02, 1.485964836818583e-02,  1.897863043744660e-02, 9.054336645349155e-02, 2.691918548521788e-02, -2.507584481634863e-02, -2.799287415257087e-02, 1.068735542843394e-02, -4.667988721484074e-03, -1.206879229795278e-02,  1.128110515388755e-02, -1.191253879816777e-02, -1.520308419158262e-05, 1.221361552477067e-02,  2.691918548521791e-02, 1.174849115493794e-01, -6.781400217810526e-03, -2.149026954280056e-02,  1.439379621902187e-02, 6.723163539077382e-03, 3.360119444703647e-02, -1.059001337313019e-02,  3.158981484734322e-02, -2.330157210656739e-02, -5.491113387208257e-03, -2.507584481634858e-02, -6.781400217810594e-03, 5.988252630846326e-02, -9.813631440946574e-03, 2.911667226542921e-02, -3.157651058842410e-03, 7.544119343985745e-04, 1.122906197505195e-02, 2.442103875815424e-02,  5.192589575943251e-04, -2.447544109688191e-02, -2.799287415257081e-02, -2.149026954280067e-02, -9.813631440946638e-03, 1.136246192294453e-01, -4.740225294278542e-02, 2.044952919655954e-02, -1.006691960735153e-02, -3.746190469935710e-02, 3.570056711522560e-02, -1.115160695420086e-02,  8.954159675305259e-03, 1.068735542843396e-02, 1.439379621902183e-02, 2.911667226542920e-02, -4.740225294278542e-02, 8.854154036655264e-02, -7.753521167535460e-03, -3.669685278508598e-03,  2.680347840099859e-02, 2.178580429882096e-02, 2.973466204505382e-03, -4.432599867842188e-03, -4.667988721484087e-03, 6.723163539077377e-03, -3.157651058842446e-03, 2.044952919655953e-02, -7.753521167535513e-03, 3.840333160715604e-02, -4.766197894102167e-04, -1.714627985426286e-02,  2.086162775587024e-02, -3.728558137130320e-03, -6.309059411579832e-03, -1.206879229795279e-02,  3.360119444703651e-02, 7.544119343985650e-04, -1.006691960735158e-02, -3.669685278508638e-03, -4.766197894102154e-04, 8.254356850409320e-02, 2.392865352495181e-03, -4.826989397089841e-03, -3.370743801561305e-02, 7.400751951504234e-03, 1.128110515388758e-02, -1.059001337313015e-02,  1.122906197505196e-02, -3.746190469935707e-02, 2.680347840099861e-02, -1.714627985426283e-02,  2.392865352495175e-03, 6.559902944621090e-02, -2.477330803675362e-02, -6.837545263942407e-05, -1.635835424981179e-02, -1.191253879816779e-02, 3.158981484734330e-02, 2.442103875815426e-02,  3.570056711522556e-02, 2.178580429882095e-02, 2.086162775587022e-02, -4.826989397089862e-03, -2.477330803675358e-02, 1.250339793740922e-01, -1.805878646017453e-02, 1.485964836818584e-02, -1.520308419159498e-05, -2.330157210656739e-02, 5.192589575943639e-04, -1.115160695420096e-02,  2.973466204505301e-03, -3.728558137130376e-03, -3.370743801561312e-02, -6.837545263941973e-05, -1.805878646017453e-02, 7.523071506724358e-02, 2.685207094921994e-02, 3.197988470562239e-02,  2.886679579744172e-02, -9.891622475714113e-03, -2.589144356125232e-02, 1.092446737941158e-02, -1.953253615605698e-03, -1.153923912298933e-03, 5.225014991021381e-03, -9.910079763162417e-03,  6.712789747480486e-03, 3.197988470562239e-02, 1.148597016397488e-01, 5.286686488450448e-02, -3.067971052242909e-02, -3.505356652935691e-02, 1.826314687270118e-02, -7.135679002420674e-04, -1.035438457085635e-02, 1.012806223017789e-02, 6.922905539314028e-04, -6.476898841924773e-03,  2.886679579744172e-02, 5.286686488450443e-02, 1.591078632576111e-01, -5.833641141382737e-03, -4.352950037661044e-02, 3.357398327288001e-02, 8.381517841227776e-03, 4.331404795776332e-02, -7.418532716443455e-03, 4.877099608053015e-02, -3.294286649922184e-02, -9.891622475714115e-03, -3.067971052242904e-02, -5.833641141382760e-03, 6.049905373321320e-02, -1.135038441984069e-02,  3.123361872073544e-02, -3.148618210644986e-03, 1.825167931578687e-03, 9.495811864035456e-03,  2.591769201713164e-02, 2.171068780610453e-03, -2.589144356125232e-02, -3.505356652935690e-02, -4.352950037661046e-02, -1.135038441984070e-02, 1.275479437374419e-01, -5.850845036714495e-02,  2.016393845318904e-02, -1.987911234616234e-02, -3.690675636447155e-02, 2.842220428257829e-02, -1.018848249744418e-02, 1.092446737941160e-02, 1.826314687270119e-02, 3.357398327287999e-02,  3.123361872073547e-02, -5.850845036714498e-02, 1.009212266493222e-01, -6.286547737571847e-03, -2.532815292687758e-03, 2.541729785081352e-02, 3.489501104263397e-02, 3.353952936187381e-03, -1.953253615605703e-03, -7.135679002421149e-04, 8.381517841227770e-03, -3.148618210645012e-03,  2.016393845318909e-02, -6.286547737571832e-03, 3.771410331395358e-02, -3.809958487328526e-03, -1.640034850169887e-02, 2.374834815882807e-02, -4.568202851470686e-03, -1.153923912298908e-03, -1.035438457085634e-02, 4.331404795776336e-02, 1.825167931578695e-03, -1.987911234616239e-02, -2.532815292687776e-03, -3.809958487328522e-03, 9.309031552131837e-02, 7.067933103814672e-03, -1.503161828558396e-02, -3.855413987083035e-02, 5.225014991021319e-03, 1.012806223017787e-02, -7.418532716443577e-03, 9.495811864035444e-03, -3.690675636447165e-02, 2.541729785081345e-02, -1.640034850169888e-02, 7.067933103814699e-03, 6.284603159949340e-02, -2.618650354611824e-02, -1.349971441815324e-03, -9.910079763162423e-03, 6.922905539313816e-04, 4.877099608053020e-02,  2.591769201713164e-02, 2.842220428257829e-02, 3.489501104263396e-02, 2.374834815882809e-02, -1.503161828558398e-02, -2.618650354611828e-02, 1.427896109778563e-01, -1.675732540192837e-02,  6.712789747480512e-03, -6.476898841924783e-03, -3.294286649922183e-02, 2.171068780610440e-03, -1.018848249744424e-02, 3.353952936187331e-03, -4.568202851470730e-03, -3.855413987083041e-02, -1.349971441815308e-03, -1.675732540192833e-02, 8.027812326806469e-02, 2.553160789770554e-02,  3.218091484287178e-02, 2.704503176225755e-02, -1.577089338129604e-02, -9.361091103682107e-03, -8.265716742248399e-04, 2.711111622368012e-03, -6.854339555891594e-03, -2.879042545150182e-03, -3.501385014471708e-03, 5.177171543503443e-03, 3.218091484287178e-02, 1.225613715087277e-01,  5.022794402511375e-02, -3.876487934033400e-02, -2.430152013612182e-02, 7.999350607762742e-03,  4.070049687836227e-05, -2.549578119014988e-02, 6.035440064123579e-03, 2.869065163689827e-04, -5.574506551881027e-04, 2.704503176225752e-02, 5.022794402511378e-02, 1.515782703224266e-01, -8.951272192661463e-03, -2.277247462813079e-02, 2.030631317170360e-02, 1.179376006956373e-02,  3.986566678782998e-02, -1.182016672218509e-02, 5.639976018396740e-02, -3.725311943312810e-02, -1.577089338129604e-02, -3.876487934033397e-02, -8.951272192661426e-03, 6.457286900573248e-02, -1.220023864526619e-02, 3.270479954440206e-02, -3.657033739657946e-03, 5.938464998557156e-03,  8.902782078050031e-03, 2.531102411161068e-02, 1.329288937627499e-03, -9.361091103682117e-03, -2.430152013612184e-02, -2.277247462813079e-02, -1.220023864526617e-02, 1.171260107942277e-01, -4.710504837555895e-02, 2.219684136537136e-02, 5.368560449397789e-04, -2.956636324610938e-02,  3.584280821889743e-02, -2.545402511182777e-02, -8.265716742248334e-04, 7.999350607762709e-03,  2.030631317170362e-02, 3.270479954440206e-02, -4.710504837555898e-02, 9.279344939797503e-02, -6.720198537515562e-03, -1.273159693907171e-02, 2.058494900438641e-02, 3.312885992386676e-02,  9.475526628285946e-03, 2.711111622368005e-03, 4.070049687831349e-05, 1.179376006956377e-02, -3.657033739658004e-03, 2.219684136537133e-02, -6.720198537515546e-03, 3.894896881400247e-02,  3.149892372042211e-03,
                  -1.460355784966661e-02, 2.666011403831368e-02, -1.127896245681001e-02, -6.854339555891591e-03, -2.549578119014987e-02, 3.986566678782996e-02, 5.938464998557165e-03,  5.368560449397334e-04, -1.273159693907174e-02, 3.149892372042204e-03, 1.018170468054573e-01, -1.709189555155633e-03, 8.014032426555734e-04, -4.906542995438638e-02, -2.879042545150244e-03,  6.035440064123564e-03, -1.182016672218517e-02, 8.902782078049952e-03, -2.956636324610938e-02,  2.058494900438639e-02, -1.460355784966658e-02, -1.709189555155575e-03, 5.645446497955155e-02, -2.263796678760948e-02, 3.474600442637909e-03, -3.501385014471716e-03, 2.869065163689814e-04,  5.639976018396740e-02, 2.531102411161068e-02, 3.584280821889744e-02, 3.312885992386674e-02,  2.666011403831362e-02, 8.014032426555440e-04, -2.263796678760950e-02, 1.492568914946957e-01, -3.227736858922311e-02, 5.177171543503421e-03, -5.574506551881088e-04, -3.725311943312803e-02,  1.329288937627490e-03, -2.545402511182776e-02, 9.475526628285937e-03, -1.127896245681003e-02, -4.906542995438642e-02, 3.474600442637954e-03, -3.227736858922309e-02, 9.254220801363953e-02,  3.380727561646640e-02, 3.680309952802924e-02, 2.696923948313151e-02, -2.693805057397208e-04, -4.027512226908682e-02, 3.005879094694761e-02, -5.445297090655540e-03, -1.265828369185889e-02,  1.546372458487999e-02, -6.008971401405626e-03, 1.371701088746984e-02, 3.680309952802924e-02,  1.204804811014879e-01, 5.173212811699841e-02, -3.188131970687220e-02, -3.236049071277773e-02,  1.867543418742043e-02, -1.608420922818970e-04, -2.335192887944643e-02, 1.150440278053782e-02, -1.678873532008952e-03, 1.293357517735619e-03, 2.696923948313148e-02, 5.173212811699843e-02,  1.346007604101026e-01, -1.350960613032850e-02, -2.857648758960060e-02, 1.889034411683486e-02,  9.897187717965984e-03, 3.214109116309261e-02, -6.749463073634601e-03, 3.536339052329377e-02, -2.223828089943171e-02, -2.693805057397379e-04, -3.188131970687218e-02, -1.350960613032857e-02,  6.371849446526309e-02, -1.899364773047599e-02, 3.391165241671843e-02, -7.539504623570043e-03,  6.772466165778665e-03, 1.766706125701338e-02, 1.276514109727437e-02, 2.804721950256359e-04, -4.027512226908685e-02, -3.236049071277768e-02, -2.857648758960078e-02, -1.899364773047596e-02,  1.329631071771070e-01, -6.205684436677535e-02, 2.368024091860548e-02, -9.196002028419983e-03, -4.609124814247417e-02, 4.377860745093061e-02, -2.039578801489160e-02, 3.005879094694760e-02,  1.867543418742047e-02, 1.889034411683479e-02, 3.391165241671850e-02, -6.205684436677529e-02,  1.010366341330122e-01, -1.182481939595531e-02, -6.741034958481428e-03, 3.661417928206992e-02,  1.227232606557533e-02, 7.984878364909305e-03, -5.445297090655546e-03, -1.608420922819221e-04,  9.897187717966006e-03, -7.539504623570063e-03, 2.368024091860549e-02, -1.182481939595531e-02,  3.916913546353131e-02, 2.053665437540363e-03, -1.784633465335705e-02, 2.354786186973352e-02, -9.320381031465820e-03, -1.265828369185889e-02, -2.335192887944643e-02, 3.214109116309259e-02,  6.772466165778651e-03, -9.196002028420030e-03, -6.741034958481445e-03, 2.053665437540361e-03,  9.481530845275973e-02, 3.237245520726604e-03, -4.530414230255052e-03, -3.690173201231776e-02,  1.546372458487992e-02, 1.150440278053781e-02, -6.749463073634714e-03, 1.766706125701334e-02, -4.609124814247416e-02, 3.661417928206991e-02, -1.784633465335703e-02, 3.237245520726663e-03,  7.139111659629757e-02, -2.551322679369305e-02, -4.031641809422969e-05, -6.008971401405613e-03, -1.678873532008966e-03, 3.536339052329382e-02, 1.276514109727434e-02, 4.377860745093052e-02,  1.227232606557530e-02, 2.354786186973351e-02, -4.530414230255072e-03, -2.551322679369307e-02,  1.223994709333914e-01, -2.378640117612615e-02, 1.371701088746983e-02, 1.293357517735645e-03, -2.223828089943168e-02, 2.804721950256230e-04, -2.039578801489152e-02, 7.984878364909317e-03, -9.320381031465827e-03, -3.690173201231769e-02, -4.031641809407746e-05, -2.378640117612612e-02,  7.981382883035322e-02, 2.683641577259500e-02, 2.825336828727212e-02, 2.135705007862940e-02, -3.638598335847149e-03, -2.244015101749599e-02, 1.952918091716718e-02, -1.249442177266976e-04, -1.868811564450630e-02, 3.696548521564930e-03, 3.991164919358046e-03, 1.527156388837348e-02,  2.825336828727212e-02, 1.260232104188061e-01, 6.151682801411527e-02, -3.746408272627672e-02, -3.698501502032870e-02, 1.915704066784367e-02, -3.088434485218360e-05, -2.076599239959747e-02,  2.175350619734702e-03, 2.863868719989077e-03, 3.182572530665074e-03, 2.135705007862938e-02,  6.151682801411525e-02, 1.600488763414942e-01, -1.766338849961296e-02, -4.234127965109208e-02,  2.581868644670518e-02, 8.693096650313897e-03, 4.618560488234662e-02, -1.708228369404466e-02,  4.499915819668455e-02, -2.695482439971637e-02, -3.638598335847162e-03, -3.746408272627675e-02, -1.766338849961301e-02, 6.705382785816799e-02, -1.038635017030817e-02, 3.183546044981519e-02, -4.470524295744183e-03, 3.462171811838902e-03, 1.571570470886371e-02, 2.025913895413798e-02, -9.356574036059233e-04, -2.244015101749604e-02, -3.698501502032867e-02, -4.234127965109220e-02, -1.038635017030818e-02, 1.322639213912288e-01, -5.685120096003794e-02, 2.071553563776951e-02, -1.607840811538316e-02, -3.411446202298188e-02, 3.465700309489346e-02, -1.797310982442395e-02,  1.952918091716717e-02, 1.915704066784369e-02, 2.581868644670516e-02, 3.183546044981522e-02, -5.685120096003798e-02, 1.052652438942341e-01, -7.275342777994969e-03, -6.646326234003594e-03,  2.965103474607857e-02, 2.959531219481612e-02, 4.359711543439836e-03, -1.249442177266963e-04, -3.088434485219206e-05, 8.693096650313882e-03, -4.470524295744190e-03, 2.071553563776956e-02, -7.275342777994999e-03, 4.078878885829888e-02, 5.634218242036289e-04, -1.571748462897937e-02,  2.460366666552339e-02, -8.852322009026916e-03, -1.868811564450631e-02, -2.076599239959747e-02,  4.618560488234663e-02, 3.462171811838901e-03, -1.607840811538321e-02, -6.646326234003607e-03,  5.634218242036254e-04, 1.102220528759066e-01, -1.400395733062985e-03, -5.114734440548563e-03, -4.120543160051287e-02, 3.696548521564896e-03, 2.175350619734699e-03, -1.708228369404470e-02,  1.571570470886375e-02, -3.411446202298172e-02, 2.965103474607870e-02, -1.571748462897933e-02, -1.400395733062965e-03, 7.004493789718029e-02, -2.237439061795014e-02, 2.445754549260442e-03,  3.991164919358077e-03, 2.863868719989061e-03, 4.499915819668467e-02, 2.025913895413794e-02,  3.465700309489340e-02, 2.959531219481615e-02, 2.460366666552339e-02, -5.114734440548586e-03, -2.237439061795003e-02, 1.414719991093310e-01, -2.829295710875137e-02, 1.527156388837346e-02,  3.182572530665081e-03, -2.695482439971638e-02, -9.356574036059114e-04, -1.797310982442391e-02,  4.359711543439841e-03, -8.852322009026930e-03, -4.120543160051286e-02, 2.445754549260442e-03, -2.829295710875139e-02, 8.548135002867441e-02, 1.627208863960632e-02, 1.087062911121375e-02,  7.551449649333787e-03, -5.054988924403485e-03, 2.032407758614060e-03, 4.004566298397361e-04,  3.377295983118285e-03, -2.038803870766538e-02, -9.239584521067462e-03, 7.948013190708855e-03,  1.761038238285418e-02, 1.087062911121375e-02, 8.438621040060285e-02, 3.298947691804500e-02, -2.470673632276759e-02, -7.156223685213049e-03, 6.412598918187237e-03, 1.264792713247831e-03,
                  -2.219981680667128e-02, -6.475177737912593e-03, 6.655480413057052e-03, 3.773532182278301e-03,  7.551449649333787e-03, 3.298947691804500e-02, 9.971692479588373e-02, -1.237388440067656e-02, -1.638546020945753e-02, 7.965716565686507e-03, 4.964091529922243e-03, 1.202316121811543e-02, -1.736078454800686e-02, 2.120832603778726e-02, -4.373421405960553e-03, -5.054988924403485e-03, -2.470673632276759e-02, -1.237388440067656e-02, 5.710910274241915e-02, -7.876975115233777e-03,  1.905818730282215e-02, -1.940036254585266e-03, 3.361760309723919e-03, 1.016755293860911e-02,  1.633077710131408e-02, -9.318070642604509e-04, 2.032407758614060e-03, -7.156223685213049e-03, -1.638546020945753e-02, -7.876975115233777e-03, 8.750966773561039e-02, -3.294668442982165e-02,  1.305034948287852e-02, -6.788622135956371e-03, -1.622949271264129e-02, 1.314583768192394e-02, -1.549547814274559e-02, 4.004566298397361e-04, 6.412598918187237e-03, 7.965716565686507e-03,  1.905818730282215e-02, -3.294668442982165e-02, 8.077254416386116e-02, -3.994320422106748e-03, -1.477354453350589e-02, 1.435603826281399e-02, 2.371620975207003e-02, 1.301813115783914e-02,  3.377295983118285e-03, 1.264792713247831e-03, 4.964091529922243e-03, -1.940036254585266e-03,  1.305034948287852e-02, -3.994320422106748e-03, 4.331990251366367e-02, -4.755041937691281e-03, -1.425839283866478e-02, 1.745940684358170e-02, -1.839276041279691e-03, -2.038803870766538e-02, -2.219981680667128e-02, 1.202316121811543e-02, 3.361760309723919e-03, -6.788622135956371e-03, -1.477354453350589e-02, -4.755041937691281e-03, 1.031153312785534e-01, 8.677636517451015e-03, -2.443913221488006e-02, -3.787647624680424e-02, -9.239584521067462e-03, -6.475177737912593e-03, -1.736078454800686e-02, 1.016755293860911e-02, -1.622949271264129e-02, 1.435603826281399e-02, -1.425839283866478e-02, 8.677636517451015e-03, 6.755722909984260e-02, -1.490379117751969e-02, -5.118678157166717e-03, 7.948013190708855e-03, 6.655480413057052e-03, 2.120832603778726e-02,  1.633077710131408e-02, 1.314583768192394e-02, 2.371620975207003e-02, 1.745940684358170e-02, -2.443913221488006e-02, -1.490379117751969e-02, 1.010387031622568e-01, -1.850099153054458e-03,  1.761038238285418e-02, 3.773532182278301e-03, -4.373421405960553e-03, -9.318070642604509e-04, -1.549547814274559e-02, 1.301813115783914e-02, -1.839276041279691e-03, -3.787647624680424e-02, -5.118678157166717e-03, -1.850099153054458e-03, 8.313598118058804e-02 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$n_iter),
               c(17 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$Q),
               c( 0.344283320677639559, 0.339760763248456776, 0.059683350178017056, 0.062711499574381629, -0.588044011876352246,  0.402001989103761503, -0.197429251406877726, 0.168289903192653412, 0.498655666417470889, -0.417422360571012729, -0.144415843425523799, 0.339760763248456776, 0.964333962697984659, 0.860325655356766417, -0.008580467412225089, -1.113972871908802453, 0.850947792540276415, -0.201675587059733208, 0.132770395731105273, 0.460588119540018548, -0.042527378964981197, -0.100442333063329087, 0.059683350178017056, 0.860325655356766417, 2.145620391873459987, -0.029074440771360378, -0.187504353444950256, 0.587988920571977713, 0.374799525019666402, 0.622263552183638380, -0.399472629841662319, 1.686672130878233311, -0.824442677246249978, 0.062711499574381629, -0.008580467412225089, -0.029074440771360378, 0.546930641871623102, -0.993342345940653182, 1.003052922294819904, -0.286704044159066029, -0.116315644121816941, 0.524846896652394257, -0.008844304348196958, 0.282791420818745642, -0.588044011876352246, -1.113972871908802453, -0.187504353444950256, -0.993342345940653182, 4.175458047369183134, -3.035081965542147042,  1.288962900516970045, 0.191366994567999604, -2.134726021307737920, 1.630973963016969730, -1.056090738436220366,  0.402001989103761503, 0.850947792540276415, 0.587988920571977713, 1.003052922294819904, -3.035081965542147042,  2.690400531695471109, -0.801782328136036115, -0.174901011626292013, 1.472559412034324389, -0.286827868298745292,  0.604485975652428231, -0.197429251406877726, -0.201675587059733208, 0.374799525019666402, -0.286704044159066029,  1.288962900516970045, -0.801782328136036115, 0.501145605272269590, 0.149527488998639935, -0.777264303945725321,  0.936039242695782869, -0.476213991126652747, 0.168289903192653412, 0.132770395731105273, 0.622263552183638380, -0.116315644121816941, 0.191366994567999604, -0.174901011626292013, 0.149527488998639935, 0.632908242948306499, -0.068460365242271004, 0.229194189181257557, -0.645709701162157979, 0.498655666417470889, 0.460588119540018548, -0.399472629841662319, 0.524846896652394257, -2.134726021307737920, 1.472559412034324389, -0.777264303945725321, -0.068460365242271004, 1.406586003295972276, -1.352827201354803499, 0.487986525040723151, -0.417422360571012729, -0.042527378964981197, 1.686672130878233311, -0.008844304348196958, 1.630973963016969730, -0.286827868298745292,  0.936039242695782869, 0.229194189181257557, -1.352827201354803499, 2.948763056983269681, -0.910069272153356756, -0.144415843425523799, -0.100442333063329087, -0.824442677246249978, 0.282791420818745642, -1.056090738436220366,  0.604485975652428231, -0.476213991126652747, -0.645709701162157979, 0.487986525040723151, -0.910069272153356756,  1.023911608657775085 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$Q_0),
               c(10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0,  0, 0, 0, 0, 0, 0, 0, 0, 0, 10 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$n_risk),
               c(2008, 2002, 1911, 1807, 1726, 1555, 1453, 1320, 1159, 1022 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$risk_set),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$data),
               c(NULL )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$order),
               c(1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$method),
               c("EKF" )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$model),
               c("exponential" )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE )
               , tolerance = 1e-05)

  expect_equal(c(result_exp$LR),
               c(0.2962962962962963 )
               , tolerance = 1e-05)
})

test_that("Unmacthed control variable throw error",
          expect_error({
            result = ddhazard(
              formula = survival::Surv(start, stop, event) ~ group,
              data = head_neck_cancer,
              by = 1, # Use by month intervals
              a_0 = rep(0, 2), Q_0 = diag(1, 2), # Initial value
              max_T = 45,
              id = head_neck_cancer$id, order = 1,
              control = list("None_existing_parem" = 1)
            )}, regexp = "These control parameters are not recognized"))

#############
# Test ukf for exponential model
test_that("UKF and exp models give previous computed results with exponential estimation method",{
  suppressMessages(result_exp <- ddhazard(
    formula = survival::Surv(start, stop, event) ~ group,
    data = head_neck_cancer,
    by = 1,
    Q_0 = diag(1, 2),
    Q = diag(1e-1, 2),
    control = list(est_Q_0 = F, n_max = 10^4, eps = 10^-4,
                   method = "UKF", beta = 0, alpha = 1, save_risk_set = F,
                   save_data = F),
    max_T = 30,
    id = head_neck_cancer$id, order = 1,
    verbose = F,
    model = "exponential"))

  # plot(result_exp, cov_index = 1)
  # get_expect_equal(result_exp, file = "tmp.txt")

  expect_equal(c(result_exp$state_vecs),
               c(-3.69824910038536681, -3.69826065307419105, -3.26859707903190611, -2.95268233222984611, -2.77543499709954977, -2.30794811268055700, -2.42439356837259012, -2.81149408862572647, -2.96604835642004883, -3.07858919668809561, -3.20063414968332038, -3.41926978204197374, -3.52994455186449541, -3.55641905123767721, -3.37491862878595850, -3.44499480899945176, -3.58227233617389818, -3.68103585148111367, -3.63065354518771377, -3.71200873204608328, -3.67032845288164422, -3.81395837158664808, -3.99381412724516816, -4.11150917245706715, -4.16695822942270855, -4.28767616986713485, -4.36004225410994461, -4.38670995220066917, -4.49278911604918907, -4.56290234223730184, -4.59769109320577751, 0.11807985586911025, 0.11808530336174596, 0.27632089931661302, 0.39441596880613600,  0.44475387808013933, 0.62553592624579213, 0.58700138241384914, 0.44698311793234968, 0.41573489470184921,  0.38651047757107021, 0.35020473931936630, 0.27393947697249116, 0.24291147143516253, 0.24814219767729603,  0.32890209135425325, 0.30181476068198732, 0.24962479163596751, 0.21627433894170778, 0.23651753893562372,  0.20830070281157384, 0.22414450177235412, 0.16171554778759148, 0.09051806014666031, 0.04117246851472023,  0.01374834998307983, -0.03268537836081864, -0.06211552824670100, -0.07542661687135926, -0.11279018769181048, -0.13746377408854771, -0.14969203785384111 ))

  expect_equal(c(result_exp$state_vars),
               c( 0.2564700426806703071, 0.0193186468689041067, 0.0193186468689036800, 0.1460679280286585335,  0.1728246489568892597, -0.0103853264130547573, -0.0103853264130552569, 0.1245967614459552730,  0.1636068616711931767, -0.0111959308819632730, -0.0111959308819639114, 0.1157155704057426515,  0.1365216670876577831, -0.0195022107404757561, -0.0195022107404763667, 0.1040987073854811595,  0.1088375823506339268, -0.0295253088367425226, -0.0295253088367430361, 0.0922122755274398243,  0.0999342564870863564, -0.0282906762882705470, -0.0282906762882710328, 0.0878067097506801952,  0.0761398448221971558, -0.0355081971451097628, -0.0355081971451101652, 0.0807934996775148823,  0.0812534168716248228, -0.0315515210821908920, -0.0315515210821913500, 0.0824053001504273380,  0.0979061630803494398, -0.0233180542765690779, -0.0233180542765695636, 0.0887772943842919937,  0.1091170148401460760, -0.0190664945155813240, -0.0190664945155818374, 0.0944788549118243948,  0.1182914827457968998, -0.0162006846878412492, -0.0162006846878417522, 0.1005302060185183921,  0.1282544104358352977, -0.0131465079714294733, -0.0131465079714299625, 0.1075358609811898902,  0.1460849851380808251, -0.0071849005684081965, -0.0071849005684086944, 0.1164908309144385978,  0.1610515286206129770, -0.0029014446928423386, -0.0029014446928428174, 0.1250620445695320437,  0.1714332977747100861, -0.0009241896977249184, -0.0009241896977254145, 0.1328601799079411339,  0.1633019047119910749, -0.0065095597550550131, -0.0065095597550555214, 0.1376802972770761468,  0.1665792881782757751, -0.0079532327386078842, -0.0079532327386084081, 0.1446630721132587949,  0.1800091224566259807, -0.0054513004701847341, -0.0054513004701852476, 0.1539260354743817172,  0.1959445847411625530, -0.0021116460115749511, -0.0021116460115754680, 0.1640443628399728127,  0.2029690571334170079, -0.0024857963115429149, -0.0024857963115434596, 0.1729761367209960432,  0.2137256119087934947, -0.0015423366061816310, -0.0015423366061821930, 0.1828936731151880046,  0.2146132972968490260, -0.0045835080219415875, -0.0045835080219421738, 0.1915432375761303707,  0.2282835894504103291, -0.0030645417715430660, -0.0030645417715436454, 0.2025428104461669543,  0.2509516423207453495, 0.0020564607669640231, 0.0020564607669634610, 0.2156260536991032595,  0.2749757908163666942, 0.0075651377915518583, 0.0075651377915513171, 0.2292765668001862933,  0.2973751834460302002, 0.0121401558254466482, 0.0121401558254461209, 0.2428204459950295269,  0.3300729581246119038, 0.0201865451705297780, 0.0201865451705292437, 0.2579818829645606493,  0.3688951390670381913, 0.0302760385673999377, 0.0302760385673994034, 0.2741578304716998926,  0.4144867036031239516, 0.0424556108013083577, 0.0424556108013077957, 0.2912416011837608565,  0.4868508931419497920, 0.0640569472414180274, 0.0640569472414174584, 0.3120384092986653313,  0.5895922959581253453, 0.0961793387860182258, 0.0961793387860176568, 0.3368047533002774263 ))

  expect_equal(c(result_exp$lag_one_cov),
               c(NULL ))

  expect_equal(c(result_exp$fixed_effects),
               c(numeric(0) ))

  expect_equal(c(result_exp$n_iter),
               c(92 ))

  expect_equal(c(result_exp$Q),
               c(0.14161964589735906, 0.04550611673022104, 0.04550611673022104, 0.02948981054928508 ))

  expect_equal(c(result_exp$Q_0),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$n_risk),
               c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18 ))

  expect_equal(c(result_exp$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30 ))

  expect_equal(c(result_exp$risk_set),
               c(NULL ))

  expect_equal(c(result_exp$data),
               c(NULL ))

  expect_equal(c(result_exp$order),
               c(1 ))

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$method),
               c("UKF" ))

  expect_equal(c(result_exp$model),
               c("exponential" ))

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE ))

  expect_equal(c(result_exp$LR),
               c(1 ))




  set.seed(44334)
  sims <- test_sim_func_exp(n_series = 1e3, n_vars = 10, t_0 = 0, t_max = 10,
                            x_range = 1, x_mean = 0, re_draw = T, beta_start = 0,
                            intercept_start = -5, sds = c(.1, rep(1, 10)))
  # sum(sims$res$event)

  arg_list <- list(
    formula = survival::Surv(tstart, tstop, event) ~ . - id - tstart - tstop - event,
    data = sims$res,
    by = (by_ <- 1),
    Q_0 = diag(1, 11),
    Q = diag(1e-2, 11),
    control = list(est_Q_0 = F, n_max = 10^2, eps = 10^-2,
                   method = "UKF", beta = 0, save_risk_set = F,
                   save_data = F, alpha = 1),
    max_T = 10,
    id = sims$res$id, order = 1,
    model = "exponential")

  suppressWarnings(suppressMessages(fit <- do.call(ddhazard, arg_list)))

  # matplot(fit$state_vecs, lty = 2, type = "l", ylim = range(fit$state_vecs, sims$betas))
  # matplot(sims$betas, lty = 1, add = T, type = "l")
  # get_expect_equal(fit, eps = 1e-6, file = "tmp.txt")

  expect_equal(c(fit$state_vecs),
               c(-6.302164838084285847, -6.328387637706514468, -6.157029716573553912, -5.830199259756337682, -5.376843887696017177, -5.118497963768541936, -4.915648193430080859, -4.939935943736210255, -4.958895042773755257, -5.263003692236379649, -5.084068116366466938, 1.297076492251453939,  1.343545924957546323, 1.403598104125204804, 1.492157589432839604, 1.453580755348834241,  1.650296941939056516, 1.630660215537665714, 1.926816684592018047, 2.485143736786881608,  2.551082979984252930, 2.933984206899721503, 2.291351552960183557, 2.322018677464630976,  2.541799190005712195, 2.953020172196513915, 3.354203038466178288, 3.879904355145725070,  4.096576929046659821, 4.397960149187327694, 4.987518919771504855, 4.789465729023971718,  5.438269017019917939, -0.774337130267023332, -0.617925777248898078, -0.658161189688855286, -0.787952215542344625, -1.385208044071841949, -1.106273262900760779, -1.355689508162659873, -0.618043213695807725, 0.848068686101303926, 1.397540599672838724, 2.305450129036683560, -1.276859889971118101, -1.177620997369469791, -1.389850096052450912, -1.833572871831836926, -2.634304520872052358, -2.842353204299562286, -3.233899250026807337, -2.939446557668547566, -2.268679944300413975, -1.659453716721148275, -1.373395153928361756, 0.639311871686462196,  0.766343589194278696, 0.699927598999546152, 0.512780712861029997, -0.032593310505455775,  0.126176461675282570, -0.129038299486466057, 0.358650198477258542, 1.445128781794596806,  1.976794150513310200, 2.826790776254141768, -0.558038572378460551, -0.469416526418691971, -0.457333589063296964, -0.472329242140386962, -0.730690905515632538, -0.517937081856297166, -0.656132058843581945, -0.252124210082837252, 0.615055519051409094, 0.889180060709573894,  1.512639888209353467, -2.035314403605639644, -2.045706108293933401, -2.219386784518810440, -2.540548106561824504, -2.887979329417463159, -3.245138479255762487, -3.428071286465324441, -3.603343338369811910, -3.944020587228585839, -3.754592990167882505, -4.144356764881120370, -0.479738429255918197, -0.582215001861727255, -0.652400860918357695, -0.744863728925815316, -0.577524138260046893, -0.962898559539139276, -0.880555621211479900, -1.381746530581684063, -2.441075183313149211, -2.700166239989193695, -3.564179872277458472, 0.452180434784276053,  0.520983846202695555, 0.550809339839399614, 0.579652315593894407, 0.413013928502752092,  0.600486993394115709, 0.494942553672175378, 0.844409669547299124, 1.566990038801299168,  1.738776846423786493, 2.250113795468797750, -0.111054092006533600, -0.057096688825303554,  0.001755177022300658, 0.095134497347212243, 0.070622338558689268, 0.331924773520487493,  0.331671616160064742, 0.608434883645827540, 1.185773067601221920, 1.283322821634955702,  1.835721527664128327 )
               , tolerance = 1e-06)

  expect_equal(c(fit$state_vars),
               c( 1.472115833550215e-01, 1.505760475716545e-02, 1.013563282384531e-01, -4.517584163394598e-02, -1.111645070040310e-01, -3.815553214460138e-02, -1.245429268980717e-03, -7.688743386254020e-02, -2.839844614670469e-02, 6.105050211549480e-03, 3.124588892287238e-02, 1.505760475716469e-02,  1.322430010778387e-01, 5.597745233824656e-02, 7.644976721587193e-02, 1.590298039048380e-03,  3.544232977923787e-02, 4.387487643946047e-02, -4.277609747922718e-02, -5.915158826920890e-02,  4.444195014189882e-02, 3.173507523755507e-02, 1.013563282384493e-01, 5.597745233824585e-02,  2.935906538279910e-01, 4.795614136546019e-02, -9.707853423010521e-02, 1.218218563522449e-02,  4.347763305004107e-02, -1.151827065309550e-01, -9.039392502098526e-02, 4.459614530475789e-02,  6.601431723756243e-02, -4.517584163394751e-02, 7.644976721587222e-02, 4.795614136546044e-02,  3.313227974344526e-01, 1.282034309870118e-01, 1.529741989342588e-01, 1.203626815947360e-01, -1.680066071178211e-02, -1.355229046928074e-01, 9.333239166415551e-02, 6.597600472622661e-02, -1.111645070040304e-01, 1.590298039048210e-03, -9.707853423010510e-02, 1.282034309870116e-01,  3.148570074781610e-01, 1.274323776059956e-01, 5.752930685226863e-02, 8.324911517769734e-02, -3.264184682620733e-02, 3.593624458268284e-02, 4.281936407614224e-03, -3.815553214459885e-02,  3.544232977923861e-02, 1.218218563522457e-02, 1.529741989342589e-01, 1.274323776059952e-01,  2.793929456799362e-01, 9.439968970672709e-02, 6.630519280118877e-03, -1.090372161571453e-01,  6.952334898124457e-02, 6.804152518238106e-02, -1.245429268981416e-03, 4.387487643946043e-02,  4.347763305004036e-02, 1.203626815947362e-01, 5.752930685226923e-02, 9.439968970672737e-02,  1.875516976092533e-01, -2.354291991954453e-02, -8.999096627144346e-02, 6.126890751540936e-02,  4.984913178398881e-02, -7.688743386253588e-02, -4.277609747922695e-02, -1.151827065309536e-01, -1.680066071178287e-02, 8.324911517769877e-02, 6.630519280119292e-03, -2.354291991954533e-02,  2.235570172997681e-01, 5.551473177690689e-02, -2.783528074090737e-02, -4.719569371807025e-02, -2.839844614670388e-02, -5.915158826920824e-02, -9.039392502098482e-02, -1.355229046928073e-01, -3.264184682620733e-02, -1.090372161571452e-01, -8.999096627144341e-02, 5.551473177690704e-02,  2.378700388612210e-01, -7.313120762354777e-02, -7.336664727595341e-02, 6.105050211550026e-03,  4.444195014189890e-02, 4.459614530475767e-02, 9.333239166415577e-02, 3.593624458268276e-02,  6.952334898124402e-02, 6.126890751541025e-02, -2.783528074090728e-02, -7.313120762354743e-02,  1.693244144492548e-01, 3.411654852845031e-02, 3.124588892287256e-02, 3.173507523755524e-02,  6.601431723756278e-02, 6.597600472622667e-02, 4.281936407614454e-03, 6.804152518238092e-02,  4.984913178398895e-02, -4.719569371806934e-02, -7.336664727595316e-02, 3.411654852845034e-02,  1.633107098808984e-01, 1.242801772367029e-01, 8.879528026008665e-03, 8.575644214055125e-02, -4.994860110127915e-02, -1.080345491432658e-01, -4.714531422398757e-02, -8.445866246994034e-03, -6.698709735909592e-02, -1.590417659879059e-02, -1.280308483451374e-03, 2.274269318640200e-02,  8.879528026006979e-03, 1.381862838521560e-01, 6.874767520494159e-02, 1.165247648478649e-01,  2.699905730535607e-02, 7.305501293478187e-02, 7.023423191473216e-02, -4.859404842648869e-02, -9.041261961368738e-02, 6.380211270066705e-02, 5.014060294915067e-02, 8.575644214054504e-02,  6.874767520494096e-02, 2.965641817444696e-01, 8.950493651502719e-02, -7.205565410270073e-02,  4.500353483355531e-02, 6.911967040832209e-02, -1.198916745608890e-01, -1.182601255212389e-01,  6.363533645357582e-02, 8.166841821957135e-02, -4.994860110128251e-02, 1.165247648478652e-01,  8.950493651502638e-02, 4.332950490055754e-01, 1.950140812543256e-01, 2.552516284651314e-01,  1.940038188400578e-01, -3.759590473094671e-02, -2.235508060953134e-01, 1.512130545405984e-01,  1.170012326927742e-01, -1.080345491432644e-01, 2.699905730535591e-02, -7.205565410270112e-02,  1.950140812543247e-01, 3.499447917608310e-01, 1.884172426075074e-01, 1.008877335923316e-01,  7.145995445297670e-02, -8.524641334011321e-02, 7.086874166696647e-02, 3.381001940611084e-02, -4.714531422398559e-02, 7.305501293478280e-02, 4.500353483355535e-02, 2.552516284651314e-01,  1.884172426075069e-01, 3.576170543680186e-01, 1.584577151598390e-01, -9.545498916357299e-03, -1.834771461214230e-01, 1.207685380500744e-01, 1.088905621627904e-01, -8.445866246996227e-03,  7.023423191473195e-02, 6.911967040832048e-02, 1.940038188400580e-01, 1.008877335923328e-01,  1.584577151598393e-01, 2.281928136803016e-01, -3.638509055698280e-02, -1.457289273579238e-01,  9.792911508952215e-02, 8.165685801727407e-02, -6.698709735908960e-02, -4.859404842648838e-02, -1.198916745608872e-01, -3.759590473094818e-02, 7.145995445297758e-02, -9.545498916356860e-03, -3.638509055698418e-02, 2.198771939007030e-01, 6.952718013788677e-02, -3.687857584747906e-02, -5.552823648450727e-02, -1.590417659878788e-02, -9.041261961368659e-02, -1.182601255212379e-01, -2.235508060953132e-01, -8.524641334011349e-02, -1.834771461214226e-01, -1.457289273579239e-01,  6.952718013788667e-02, 2.959833948258731e-01, -1.168053002327258e-01, -1.096984465443804e-01, -1.280308483451804e-03, 6.380211270066709e-02, 6.363533645357534e-02, 1.512130545405986e-01,  7.086874166696647e-02, 1.207685380500737e-01, 9.792911508952316e-02, -3.687857584747890e-02, -1.168053002327255e-01, 1.905717124814498e-01, 5.922357690085914e-02, 2.274269318640099e-02,  5.014060294915081e-02, 8.166841821957144e-02, 1.170012326927745e-01, 3.381001940611124e-02,  1.088905621627901e-01, 8.165685801727440e-02, -5.552823648450632e-02, -1.096984465443802e-01,  5.922357690085917e-02, 1.767093090087491e-01, 1.001740223412022e-01, 3.814988645278117e-03,  6.799114033751140e-02, -4.771610539710239e-02, -9.618896786064207e-02, -4.868184907811995e-02, -1.159138303283657e-02, -5.441900797909595e-02, -7.483469037843256e-03, -5.442881420166530e-03,  1.583615920316889e-02, 3.814988645276421e-03, 1.318525179776694e-01, 6.693758044591754e-02,  1.215155888878205e-01, 3.458163075020231e-02, 8.186266666375897e-02, 7.428332151139150e-02, -4.641812721848376e-02, -9.545467560099608e-02, 6.614275075807433e-02, 5.288379552592729e-02,  6.799114033750510e-02, 6.693758044591683e-02, 2.776199522731805e-01, 9.541216814312455e-02, -5.836597355711220e-02, 5.031248619235770e-02, 7.131579539442470e-02, -1.105784883388540e-01, -1.171944381470598e-01, 6.466999426370629e-02, 7.904425581036033e-02, -4.771610539710572e-02,  1.215155888878207e-01, 9.541216814312393e-02, 4.301037166037883e-01, 2.005293951796855e-01,  2.689941772525632e-01, 2.015822676723294e-01, -4.097884253152582e-02, -2.352976230466269e-01,  1.587087565584569e-01, 1.237328289307549e-01, -9.618896786064074e-02, 3.458163075020219e-02, -5.836597355711257e-02, 2.005293951796847e-01, 3.417400988405563e-01, 1.965716941038935e-01,  1.073179427508383e-01, 6.233122105036309e-02, -9.682969703116254e-02, 7.777260111720025e-02,  4.088767500783676e-02, -4.868184907811804e-02, 8.186266666375999e-02, 5.031248619235791e-02,  2.689941772525633e-01, 1.965716941038930e-01, 3.621276000626279e-01, 1.677806802980802e-01, -1.292476474662188e-02, -1.950795553743062e-01, 1.302922816606034e-01,
                  1.136140475103987e-01, -1.159138303283881e-02, 7.428332151139122e-02, 7.131579539442311e-02, 2.015822676723295e-01,  1.073179427508396e-01, 1.677806802980805e-01, 2.277378795570751e-01, -3.734483661890378e-02, -1.534784730961041e-01, 1.030046037476567e-01, 8.549665744832280e-02, -5.441900797908959e-02, -4.641812721848339e-02, -1.105784883388523e-01, -4.097884253152716e-02, 6.233122105036398e-02, -1.292476474662129e-02, -3.734483661890516e-02, 2.069717424139242e-01, 6.829685919892389e-02, -3.675093248831663e-02, -5.386256387842300e-02, -7.483469037840525e-03, -9.545467560099520e-02, -1.171944381470589e-01, -2.352976230466264e-01, -9.682969703116266e-02, -1.950795553743055e-01, -1.534784730961041e-01, 6.829685919892385e-02, 2.984070717793752e-01, -1.239109551867970e-01, -1.130584150613666e-01, -5.442881420167019e-03, 6.614275075807437e-02, 6.466999426370584e-02,  1.587087565584571e-01, 7.777260111720032e-02, 1.302922816606026e-01, 1.030046037476577e-01, -3.675093248831648e-02, -1.239109551867967e-01, 1.879861822788054e-01, 6.291731646947610e-02,  1.583615920316787e-02, 5.288379552592742e-02, 7.904425581036051e-02, 1.237328289307550e-01,  4.088767500783707e-02, 1.136140475103983e-01, 8.549665744832310e-02, -5.386256387842209e-02, -1.130584150613665e-01, 6.291731646947613e-02, 1.707419965292343e-01, 7.998771548071254e-02, -1.105963118035368e-03, 5.035513292335190e-02, -4.392489245864087e-02, -8.180973758067761e-02, -4.733728060443156e-02, -1.297876880111938e-02, -4.084632053201736e-02, -9.658157639346812e-04, -8.334794214031063e-03, 1.044629543519333e-02, -1.105963118037144e-03, 1.146631298564110e-01,  5.170991379301459e-02, 1.010174988160142e-01, 3.158451061675854e-02, 6.980360037337525e-02,  6.173096687642341e-02, -3.616125041739931e-02, -7.914476827046467e-02, 5.484264729168661e-02,  4.368308323468825e-02, 5.035513292334537e-02, 5.170991379301389e-02, 2.393724456011123e-01,  7.443107255141064e-02, -5.061038287974246e-02, 3.528094696041571e-02, 5.592404709763779e-02, -8.787848757155065e-02, -9.194716641051315e-02, 5.072550806404145e-02, 6.281944601299458e-02, -4.392489245864422e-02, 1.010174988160144e-01, 7.443107255141010e-02, 3.642737557517939e-01,  1.730023734941163e-01, 2.284418114286818e-01, 1.677614838798943e-01, -3.007453464643144e-02, -1.956526865460322e-01, 1.327792856019161e-01, 1.018295980737775e-01, -8.180973758067636e-02,  3.158451061675838e-02, -5.061038287974300e-02, 1.730023734941156e-01, 3.089888646116117e-01,  1.743502415460600e-01, 9.255180037035765e-02, 5.366491272637139e-02, -8.440152250279687e-02,  6.837794959873920e-02, 3.486306093392898e-02, -4.733728060442989e-02, 6.980360037337635e-02,  3.528094696041582e-02, 2.284418114286823e-01, 1.743502415460597e-01, 3.200035028300728e-01,  1.420357111831073e-01, -6.132342887621000e-03, -1.638889222145079e-01, 1.118252786080058e-01,  9.469349994134946e-02, -1.297876880112170e-02, 6.173096687642315e-02, 5.592404709763626e-02,  1.677614838798945e-01, 9.255180037035900e-02, 1.420357111831076e-01, 2.005811710949646e-01, -2.870257883637316e-02, -1.279099321831229e-01, 8.641743134888380e-02, 7.086289954514496e-02, -4.084632053201095e-02, -3.616125041739901e-02, -8.787848757154910e-02, -3.007453464643271e-02,  5.366491272637226e-02, -6.132342887620480e-03, -2.870257883637456e-02, 1.846015759274138e-01,  5.309373074749958e-02, -2.819560652300563e-02, -4.419180578141794e-02, -9.658157639318606e-04, -7.914476827046377e-02, -9.194716641051226e-02, -1.956526865460317e-01, -8.440152250279691e-02, -1.638889222145071e-01, -1.279099321831228e-01, 5.309373074749950e-02, 2.588803862237476e-01, -1.038923749218421e-01, -9.302320997419383e-02, -8.334794214031641e-03, 5.484264729168664e-02,  5.072550806404093e-02, 1.327792856019163e-01, 6.837794959873929e-02, 1.118252786080049e-01,  8.641743134888480e-02, -2.819560652300545e-02, -1.038923749218418e-01, 1.679600959583386e-01,  5.153386141093014e-02, 1.044629543519232e-02, 4.368308323468845e-02, 6.281944601299495e-02,  1.018295980737776e-01, 3.486306093392919e-02, 9.469349994134899e-02, 7.086289954514526e-02, -4.419180578141706e-02, -9.302320997419372e-02, 5.153386141093019e-02, 1.519298196896339e-01,  6.699480793637386e-02, -4.240748143485025e-03, 3.834825998818691e-02, -4.121352949877784e-02, -7.081901916006558e-02, -4.417813973740918e-02, -1.324786061655314e-02, -3.103227302805252e-02,  2.537018067163378e-03, -1.057267630779977e-02, 7.966902451334419e-03, -4.240748143486885e-03,  9.791019572299736e-02, 3.799803674672161e-02, 8.037069113206113e-02, 2.726340939063815e-02,  5.739016704727994e-02, 4.931874862436778e-02, -2.713049875578558e-02, -6.296491631339596e-02,  4.313462375956431e-02, 3.516554650725962e-02, 3.834825998818025e-02, 3.799803674672093e-02,  2.056723156715211e-01, 5.420051391666508e-02, -4.398069594852706e-02, 2.299088481181306e-02,  4.232639417500744e-02, -6.778000755418354e-02, -6.935292482333866e-02, 3.703298744827678e-02,  4.956835903245765e-02, -4.121352949878120e-02, 8.037069113206152e-02, 5.420051391666478e-02,  3.030837751552358e-01, 1.459175036077556e-01, 1.875689281394039e-01, 1.352639237875221e-01, -2.023082401686595e-02, -1.562235950774963e-01, 1.068101003563935e-01, 8.050494502310016e-02, -7.081901916006449e-02, 2.726340939063802e-02, -4.398069594852771e-02, 1.459175036077551e-01,  2.749967549573509e-01, 1.479906628207392e-01, 7.646738271124408e-02, 4.487462647597787e-02, -6.955749484221821e-02, 5.816778180150422e-02, 2.699959882716298e-02, -4.417813973740767e-02,  5.739016704728121e-02, 2.299088481181320e-02, 1.875689281394047e-01, 1.479906628207391e-01,  2.746617966937261e-01, 1.156246897544579e-01, -2.126339172088328e-03, -1.317451558431942e-01,  9.239058143711099e-02, 7.597351523703819e-02, -1.324786061655545e-02, 4.931874862436758e-02,  4.232639417500603e-02, 1.352639237875221e-01, 7.646738271124540e-02, 1.156246897544582e-01,  1.741198865802944e-01, -2.164283494282986e-02, -1.025870113011432e-01, 6.955905308158752e-02,  5.695500170291308e-02, -3.103227302804617e-02, -2.713049875578540e-02, -6.778000755418223e-02, -2.023082401686710e-02, 4.487462647597874e-02, -2.126339172087818e-03, -2.164283494283121e-02,  1.640120254074152e-01, 4.010795991875432e-02, -2.010771214794643e-02, -3.674950038454199e-02,  2.537018067166337e-03, -6.296491631339531e-02, -6.935292482333796e-02, -1.562235950774961e-01, -6.955749484221842e-02, -1.317451558431936e-01, -1.025870113011432e-01, 4.010795991875418e-02,  2.196322852551152e-01, -8.306202247826965e-02, -7.409496995300312e-02, -1.057267630780034e-02,  4.313462375956446e-02, 3.703298744827635e-02, 1.068101003563935e-01, 5.816778180150422e-02,  9.239058143711003e-02, 6.955905308158837e-02, -2.010771214794626e-02, -8.306202247826919e-02,  1.472776281120140e-01, 4.012652467595914e-02, 7.966902451333510e-03, 3.516554650725989e-02,  4.956835903245824e-02, 8.050494502310007e-02, 2.699959882716297e-02, 7.597351523703752e-02,  5.695500170291335e-02, -3.674950038454119e-02, -7.409496995300294e-02, 4.012652467595915e-02,  1.347489976525345e-01, 5.417002384267313e-02, -3.927291212878568e-03, 2.788805196112698e-02, -2.876794547203091e-02, -5.123811417336147e-02, -3.163407974200722e-02, -8.265405503035603e-03, -2.049141840498598e-02, -7.318629543449627e-04,
                  -9.133389930321921e-03, 8.583221697384229e-03, -3.927291212880556e-03, 8.293680680915280e-02, 2.721985467037254e-02, 5.918952759821115e-02,  2.090488374599128e-02, 4.376177832276094e-02, 3.591655596905971e-02, -1.971234391911566e-02, -4.706013792946991e-02, 3.135046800450789e-02, 2.640746470364383e-02, 2.788805196112039e-02,  2.721985467037216e-02, 1.732838072022203e-01, 3.938250050031132e-02, -3.106508283364515e-02,  1.571537034721314e-02, 3.025777691016381e-02, -4.602817003119891e-02, -4.976537191310149e-02,  2.452457843744817e-02, 3.673686114115952e-02, -2.876794547203437e-02, 5.918952759821176e-02,  3.938250050031085e-02, 2.294868439918051e-01, 1.035661001009127e-01, 1.320319109918419e-01,  9.343316625890660e-02, -1.502204091333240e-02, -1.091359592639344e-01, 7.590020892217768e-02,  5.453826808260289e-02, -5.123811417336085e-02, 2.090488374599114e-02, -3.106508283364629e-02,  1.035661001009125e-01, 2.219570390316974e-01, 1.054927690319860e-01, 5.177729230901001e-02,  2.915552398953824e-02, -4.712144648343818e-02, 4.332542983784406e-02, 1.587733795465347e-02, -3.163407974200631e-02, 4.376177832276226e-02, 1.571537034721262e-02, 1.320319109918429e-01,  1.054927690319862e-01, 2.145004396895539e-01, 7.954948584381900e-02, -2.782381382935363e-03, -9.145707922943190e-02, 6.754316094381069e-02, 5.266338046372938e-02, -8.265405503037861e-03,  3.591655596905965e-02, 3.025777691016234e-02, 9.343316625890644e-02, 5.177729230901113e-02,  7.954948584381905e-02, 1.411859854775934e-01, -1.597778517234588e-02, -7.113681951692195e-02,  4.865972675411553e-02, 3.917545444346116e-02, -2.049141840498001e-02, -1.971234391911561e-02, -4.602817003119793e-02, -1.502204091333327e-02, 2.915552398953928e-02, -2.782381382934946e-03, -1.597778517234707e-02, 1.409390538695096e-01, 2.892830313105178e-02, -1.277782011870926e-02, -2.922689096315124e-02, -7.318629543416898e-04, -4.706013792946952e-02, -4.976537191310043e-02, -1.091359592639346e-01, -4.712144648343881e-02, -9.145707922943175e-02, -7.113681951692215e-02,  2.892830313105146e-02, 1.760799391629751e-01, -5.881402378553070e-02, -5.186424402089738e-02, -9.133389930322418e-03, 3.135046800450812e-02, 2.452457843744762e-02, 7.590020892217759e-02,  4.332542983784379e-02, 6.754316094380948e-02, 4.865972675411628e-02, -1.277782011870919e-02, -5.881402378552991e-02, 1.246806648964187e-01, 2.628158878383252e-02, 8.583221697383417e-03,  2.640746470364419e-02, 3.673686114116012e-02, 5.453826808260262e-02, 1.587733795465330e-02,  5.266338046372852e-02, 3.917545444346138e-02, -2.922689096315047e-02, -5.186424402089713e-02,  2.628158878383254e-02, 1.154380135192625e-01, 4.758779778248708e-02, -6.492124153872698e-03,  1.674388974274655e-02, -3.056175377875786e-02, -4.318045158467746e-02, -3.206062895775978e-02, -1.224443053421699e-02, -1.128506617475611e-02, 7.625620458977625e-03, -1.331093335113002e-02,  3.358597033872801e-03, -6.492124153874837e-03, 6.922151857915504e-02, 1.640495176371161e-02,  4.349220835315386e-02, 1.948837986839263e-02, 3.390732950269180e-02, 2.581218480874219e-02, -1.195751983971302e-02, -3.390092908426443e-02, 2.158624167681578e-02, 1.880548597660679e-02,  1.674388974273969e-02, 1.640495176371128e-02, 1.425431748679787e-01, 2.613350376062185e-02, -1.748463871334165e-02, 7.297140697874158e-03, 1.808806914236251e-02, -2.482986130131562e-02, -2.764623139865414e-02, 1.217742285339716e-02, 2.260553046174564e-02, -3.056175377876211e-02,  4.349220835315442e-02, 2.613350376062062e-02, 1.933171042011346e-01, 9.067626230304887e-02,  1.058197912567479e-01, 7.351712698007387e-02, -7.689342690287196e-03, -8.615398713324456e-02,  5.886185564590665e-02, 4.042256227610662e-02, -4.318045158467749e-02, 1.948837986839223e-02, -1.748463871334369e-02, 9.067626230304787e-02, 1.950328536913567e-01, 8.975003421839349e-02,  4.586925491154576e-02, 1.614019529910192e-02, -4.739153685346549e-02, 4.030600693629226e-02,  1.612607704686022e-02, -3.206062895775943e-02, 3.390732950269280e-02, 7.297140697872946e-03,  1.058197912567484e-01, 8.975003421839392e-02, 1.809251939137032e-01, 6.133757286447084e-02,  3.288946975908017e-04, -7.082424196197616e-02, 5.375143251065509e-02, 3.894446311074162e-02, -1.224443053421952e-02, 2.581218480874201e-02, 1.808806914236081e-02, 7.351712698007359e-02,  4.586925491154709e-02, 6.133757286447111e-02, 1.219694396429672e-01, -8.252200264256569e-03, -5.335179258681960e-02, 3.607524011058991e-02, 2.795175333072839e-02, -1.128506617475044e-02, -1.195751983971314e-02, -2.482986130131526e-02, -7.689342690288456e-03, 1.614019529910289e-02,  3.288946975909205e-04, -8.252200264257967e-03, 1.197709474057058e-01, 1.370234144041739e-02, -4.393045290772606e-03, -1.961278067122586e-02, 7.625620458981536e-03, -3.390092908426391e-02, -2.764623139865258e-02, -8.615398713324519e-02, -4.739153685346700e-02, -7.082424196197666e-02, -5.335179258681995e-02, 1.370234144041649e-02, 1.466197607207137e-01, -4.307739456532714e-02, -3.563552503706313e-02, -1.331093335113091e-02, 2.158624167681593e-02, 1.217742285339622e-02,  5.886185564590660e-02, 4.030600693629248e-02, 5.375143251065417e-02, 3.607524011059073e-02, -4.393045290772196e-03, -4.307739456532619e-02, 1.082147606375205e-01, 1.639732399343544e-02,  3.358597033871715e-03, 1.880548597660715e-02, 2.260553046174605e-02, 4.042256227610654e-02,  1.612607704686041e-02, 3.894446311074103e-02, 2.795175333072867e-02, -1.961278067122479e-02, -3.563552503706287e-02, 1.639732399343554e-02, 9.960638803340871e-02, 3.977425049555824e-02, -4.909057589603233e-03, 6.391778000700803e-03, -1.986923666609029e-02, -2.445841043059895e-02, -2.477599322743951e-02, -6.090043436549321e-03, -1.613741692881915e-03, 8.951379900081827e-03, -8.838443555214305e-03, 1.115518497580701e-03, -4.909057589606048e-03, 5.847030478377167e-02,  1.156166415794443e-02, 2.958688269913927e-02, 1.462805380360611e-02, 2.537638588548212e-02,  1.757853077235914e-02, -7.733605629961161e-03, -2.328531934344724e-02, 1.506633391540303e-02,  1.256503862657442e-02, 6.391778000692484e-03, 1.156166415794486e-02, 1.203439533476015e-01,  2.966860115637317e-02, 4.731055921462330e-03, 1.016597584628590e-02, 1.848189529855856e-02, -6.361906397010295e-03, -1.576162369607499e-02, 1.211941982180137e-02, 1.355961236710742e-02, -1.986923666609532e-02, 2.958688269913961e-02, 2.966860115636988e-02, 1.589129547815845e-01,  6.240082372441887e-02, 8.264676072988650e-02, 5.248632252152769e-02, -1.034134958469471e-02, -6.841189265200644e-02, 4.471886863766095e-02, 3.027121875485470e-02, -2.445841043059896e-02,  1.462805380360485e-02, 4.731055921458069e-03, 6.240082372441637e-02, 1.491625488475658e-01,  6.692696293625459e-02, 2.861143812620504e-02, -3.202682932655979e-03, -4.357652617343546e-02,  2.949559295765090e-02, 1.579771220288643e-02, -2.477599322744000e-02, 2.537638588548282e-02,  1.016597584628261e-02, 8.264676072988719e-02, 6.692696293625651e-02, 1.561935597556875e-01,  4.378505004389942e-02, -2.263136250546267e-03, -5.614598699481562e-02, 4.286097236392435e-02,  2.976379479225734e-02, -6.090043436552247e-03, 1.757853077235901e-02, 1.848189529855601e-02,  5.248632252152771e-02, 2.861143812620724e-02, 4.378505004389998e-02, 1.040001054202313e-01, -8.437334190688921e-03,
                  -3.931798032998447e-02, 2.622127370733591e-02, 1.946927858262600e-02, -1.613741692874662e-03, -7.733605629961804e-03, -6.361906397009572e-03, -1.034134958469796e-02, -3.202682932657297e-03, -2.263136250548115e-03, -8.437334190691119e-03, 1.008364421908920e-01,  3.570909645764215e-03, -3.822087704644134e-03, -1.222150238177909e-02, 8.951379900087280e-03, -2.328531934344697e-02, -1.576162369607189e-02, -6.841189265200850e-02, -4.357652617343949e-02, -5.614598699481748e-02, -3.931798032998526e-02, 3.570909645762028e-03, 1.245648275118904e-01, -3.320038332788527e-02, -2.268856024455601e-02, -8.838443555216000e-03, 1.506633391540318e-02,  1.211941982179930e-02, 4.471886863766122e-02, 2.949559295765234e-02, 4.286097236392383e-02,  2.622127370733670e-02, -3.822087704642782e-03, -3.320038332788400e-02, 9.758132381537296e-02,  1.021780530058713e-02, 1.115518497578848e-03, 1.256503862657504e-02, 1.355961236710729e-02,  3.027121875485548e-02, 1.579771220288793e-02, 2.976379479225758e-02, 1.946927858262660e-02, -1.222150238177760e-02, -2.268856024455604e-02, 1.021780530058757e-02, 8.724804543062786e-02,  4.044018366314665e-02, -5.689552126582370e-03, 5.440150707093649e-03, -2.450328189712127e-02, -2.523036969228924e-02, -2.717609666589516e-02, -8.598272353540819e-03, -1.517759553404959e-03,  1.093024071569312e-02, -9.690108233345165e-03, -4.317473418875283e-04, -5.689552126585694e-03,  5.539602722403036e-02, 1.120440687941134e-02, 2.631880620075897e-02, 1.507804780506138e-02,  2.528476740249782e-02, 1.645842414302576e-02, -6.911453952826215e-03, -2.144183814133039e-02,  1.423144426143258e-02, 1.178603370617119e-02, 5.440150707084574e-03, 1.120440687941228e-02,  1.208265167857902e-01, 2.639556673129664e-02, 6.591046612323981e-03, 1.053338633007584e-02,  1.716009574351871e-02, -5.498077241965382e-03, -1.395454293241317e-02, 1.265486040061293e-02,  1.280647555091343e-02, -2.450328189712760e-02, 2.631880620075929e-02, 2.639556673129167e-02,  1.593071555664564e-01, 6.690716021048176e-02, 8.621359951607477e-02, 5.227488302962335e-02, -5.370286699121561e-03, -6.459547064936140e-02, 4.458582159356417e-02, 2.883971634951408e-02, -2.523036969228942e-02, 1.507804780505971e-02, 6.591046612318647e-03, 6.690716021047793e-02,  1.499015849300264e-01, 7.050628305100884e-02, 3.123766932152011e-02, -2.643722897895997e-03, -4.534519387287599e-02, 3.088100682465920e-02, 1.764117236920030e-02, -2.717609666589649e-02,  2.528476740249835e-02, 1.053338633007126e-02, 8.621359951607506e-02, 7.050628305101155e-02,  1.597492026296118e-01, 4.526077047718395e-02, -2.343877443867527e-05, -5.571081463214422e-02,  4.491301053992927e-02, 3.046955816476678e-02, -8.598272353544345e-03, 1.645842414302565e-02,  1.716009574351541e-02, 5.227488302962348e-02, 3.123766932152294e-02, 4.526077047718466e-02,  1.023433826481544e-01, -5.643450618231930e-03, -3.666151437030531e-02, 2.593679633625204e-02,  1.814063310191527e-02, -1.517759553397141e-03, -6.911453952827265e-03, -5.498077241964710e-03, -5.370286699126122e-03, -2.643722897898068e-03, -2.343877444147598e-05, -5.643450618234696e-03,  9.946725247261870e-02, 4.792317768498294e-04, -2.877107751804652e-03, -1.059347657127324e-02,  1.093024071569951e-02, -2.144183814133036e-02, -1.395454293240935e-02, -6.459547064936426e-02, -4.534519387288108e-02, -5.571081463214677e-02, -3.666151437030647e-02, 4.792317768470365e-04,  1.195414651291624e-01, -3.229631871568714e-02, -2.048672324593053e-02, -9.690108233347611e-03,  1.423144426143276e-02, 1.265486040060998e-02, 4.458582159356465e-02, 3.088100682466144e-02,  4.491301053992905e-02, 2.593679633625287e-02, -2.877107751802683e-03, -3.229631871568561e-02,  9.706464600886777e-02, 9.815147392345710e-03, -4.317473418899058e-04, 1.178603370617198e-02,  1.280647555091297e-02, 2.883971634951544e-02, 1.764117236920239e-02, 3.046955816476749e-02,  1.814063310191608e-02, -1.059347657127146e-02, -2.048672324593069e-02, 9.815147392346377e-03,  8.520943100420385e-02, 3.634045025100885e-02, -1.178813722826543e-02, -6.683526863904252e-03, -3.745104287970345e-02, -2.589920566404661e-02, -3.218423027928215e-02, -1.801112412801525e-02,  3.850023680698847e-03, 2.024528282034300e-02, -1.665244262679769e-02, -8.363118901739186e-03, -1.178813722826826e-02, 5.959051059382906e-02, 7.728760894931106e-03, 3.201619911387250e-02,  1.925258363548799e-02, 2.886664549570586e-02, 1.911233893620285e-02, -4.571255353099650e-03, -2.427509031317588e-02, 1.562964533647443e-02, 1.311908155713002e-02, -6.683526863912765e-03,  7.728760894931699e-03, 1.053130508580014e-01, 1.259970344313776e-02, 5.455631068531181e-03,  1.784419728724104e-03, 5.760374988938270e-03, 4.284260646994435e-03, -1.089931228224288e-03,  3.212343842670401e-03, 3.712409970428355e-03, -3.745104287970822e-02, 3.201619911387377e-02,  1.259970344313504e-02, 1.672377786248719e-01, 7.005228000526977e-02, 8.069190743717175e-02,  5.329985720071687e-02, 6.715009213763543e-03, -5.935757636695461e-02, 4.184359621700907e-02,  2.958598989282707e-02, -2.589920566404597e-02, 1.925258363548731e-02, 5.455631068527584e-03,  7.005228000526752e-02, 1.497825248994555e-01, 6.371342242347673e-02, 3.399563245349113e-02,  2.031617354091217e-03, -4.241965388781680e-02, 3.047231982060728e-02, 2.089901846649677e-02, -3.218423027928213e-02, 2.886664549570732e-02, 1.784419728721532e-03, 8.069190743717222e-02,  6.371342242347816e-02, 1.496911343226779e-01, 4.091065058946334e-02, 7.205501581034091e-03, -4.674228647967334e-02, 3.919870834226507e-02, 2.980682113692752e-02, -1.801112412801783e-02,  1.911233893620315e-02, 5.760374988936138e-03, 5.329985720071656e-02, 3.399563245349280e-02,  4.091065058946358e-02, 1.022912814062091e-01, 3.581544379907033e-03, -3.078352403757503e-02,  2.232598496936555e-02, 1.652542518945529e-02, 3.850023680706245e-03, -4.571255353100516e-03,  4.284260646994961e-03, 6.715009213760309e-03, 2.031617354090299e-03, 7.205501581032511e-03,  3.581544379904962e-03, 9.700957333520446e-02, -8.055501164305878e-03, 3.907860322815444e-03, -4.220045553518213e-03, 2.024528282034801e-02, -2.427509031317638e-02, -1.089931228222084e-03, -5.935757636695650e-02, -4.241965388781989e-02, -4.674228647967481e-02, -3.078352403757599e-02, -8.055501164307675e-03, 1.123928035561087e-01, -2.623134347244407e-02, -1.703365244050742e-02, -1.665244262679938e-02, 1.562964533647498e-02, 3.212343842668429e-03, 4.184359621700921e-02,  3.047231982060854e-02, 3.919870834226447e-02, 2.232598496936642e-02, 3.907860322816867e-03, -2.623134347244271e-02, 9.440879869584590e-02, 7.210768955000320e-03, -8.363118901740775e-03,  1.311908155713108e-02, 3.712409970428793e-03, 2.958598989282767e-02, 2.089901846649767e-02,  2.980682113692747e-02, 1.652542518945586e-02, -4.220045553516951e-03, -1.703365244050742e-02,  7.210768955000790e-03, 8.537342017967189e-02, 5.265156577506615e-02, -1.622468826570300e-02, -7.555483532873247e-04, -7.290085032143888e-02, -5.504976487171415e-02, -5.859826632937053e-02, -3.682744727466791e-02, -4.081505702246774e-03, 3.649428377657594e-02, -2.924117055848663e-02, -1.364289807445782e-02, -1.622468826570725e-02, 7.248845184394802e-02, 1.112055442237606e-02,  5.404216212842611e-02, 3.308588942890928e-02, 4.504989859880149e-02, 3.009034858093224e-02,
                  -8.955287591315156e-03, -3.753556906049446e-02, 2.436727821851602e-02, 2.058469058121068e-02, -7.555483532980523e-04, 1.112055442237760e-02, 1.174920293767681e-01, -3.210595427285717e-03, -1.044216593649468e-02, -1.058729789168172e-02, -5.091378699113025e-03, -5.819091026080025e-03,  5.482110514464289e-03, -4.264847635113339e-03, 4.477609868600935e-03, -7.290085032144718e-02,  5.404216212842627e-02, -3.210595427292323e-03, 2.686765814866989e-01, 1.514577121399375e-01,  1.562043646151672e-01, 9.974360561710788e-02, 1.811014742540021e-02, -1.042917809461671e-01,  7.234720546481371e-02, 5.095963031418288e-02, -5.504976487171456e-02, 3.308588942890683e-02, -1.044216593650161e-02, 1.514577121399317e-01, 2.282832899485158e-01, 1.318511561044592e-01,  7.756089094998719e-02, 1.779564211147663e-02, -8.180267906798827e-02, 5.901453474055762e-02,  3.774763524963830e-02, -5.859826632937327e-02, 4.504989859880182e-02, -1.058729789168772e-02,  1.562043646151668e-01, 1.318511561044632e-01, 2.223637243201100e-01, 7.939432648296235e-02,  1.679692156549394e-02, -8.598616855438329e-02, 6.402704413747604e-02, 4.962637997719521e-02, -3.682744727467268e-02, 3.009034858093207e-02, -5.091378699117188e-03, 9.974360561710810e-02,  7.756089094999122e-02, 7.939432648296352e-02, 1.300839236355415e-01, 1.078240779123019e-02, -5.202668792073883e-02, 3.639888622054821e-02, 2.686947705729717e-02, -4.081505702238003e-03, -8.955287591316821e-03, -5.819091026079859e-03, 1.811014742539399e-02, 1.779564211147348e-02,  1.679692156548979e-02, 1.078240779122648e-02, 1.138346685574581e-01, -1.007422517797102e-02,  7.365777938744072e-03, -6.504717017871989e-03, 3.649428377658401e-02, -3.753556906049474e-02,  5.482110514468702e-03, -1.042917809461707e-01, -8.180267906799493e-02, -8.598616855438673e-02, -5.202668792074039e-02, -1.007422517797471e-02, 1.410591101874901e-01, -3.962216634944751e-02, -3.019410288445679e-02, -2.924117055849023e-02, 2.436727821851629e-02, -4.264847635116947e-03,  7.234720546481466e-02, 5.901453474056106e-02, 6.402704413747648e-02, 3.639888622054929e-02,  7.365777938746820e-03, -3.962216634944593e-02, 1.092616863661102e-01, 1.346258926595950e-02, -1.364289807446105e-02, 2.058469058121176e-02, 4.477609868600407e-03, 5.095963031418471e-02,  3.774763524964120e-02, 4.962637997719649e-02, 2.686947705729825e-02, -6.504717017869852e-03, -3.019410288445709e-02, 1.346258926596031e-02, 9.936208309319197e-02 )
               , tolerance = 1e-06)

  expect_equal(c(fit$lag_one_cov),
               c(NULL )
               , tolerance = 1e-06)

  expect_equal(c(fit$fixed_effects),
               c(numeric(0) )
               , tolerance = 1e-06)

  expect_equal(c(fit$n_iter),
               c(11 )
               , tolerance = 1e-06)

  expect_equal(c(fit$Q),
               c( 0.119575869140911700, 0.013611204229399529, 0.125869148698204592, -0.083631709631014600, -0.164870525902215903, -0.080868498754861462, -0.025869203419010250, -0.099572819992982967, -0.007352826453151875, -0.009590682270304084, 0.022060511094574985, 0.013611204229399529,  0.107798796318125473, 0.127704468554047934, 0.247675582070318479, 0.092560805438537203,  0.186596476732013905, 0.150363685325693358, -0.076612552790585708, -0.193351353994069441,  0.125953190325715947, 0.110494056548745986, 0.125869148698204592, 0.127704468554047934,  0.281257285316639405, 0.207179583180008675, -0.053405825088173653, 0.141206026016875430,  0.149292543582566439, -0.186398337304777784, -0.233856287790401712, 0.134749602811064018,  0.152195834201775654, -0.083631709631014600, 0.247675582070318479, 0.207179583180008675,  0.759341178122163285, 0.428092504590541878, 0.596098627266000380, 0.432117472180436502, -0.096174962071602643, -0.514276100106143330, 0.344863964944465029, 0.277423776089542551, -0.164870525902215903, 0.092560805438537203, -0.053405825088173653, 0.428092504590541878,  0.393613059655022579, 0.368011517906261409, 0.225545368104618782, 0.073241286889005663, -0.224511145733541750, 0.166904610267078979, 0.101930253207195176, -0.080868498754861462,  0.186596476732013905, 0.141206026016875430, 0.596098627266000380, 0.368011517906261409,  0.503748791794937034, 0.345410283099346460, -0.056858429988516555, -0.407291255953391440,  0.271667416489525304, 0.220427461925745333, -0.025869203419010250, 0.150363685325693358,  0.149292543582566439, 0.432117472180436502, 0.225545368104618782, 0.345410283099346460,  0.263438620086883013, -0.077200037531123464, -0.311814004043719284, 0.206049579314468684,  0.172388533664153548, -0.099572819992982967, -0.076612552790585708, -0.186398337304777784, -0.096174962071602643, 0.073241286889005663, -0.056858429988516555, -0.077200037531123464,  0.139662368986257751, 0.132926631796574601, -0.073765801112096602, -0.090397475057201110, -0.007352826453151875, -0.193351353994069441, -0.233856287790401712, -0.514276100106143330, -0.224511145733541750, -0.407291255953391440, -0.311814004043719284, 0.132926631796574601,  0.404050706880229982, -0.254522321448895306, -0.225894529801197230, -0.009590682270304084,  0.125953190325715947, 0.134749602811064018, 0.344863964944465029, 0.166904610267078979,  0.271667416489525304, 0.206049579314468684, -0.073765801112096602, -0.254522321448895306,  0.176739044659575129, 0.141826462756243721, 0.022060511094574985, 0.110494056548745986,  0.152195834201775654, 0.277423776089542551, 0.101930253207195176, 0.220427461925745333,  0.172388533664153548, -0.090397475057201110, -0.225894529801197230, 0.141826462756243721,  0.140848157446718442 )
               , tolerance = 1e-06)

  expect_equal(c(fit$Q_0),
               c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 )
               , tolerance = 1e-06)

  expect_equal(c(fit$n_risk),
               c(2027, 1978, 1915, 1980, 1912, 1863, 1802, 1661, 1621, 1535 )
               , tolerance = 1e-06)

  expect_equal(c(fit$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 )
               , tolerance = 1e-06)

  expect_equal(c(fit$risk_set),
               c(NULL )
               , tolerance = 1e-06)

  expect_equal(c(fit$data),
               c(NULL )
               , tolerance = 1e-06)

  expect_equal(c(fit$order),
               c(1 )
               , tolerance = 1e-06)

  expect_equal(c(fit$F_),
               c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 )
               , tolerance = 1e-06)

  expect_equal(c(fit$method),
               c("UKF" )
               , tolerance = 1e-06)

  expect_equal(c(fit$model),
               c("exponential" )
               , tolerance = 1e-06)

  expect_equal(c(fit$est_Q_0),
               c(FALSE )
               , tolerance = 1e-06)

  expect_equal(c(fit$LR),
               c(1 )
               , tolerance = 1e-06)
})


