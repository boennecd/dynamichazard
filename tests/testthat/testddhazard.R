library(survival)

test_that("The head_neck_cancer must be defined for the ddhazard tests",
          expect_true(exists("head_neck_cancer")))

# Test on data set that is one of Farhmiers papers
result = ddhazard(
  formula = survival::Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 1, # Use by month intervals
  n_max = 10^4, eps = 10^-4,
  a_0 = rep(0, 2), Q_0 = diag(1, 2), # Initial value
  est_Q_0 = T,
  max_T = 45,
  id = head_neck_cancer$id, order_ = 1
)

test_that("Testing previous computed values vs. current on head and neck cancer set assuming that the previous is correct", {
  expect_equal(c(result$a_t_d_s),
               c(-3.5084644693000375, -3.5148844600373153, -3.1891314791814929, -2.8181185126716946, -2.5133150253138181, -2.0686431883814391, -2.1337664829927272, -2.5088816216986980, -2.7261252524003838, -2.8656346839715456, -3.0022690651419150, -3.2103909019454631, -3.3296886621454438, -3.3797024676574670, -3.2387762301797576, -3.2832268974011902, -3.4010378429506498, -3.4996364628495664, -3.4640927580381167, -3.5454306632739097, -3.5193437650355053, -3.6429455602328522, -3.8148529400485618, -3.9315760725295390, -3.9912270162929087, -4.1221212755199144, -4.2111505273306804, -4.2593181086540230, -4.3955501412991156, -4.5056360495292482, -4.5891834181979796, -4.6463491829253352, -4.6772452961075963, -4.6818100380470060, -4.6597979866888570, -4.6108005184078964, -4.5342715329240795, -4.4295511232451679, -4.4288880723551687, -4.5320293776581728, -4.6212298063525905, -4.6940739120459574, -4.7499759978712248, -4.7915369057959181, -4.8188789577153992, -4.8320508432930724, 0.4360755600018228, 0.4376620032308990,  0.4489331535887380, 0.4629877155198045, 0.4717967889720516, 0.4892432325019014, 0.4906015100905337, 0.4811672226212869, 0.4812410655726153, 0.4807008058089728,  0.4795022646846021, 0.4752694673136330, 0.4750540102025831, 0.4782488768524199, 0.4871715112202827, 0.4868843094919623, 0.4843562325887174, 0.4835935130835331,  0.4867226287750569, 0.4863614783282632, 0.4891031221907462, 0.4848002061937289, 0.4802281967614200, 0.4772168219924643, 0.4758176353352087, 0.4735558899381061,  0.4724962572592801, 0.4726240459881104, 0.4714467634180154, 0.4710489177360688, 0.4714390992094060, 0.4726106938155138, 0.4745588596923577, 0.4772841101671843,  0.4807925107278950, 0.4850950220887917, 0.4902067111479924, 0.4961460340659207, 0.4977474633246664, 0.4949782740709857, 0.4925889375015259, 0.4906451477362695,  0.4891628332671372, 0.4880589755764653, 0.4873303205106824, 0.4869755787235325 ))

  expect_equal(c(result$V_t_d_s),
               c( 0.0011007577913296656, -0.0001733451115550633, -0.0001733451115550633, 0.0004392322044566420, 0.0682991240249047060, 0.0003834452042018443,  0.0003834452042018442, 0.0029230271218272539, 0.0912395007549733350, -0.0003397914632747466, -0.0003397914632747466, 0.0052119615712443315,  0.0932049749695377378, -0.0016092541197089715, -0.0016092541197089711, 0.0073429567284740965, 0.0849686813506122934, -0.0030571106681653009, -0.0030571106681653005, 0.0093460739808944281, 0.0774928836229536178, -0.0044064881508436658, -0.0044064881508436658, 0.0112576788942480542,  0.0625786071371585012, -0.0058040178177705924, -0.0058040178177705924, 0.0131038581718835520, 0.0663037854506360463, -0.0066152078662832037, -0.0066152078662832037, 0.0149859903532218054, 0.0802636516361565355, -0.0072606054091964422, -0.0072606054091964422, 0.0169064138433351260,  0.0925945303565963995, -0.0077694160284284882, -0.0077694160284284891, 0.0188521666403896025, 0.1028653949187706279, -0.0082893243691400179, -0.0082893243691400196, 0.0208108298970566402, 0.1134521022635953669, -0.0087341231657698665, -0.0087341231657698665, 0.0227878464846351519,  0.1282127482321499812, -0.0091281359070864241, -0.0091281359070864224, 0.0247818173504978020, 0.1412262999503804406, -0.0096021138204995977, -0.0096021138204995960, 0.0267801536095240260, 0.1518039844431364749, -0.0100679733114127437, -0.0100679733114127437, 0.0287860644548110257,  0.1503781552817381462, -0.0107654864975719258, -0.0107654864975719258, 0.0307850681462566306, 0.1529892913432942814, -0.0114268209514253039, -0.0114268209514253039, 0.0328022104304094425, 0.1623989951758836869, -0.0119988254560485837, -0.0119988254560485837, 0.0348470071785677502,  0.1751405465177472420, -0.0124767948762201323, -0.0124767948762201323, 0.0369196593146410082, 0.1826262222670714253, -0.0130763410888457762, -0.0130763410888457762, 0.0390042849193854013, 0.1921213871302026865, -0.0136031573461606395, -0.0136031573461606395, 0.0411148217076838310,  0.1952137792451406062, -0.0142700820537257390, -0.0142700820537257390, 0.0432374522277687856, 0.2045009115946196943, -0.0150037228119862687, -0.0150037228119862670, 0.0453817496599724785, 0.2197992615605408318, -0.0156403530269492337, -0.0156403530269492302, 0.0475580384562985375,  0.2351742387248771660, -0.0163387197002041323, -0.0163387197002041323, 0.0497535112080704153, 0.2471786691448959739, -0.0171983898818672161, -0.0171983898818672196, 0.0519599789846230259, 0.2633406508519972045, -0.0179758501250396573, -0.0179758501250396607, 0.0541928396098181331,  0.2783570585162779554, -0.0187578421049752302, -0.0187578421049752336, 0.0564447233177911220, 0.2898617445280329274, -0.0196256986326030711, -0.0196256986326030711, 0.0587095922537396175, 0.3070089074201384216, -0.0202566671302706752, -0.0202566671302706752, 0.0610078966170546910,  0.3265517822464923947, -0.0207566923998554545, -0.0207566923998554545, 0.0633316746524540397, 0.3468613597848555496, -0.0211777326575118136, -0.0211777326575118136, 0.0656762424587988280, 0.3669330349624608245, -0.0215496836790728778, -0.0215496836790728778, 0.0680384930107222063,  0.3859999570458617635, -0.0218930814893318545, -0.0218930814893318545, 0.0704161786213701735, 0.4033580584084034970, -0.0222249753911356145, -0.0222249753911356145, 0.0728075543038044365, 0.4182756228156945255, -0.0225620115551172298, -0.0225620115551172298, 0.0752111771525787870,  0.4299395711487184468, -0.0229222709068044872, -0.0229222709068044872, 0.0776257813361121429, 0.4374185315654753881, -0.0233265169857653290, -0.0233265169857653290, 0.0800501930267311507, 0.4389396398028437285, -0.0237873509608388274, -0.0237873509608388274, 0.0824839842388029043,  0.4444370473634537966, -0.0241089985969926528, -0.0241089985969926528, 0.0849399776770060483, 0.4705099679725334716, -0.0239711015900734327, -0.0239711015900734327, 0.0874386019174675511, 0.5127677482774826156, -0.0234537793009185619, -0.0234537793009185619, 0.0899729190136854540,  0.5710035270105234817, -0.0225390051857156867, -0.0225390051857156867, 0.0925406272428825755, 0.6422966612793774566, -0.0213827332568293886, -0.0213827332568293886, 0.0951287192064125264, 0.7296350793987446126, -0.0198916154467032036, -0.0198916154467032036, 0.0977389611802057523,  0.8366982297826955906, -0.0179580979280018482, -0.0179580979280018482, 0.1003735699436583140 ))

  expect_equal(c(result$lag_one_cor),
               c( 0.0006319914823851234, -0.0001813450353835426, -0.0002126117899357636, 0.0004231047677557611, 0.0374926594959537965, -0.0005380017294018889, -0.0005485720017780360, 0.0027985731084827336, 0.0481658093802995874, -0.0016000013589881627, -0.0015949751696787691, 0.0050048137282718962,  0.0456878855983472026, -0.0029587363809467785, -0.0029189483751894322, 0.0070703673493283329, 0.0396604087798715019, -0.0043033008270456190, -0.0042589644753056816, 0.0090269214295090917, 0.0312294200116858406, -0.0056445383104769611, -0.0055052058435728288, 0.0109053718415916372,  0.0277604858121243067, -0.0066868592103896726, -0.0065493515470886115, 0.0127664150516888786, 0.0339237983194087267, -0.0074374459108181770, -0.0074140515313897131, 0.0146609784134950454, 0.0440622779829562689, -0.0081876860923845354, -0.0080158162771978795, 0.0165879425442369867,  0.0532613145041970354, -0.0087846810550449832, -0.0085842409359943670, 0.0185356890963747287, 0.0620030758351880484, -0.0093425048092310777, -0.0091025684196418474, 0.0204997891156617623, 0.0728513701255290580, -0.0097823345080032802, -0.0096128728534951753, 0.0224819052110776137,  0.0852163441699832769, -0.0102462632327539986, -0.0101088730406997656, 0.0244754314202132520, 0.0959330788853532263, -0.0107781511795978276, -0.0105860202161019556, 0.0264754322364910526, 0.1002061921916009707, -0.0114127390024465029, -0.0111391949292140822, 0.0284766937737128793,  0.1007636418466745787, -0.0120573912090688583, -0.0118570640836160000, 0.0304836792486671525, 0.1062366995263799574, -0.0126455551196479089, -0.0125325810037256995, 0.0325131894616143557, 0.1164479435890595910, -0.0131968007123752003, -0.0130824399573795571, 0.0345702739070011394,  0.1259739156939710947, -0.0137649784666452300, -0.0136274381705102868, 0.0366477215003125287, 0.1339397670426479281, -0.0143510749271825982, -0.0141996145156178810, 0.0387441154191005901, 0.1399397952275374390, -0.0149739632061277085, -0.0147895226744024933, 0.0408598614778161312,  0.1457693177465160805, -0.0155839512939056103, -0.0155955638120855878, 0.0429925035951635587, 0.1573951226983123508, -0.0162626012661845898, -0.0163227628857992857, 0.0451516935211992362, 0.1720884528462469087, -0.0169267713220890778, -0.0170279042024082637, 0.0473366336214868441,  0.1853207193021612631, -0.0176966192481461081, -0.0178397971217273306, 0.0495369101392598918, 0.1988822844190729910, -0.0185218493681163360, -0.0186795043672042492, 0.0517557651622434362, 0.2140265293846420891, -0.0193324169287155505, -0.0194536391053007109, 0.0539974391987324484,  0.2269743551126637005, -0.0201775348081844191, -0.0202760450098242243, 0.0562552827877792691, 0.2408827346519127055, -0.0209761004349988504, -0.0210013621236798051, 0.0585361402693362204, 0.2587873461391665963, -0.0215840832784766519, -0.0215509137876134238, 0.0608464935722820149,  0.2783108156512931197, -0.0220822328593056443, -0.0219982908028953338, 0.0631800531920647668, 0.2981521380750243311, -0.0225129962129074074, -0.0223819658897505894, 0.0655329263193361600, 0.3174279954979510876, -0.0229027366724126047, -0.0227258619326826256, 0.0679024304099249548,  0.3354014001863034333, -0.0232710946107934427, -0.0230480112171346438, 0.0702865626215162104, 0.3513521643906739600, -0.0236355450370131226, -0.0233647677843556098, 0.0726837231452698296, 0.3645059125021066215, -0.0240139196073090484, -0.0236931428694739724, 0.0750925529047788837,  0.3739890959881940757, -0.0244259932862989082, -0.0240522839920852098, 0.0775118285517998884, 0.3784535347735979438, -0.0249012435710693411, -0.0244462789870596130, 0.0799407418619832999, 0.3819151740934059180, -0.0253026050600785556, -0.0248317275156184590, 0.0823853873046871965,  0.3973498624532323387, -0.0253572058863496402, -0.0249807749061207209, 0.0848621500522364069, 0.4309121681052292541, -0.0250169074096886247, -0.0246995171538831222, 0.0873779395067437042, 0.4804161596009360879, -0.0243022568530614422, -0.0240233709749064703, 0.0899281997898045693,  0.5444877914482062486, -0.0232369005433537522, -0.0230542772574000854, 0.0925054925093105329, 0.6230475261289992739, -0.0218919395921305972, -0.0217917741796725788, 0.0951040211830674886, 0.7194167882990079033, -0.0201652844689610457, -0.0201377013624211842, 0.0977257666720493107 ))

  # expect_equal(c(result$n_iter),
  #              c(274 ))

  expect_equal(c(result$Q),
               c(0.129221898731263357, 0.002475034806031055, 0.002475034806031055, 0.002645631948634509 ))

  expect_equal(c(result$Q_0),
               c( 0.0011007577913296656, -0.0001733451115550633, -0.0001733451115550633, 0.0004392322044566420 ))

  expect_equal(c(result$n_risk),
               c(96, 95, 91, 84, 78, 65, 53, 49, 46, 43, 39, 37, 36, 36, 33, 31, 30, 30, 25, 25, 23, 21, 21, 21, 20, 19, 19, 18, 18, 18, 18, 18, 18, 18, 18, 18, 17, 15, 14, 14, 14, 12, 12, 12, 11 ))

  expect_equal(c(result$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45 ))

  # expect_equal(c(result$hazard_func),
  #              c([[1]]function (eta) {    exp_ = exp(eta)    exp_/(1 + exp_)}<environment: 0x000000001fb07d38> ))
  #
  # expect_equal(c(result$hazard_first_deriv),
  #              c([[1]]function (beta, x_) {    exp_ = exp(beta %*% x_)    x_ * exp_/(exp_ + 1)^2}<environment: 0x000000001fb07d38> ))

  expect_equal(c(result$risk_set),
               c(NA ))

  expect_equal(c(result$order),
               c(1 ))

  expect_equal(c(result$F_),
               c(1, 0, 0, 1 ))
})

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result$a_t_d_s), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result$V_t_d_s)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result$Q_0)), rep(c("(Intercept)", "group1"), 2))
})

result_exp = ddhazard(
  formula = survival::Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 1,
  n_max = 10^4, eps = 10^-4,
  a_0 = rep(0, 2), Q_0 = diag(1, 2),
  Q = diag(1e-3, 2),
  est_Q_0 = F,
  max_T = 30,
  id = head_neck_cancer$id, order_ = 1,
  verbose = F,
  model = "exponential"
)

# matplot(result_exp$a_t_d_s, type = "l")
# get_expect_equal(result_exp)

test_that("Result of exponential model on head_neck_data match previous results", {
  expect_equal(c(result_exp$a_t_d_s),
               c(-3.97670917333694840, -3.97674594528922842, -3.67822723844953225, -3.38186160670887448, -3.20803125783379928, -2.81150733914823459, -2.86991583304613229, -3.19339409542700414, -3.33884572499217747, -3.44488663489353897, -3.55468195135890896, -3.74276473988639058, -3.83879589030475188, -3.85491280083719179, -3.69206869970224005, -3.74688315457354149, -3.86422464743509453, -3.94733561401569233, -3.90529955776537419, -3.96708964150362231, -3.92627936981884496, -4.05352095843694382, -4.21056855197516100, -4.31870528617516136, -4.37554856865496156, -4.48030141196976395, -4.54582342572652021, -4.57305289422576866, -4.66140004517541939, -4.72082090785410191, -4.75069382389330297, 0.23643942429448270, 0.23642538963461671, 0.35119909608991445, 0.46549545046933199, 0.53138482409557175,  0.68486304659599784, 0.66299911692218005, 0.53892413086915458, 0.48510875095794093, 0.44552674674974957, 0.40424312760390879,  0.33246258946182772, 0.29654462841347456, 0.29181540205284756, 0.35597679374548952, 0.33497520088953925, 0.28981802576768462,  0.25819314969811624, 0.27468066357009663, 0.25112029063171620, 0.26699776975209677, 0.21721608197843270, 0.15629576896568312,  0.11412921530635921, 0.09164410510332197, 0.05109346037346890, 0.02559506518920458, 0.01479926108810842, -0.01912463326287420, -0.04194359001789783, -0.05341608209319967 ))

  expect_equal(c(result_exp$V_t_d_s),
               c( 0.1832051868721281673, 0.0278848469490704347, 0.0278848469490704381, 0.0803177213322829875, 0.1132034251783800571, -0.0002825347413270007, -0.0002825347413270007, 0.0681138636429205468, 0.1057893643022574104, -0.0037108490430141639, -0.0037108490430141639, 0.0657813363200184242, 0.0933234388646140278, -0.0089983708866558654, -0.0089983708866558654,  0.0628183664969049760, 0.0788715600332714067, -0.0155162728380365406, -0.0155162728380365128, 0.0592778241516741244,  0.0734428605985888855, -0.0165822472363131579, -0.0165822472363131579, 0.0587135297616458440, 0.0591657019120934505, -0.0217911346933305147, -0.0217911346933305217, 0.0563985065119824158, 0.0614045817202078167, -0.0201269492208758713, -0.0201269492208758713, 0.0571887451287438134, 0.0723425094484046460, -0.0145208873097363092, -0.0145208873097363092,  0.0599501350321204399, 0.0803567973399948177, -0.0104885005098428984, -0.0104885005098429001, 0.0620705206328553000,  0.0869387047105238953, -0.0071134417298352650, -0.0071134417298352659, 0.0640036899753111677, 0.0939937589466598167, -0.0034894844498765754, -0.0034894844498765763, 0.0661485628168010653, 0.1056352965671321503, 0.0018561382382013911,  0.0018561382382013894, 0.0690194618275779270, 0.1154879277980833396, 0.0062299728951861078, 0.0062299728951861026,  0.0714630155033750963, 0.1222252055365240092, 0.0092166054186206374, 0.0092166054186206409, 0.0733443351545733369,  0.1171870821646983502, 0.0074167417118372499, 0.0074167417118372429, 0.0733164859929927581, 0.1186200073373010061,  0.0080962739829031592, 0.0080962739829031558, 0.0742920260983656322, 0.1267252242886504343, 0.0113714342440382615,  0.0113714342440382511, 0.0763302459132520761, 0.1368320431509568169, 0.0154106707763921706, 0.0154106707763921637,  0.0787023904830222026, 0.1418229945213846377, 0.0173294366900338045, 0.0173294366900338011, 0.0802302232935526993,  0.1484277775914494280, 0.0199114476530654755, 0.0199114476530654685, 0.0820632817930946612, 0.1488018943776022174,  0.0200040322972981702, 0.0200040322972981771, 0.0829277355347014244, 0.1570037340272072146, 0.0229661973712110210,  0.0229661973712110210, 0.0848786434078876301, 0.1710859655268716084, 0.0282664666087455024, 0.0282664666087455094,  0.0877901216774502752, 0.1865428085371889089, 0.0340275035065738946, 0.0340275035065738946, 0.0908764893254096623,  0.2014834476666247376, 0.0394535520998959832, 0.0394535520998959902, 0.0938003636583288197, 0.2229019052396607470,  0.0473425660283096975, 0.0473425660283097044, 0.0976811265666991113, 0.2487790398587779450, 0.0569349094050815366,  0.0569349094050815435, 0.1022282780020242754, 0.2799374204675383337, 0.0684956253291079536, 0.0684956253291079675,  0.1075214163665750289, 0.3289519028931106037, 0.0869897747611888261, 0.0869897747611888261, 0.1155225124818885507,  0.3996377264490825754, 0.1138172549902054936, 0.1138172549902054936, 0.1267411842245389220 ))

  expect_equal(c(result_exp$lag_one_cor),
               c( 0.1031151556577854234, -0.0025673007890856248, -0.0041177019347565513, 0.0671738953591519139, 0.0729285502330940805, -0.0153665974737224043, -0.0163223793842787457, 0.0611807158610895852, 0.0644065921154819421, -0.0192288355867880623, -0.0200771554947000441, 0.0587459567274195293, 0.0535427330021189529, -0.0239158942554452691, -0.0251883169614478958,  0.0558824984363825716, 0.0464796572600867930, -0.0275860737664426203, -0.0268684891017166583, 0.0542637414978720672,  0.0392122788902791175, -0.0294064481771485198, -0.0293297471017429506, 0.0532084301672932219, 0.0356480065351482064, -0.0305448770356387816, -0.0298416548856658831, 0.0528117325314924682, 0.0391007556490918923, -0.0284712115615889730, -0.0270759696825927688, 0.0541164525517244047, 0.0455860098549121379, -0.0246247696130386419, -0.0236000239726060282,  0.0561089074393790813, 0.0509999785363083741, -0.0216239631152422562, -0.0206527528940453828, 0.0578530091473455632,  0.0562916820073403254, -0.0187677945664524483, -0.0176931041764787911, 0.0596626970982066657, 0.0638551422142593222, -0.0149661074687492766, -0.0139066474561677852, 0.0619031698774247519, 0.0731667066769392804, -0.0105326229049919270, -0.0097298238679709072, 0.0643460593649873014, 0.0805695408224628151, -0.0071133009784132770, -0.0064778750491979904,  0.0663753078027907867, 0.0813318588316555291, -0.0064375392389208665, -0.0060344261003749443, 0.0672889043995953118,  0.0797084297205427755, -0.0069327416786996027, -0.0065228958987601513, 0.0677886978908447263, 0.0839155137757939540, -0.0051944934955948895, -0.0047410661895154194, 0.0692114369860178241, 0.0921739318284499620, -0.0018678257622304888, -0.0014075992625329978, 0.0712902662011879601, 0.0992140159350134720, 0.0009836567781669348, 0.0013068741186968123,  0.0731646605524272076, 0.1045839525483038546, 0.0030432240366696992, 0.0034174257987806232, 0.0747811495072748106,  0.1078806901256837703, 0.0043465972131570517, 0.0046400514000073771, 0.0761011970976562674, 0.1118466302783495819,  0.0058133786026677743, 0.0059801473520385215, 0.0774610865836157098, 0.1222694919469353436, 0.0096261272420231150,  0.0098751951619719461, 0.0797852602660696492, 0.1363267096938496348, 0.0149120552743186169, 0.0151021452356542747,  0.0826785580752974619, 0.1509511601798297353, 0.0203473430664968327, 0.0204124280247277787, 0.0855987685722870567,  0.1683981812721982996, 0.0267338143382507831, 0.0267771885593782767, 0.0888925354534749884, 0.1913172634181187770,  0.0351973298712989283, 0.0352340798926058796, 0.0929984973894393968, 0.2191117948941448679, 0.0455237478712123000,  0.0455043952847125482, 0.0978116210372377975, 0.2579818125849921984, 0.0600511874735620288, 0.0600949580273164030,  0.1042783059265411510, 0.3163625819533421035, 0.0821479346489345230, 0.0821887053999010020, 0.1136704668433825699 ))

  expect_equal(c(result_exp$n_iter),
               c(66 ))

  expect_equal(c(result_exp$Q),
               c(0.09946932732012863, 0.03783300224988726, 0.03783300224988726, 0.01543663831742442 ))

  expect_equal(c(result_exp$Q_0),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$order),
               c(1 ))

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$method),
               c("EKF" ))

  expect_equal(c(result_exp$model),
               c("exponential" ))

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE ))
})

test_that("poisson model and logit moels hazzard functions differs", {
  expect_true(result_exp$model != result$model)
  expect_true(toString(body(result_exp$hazard_func)) !=
                toString(body(result$hazard_func)))
  expect_true(toString(body(result_exp$hazard_first_deriv)) !=
                toString(body(result$hazard_first_deriv)))
})

test_that("Testing names of output from ddhazard on head and neck cancer dataset", {
  expect_equal(colnames(result_exp$a_t_d_s), c("(Intercept)", "group1"))
  expect_equal(unlist(dimnames(result_exp$V_t_d_s)), unlist(list(c("(Intercept)", "group1"), c("(Intercept)", "group1"), NULL)))
  expect_equal(unlist(dimnames(result_exp$Q)), rep(c("(Intercept)", "group1"), 2))
  expect_equal(unlist(dimnames(result_exp$Q_0)), rep(c("(Intercept)", "group1"), 2))
})


# Change by argument
result_exp = ddhazard(
  formula = survival::Surv(start, stop, event) ~ group,
  data = head_neck_cancer,
  by = 2,
  n_max = 10^4, eps = 10^-4,
  a_0 = rep(0, 2), Q_0 = diag(1, 2),
  Q = diag(1e-3, 2),
  est_Q_0 = F,
  max_T = 30,
  id = head_neck_cancer$id, order_ = 1,
  verbose = F,
  model = "exponential"
)

# matplot(result_exp$a_t_d_s, type = "l")
# get_expect_equal(result_exp)

test_that("Result of exponential model on head_neck_data match previous results with altered by argument", {
  expect_equal(c(result_exp$a_t_d_s),
               c(-3.66470254910492965, -3.66474706370252523, -2.76810021608623336, -2.37016905577829462, -2.88527701004363868, -3.09784986345455149, -3.48266257367868359, -3.53409599869474356, -3.50452999032306378, -3.68733386046285716, -3.75440297910365439, -3.92931420996290637, -4.13536817561038994, -4.31353242824072147, -4.29415086207046315, -4.44742781342733640, 0.14460881063442274, 0.14458966333745016,  0.54220314703993744, 0.71686313456859296, 0.48814165025303158, 0.39660025957471889, 0.22674612731683766, 0.20698865962895394,  0.22015367692421495, 0.13937097843449658, 0.10943794134073426, 0.02931587668643268, -0.06355936873028328, -0.14352365432290462, -0.13606103184196280, -0.20391357029043852 ))

  expect_equal(c(result_exp$V_t_d_s),
               c( 0.2239954769849443750, 0.0655923866343257334, 0.0655923866343257472, 0.0856850342803099352, 0.0701094856476841277, -0.0038922715688509135, -0.0038922715688509135, 0.0523721592627481858, 0.0755056468311222084, -0.0019795481071096244, -0.0019795481071096105, 0.0514742546248752875, 0.0459893287640510268, -0.0168002899428832814, -0.0168002899428832814,  0.0428520247345924449, 0.0395383065657095717, -0.0176668807846101159, -0.0176668807846101159, 0.0427380304585478071,  0.0554849050799214386, -0.0083268844417649975, -0.0083268844417650027, 0.0482405628816991311, 0.0685881166264916964, -0.0008915346260135876, -0.0008915346260135910, 0.0530967481749607603, 0.0917314760624167724, 0.0105768571207504984,  0.0105768571207505019, 0.0598970756325017256, 0.1029505276277184328, 0.0162964559289216979, 0.0162964559289216944,  0.0641352931380022306, 0.1037258639501149188, 0.0164485880804922657, 0.0164485880804922657, 0.0656497098810895630,  0.1265921801941821134, 0.0268701800644146269, 0.0268701800644146269, 0.0721116488290027280, 0.1394313143521199172,  0.0328068306908046725, 0.0328068306908046725, 0.0766830420360093551, 0.1583797329998488101, 0.0408462387555405329,  0.0408462387555405260, 0.0820262021138331576, 0.1897619001198406763, 0.0541928541421161369, 0.0541928541421161369,  0.0897223868891949550, 0.2404909896530670887, 0.0760800199433048219, 0.0760800199433048219, 0.1012582172983322176,  0.3106678049553517895, 0.1062117278334599041, 0.1062117278334599041, 0.1163272984336688326 ))

  expect_equal(c(result_exp$lag_one_cor),
               c( 0.0581028385172765310, -0.0072444734259627663, -0.0091541950837004671, 0.0507854295613683060, 0.0305719789171202405, -0.0205541704126560032, -0.0217954718525925212, 0.0429534684036514680, 0.0256335909301954809, -0.0232916444899874189, -0.0256021168272291474, 0.0396164859822722010, 0.0217562109295342289, -0.0268049576003472970, -0.0251706803089071125,  0.0380668354484768462, 0.0208436994532727946, -0.0254916865534527692, -0.0231220640448812874, 0.0396078590805537395,  0.0243612892264773936, -0.0218239875294321505, -0.0198641722726530523, 0.0425826594850195056, 0.0314033017870680442, -0.0171719045857336335, -0.0155045036084438571, 0.0462019832669743127, 0.0410358093169969629, -0.0117507577680532344, -0.0104671739924645686, 0.0502204627419419736, 0.0447135283650619969, -0.0094214520125273163, -0.0089886987863954937,  0.0526366994782183420, 0.0519460678887981378, -0.0064314589218757625, -0.0054966721024843051, 0.0557115478144272411,  0.0648237411726153845, -0.0004605667099179742, 0.0004626102810896780, 0.0602421445696742427, 0.0767237353479582607,  0.0050357523477366044, 0.0053979315269180438, 0.0644122809169798000, 0.0966036776555502241, 0.0134711383782364705,  0.0136579634961798840, 0.0698906297153868428, 0.1309471159607265567, 0.0281201853999506271, 0.0282851940496364022,  0.0781842396764870357, 0.1847772952660913237, 0.0513669286489622026, 0.0511865485567550155, 0.0901853413511809893 ))

  expect_equal(c(result_exp$n_iter),
               c(24 ))

  expect_equal(c(result_exp$Q),
               c(0.11112544355142200, 0.04881121798770979, 0.04881121798770979, 0.02253873603135799 ))

  expect_equal(c(result_exp$Q_0),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$order),
               c(1 ))

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 1 ))

  expect_equal(c(result_exp$method),
               c("EKF" ))

  expect_equal(c(result_exp$model),
               c("exponential" ))

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE ))
})

set.seed(3787)
sims <- test_sim_func_logit(n_series = 5e2, n_vars = 3, t_0 = 0, t_max = 10,
                            x_range = 1, x_mean = -.5, re_draw = T, beta_start = 0,
                            intercept_start = -4, sds = c(.1, rep(1, 3)))

test_that("Chaning time scale in EKF does no change results when other parems are changed accoridngly",{
  for(m in c("logit")){
    arg_list <- list(formula = survival::Surv(tstart, tstop, event) ~ . - tstart - tstop - event - id,
                     by = 1,
                     data = sims$res,
                     a_0 = rep(0, ncol(sims$res) + 1 - 4),
                     Q_0 = diag(rep(1e2, ncol(sims$res) + 1 - 4)),
                     Q = diag(rep(1e-3, ncol(sims$res) + 1 - 4)),
                     est_Q_0 = F, method = "EKF",
                     model = m,
                     eps = 1e-2, id = sims$res$id,
                     verbose = F,
                     max_T = 10)

    res <- do.call(ddhazard, arg_list)

    sim_tmp <- sims
    t_mult <- 2.5
    sim_tmp$res$tstart <- sim_tmp$res$tstart * t_mult
    sim_tmp$res$tstop <- sim_tmp$res$tstop * t_mult
    arg_list$data <- sim_tmp$res
    arg_list$by <- t_mult
    arg_list$max_T <- arg_list$max_T * t_mult
    arg_list$Q <- arg_list$Q / t_mult

    res_new_time <- do.call(ddhazard, arg_list)

    expect_equal(res$a_t_d_s, res_new_time$a_t_d_s)
    expect_equal(res$V_t_d_s, res_new_time$V_t_d_s)
    expect_equal(res$Q, res_new_time$Q * t_mult)
  }
})

set.seed(93143)
sims <- test_sim_func_exp(n_series = 1e4, n_vars = 10, t_0 = 0, t_max = 10,
                          x_range = 1, x_mean = 0, re_draw = T, beta_start = 0,
                          intercept_start = -5, sds = c(.1, rep(1, 10)))
# sum(sims$res$event)

# tmp_file <- file("exponential.log")
# sink(tmp_file)
result_exp = ddhazard(
  formula = survival::Surv(tstart, tstop, event) ~ . - id - tstart - tstop - event,
  data = sims$res,
  by = (by_ <- 1),
  n_max = 10^4, eps = 10^-2,
  a_0 = rep(0, 11),
  Q_0 = diag(100, 11),
  Q = diag(1e-3, 11),
  est_Q_0 = F,
  max_T = 10,
  id = sims$res$id, order_ = 1,
  verbose = F,
  model = "exponential"
)
# sink()
# close(tmp_file)

# matplot(seq_len(nrow(sims$betas)) - 1, sims$betas, type = "l", lty = 1)
# matplot(result_exp$times, result_exp$a_t_d_s, result_exp$a_t_d_s, type = "l", lty = 2, add = T)

# get_expect_equal(result_exp, eps = 1e-4)

test_that("Result of exponential model on simulated data match previous results", {
  expect_equal(c(result_exp$a_t_d_s),
               c(-4.640329418961689711, -4.640311766860333975, -4.550993716932300259, -4.614838232628359016, -4.590891349476680539, -4.483467751741047280, -4.620637086244515856, -4.769813573994810874, -4.834326602234911618, -4.420605486029085540, -4.522868823865070276, 0.108345857091244557,  0.108472795634152741, -0.574982799530977196,  0.790821791521778006, 0.462522131218285393,  0.741176255970951048, 1.662081263827061450,  1.218647636247403465, 0.520025832615314099,  1.520853548099621477, 1.342364937417941384, -0.980910103461468008, -0.980905079476531161, -1.362996269980152331, -1.943979461581122115, -0.896711188318529251, -0.796535023029323774, -1.112661682941282981, -0.841716141651764782, -0.550477441856325855, -0.642644225601545327, -0.618138368717568998, -0.754224984784127694, -0.754200624900805416, -0.788904437921154722, -0.557114971054176400, 0.415567791391985020,  0.321219270755635944, 1.461815532449772137,  0.484343300960016987, -0.193083044042183183, -0.653738097514472205, -0.382721394921686053,  0.153847106122297267, 0.153984027075844299, -0.445255522796064285, 0.006278680791956918, -0.568872617408898940, -2.274651669695434641, -2.093718712809232496, -2.649177800126587989, -2.805889903759887005, -2.278609668896209417, -2.186761173069662778, -0.410154721889328333, -0.410028359472936754, -1.147912375002044794,  0.438670043333295789, 0.988621714092581039,  1.612682191261204601, 1.853587289512433456,  1.765024528958099248, 1.396795100013246360,  2.527779109710122540, 2.916099556954488747,  0.455369136459581880, 0.455539063500897512, -0.344643233755345502, 0.432820604337723625, -0.851966936021706589, -2.126495377855946334, -1.160812329735334325, -2.030507621363687232, -2.659564983143259731, -1.697804887232084781, -2.300761296983134141, 1.213981211608250899,  1.213739185320517056, 2.785633891804850659,  3.080709470260670102, 3.825089897538360262,  6.857321716868564287, 6.641668733651932222,  7.318533323545573843, 7.225595798536540215,  6.278779949233827651, 6.783357454666566255,  1.054974670603961995, 1.055110910450279826,  1.243016026391027262, 2.275009656606971742,  1.092902596211767996, -2.088097969823934807, -2.179778570732250564, -3.374668222919637195, -3.547010894772613554, -3.417122812824165745, -2.345477652809819347, 1.580097001652849720,  1.580058711082584555, 2.679552462283008474,  3.982926973903154089, 3.297411036836860543,  2.812735434210210883, 2.542557869546920202,  2.202226035718871877, 2.042681301050722542,  1.749984414882722383, 3.033427120112164310,  0.466858693294694205, 0.466911788611974909,  0.478847962429469753, 0.173653352548069406, -0.192344270932538863, -2.241004496826659587, -2.053259957928407875, -2.887074026869891785, -2.926252067962812564, -3.318223550335067440, -3.077882562020491264 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$V_t_d_s),
               c( 5.047976444636504e-02, 5.942096185760885e-02, -5.223214712732005e-03, -9.078723474652278e-03,  1.266231658265813e-02, 5.489765440005432e-02,  5.640344477433554e-02, -3.154764710067853e-02, -3.131431589241730e-02, -4.146554666849281e-02, -3.256353105833033e-02, 5.942096185760886e-02,  4.979812327542419e-01, -8.979724712928039e-02,  2.120135065133363e-01, 1.917236926086087e-01,  4.618185844636104e-01, 4.084232381607681e-01, -1.926353970694745e-01, 1.429560233059880e-01,  3.000265703060580e-02, -4.847806468910389e-02, -5.223214712732001e-03, -8.979724712928039e-02,  1.597035017307178e-01, -2.040893990297709e-02, -9.997936191108597e-02, 1.845121336137295e-02, -1.909167116301572e-01, 6.748490890080355e-02, -2.729710779875338e-01, -1.898270272854460e-01, -1.095220005863721e-01, -9.078723474652281e-03,  2.120135065133362e-01, -2.040893990297709e-02,  4.870326386797643e-01, 5.876783597855331e-02,  1.320482276906168e-01, 1.614385196887380e-01, -2.261386219226088e-03, 1.141456560154707e-01,  3.814379469710372e-02, 1.312530882458422e-01,  1.266231658265812e-02, 1.917236926086087e-01, -9.997936191108601e-02, 5.876783597855328e-02,  5.256318667198769e-01, 7.345873589343040e-02,  5.600437320696918e-01, -8.570694633596697e-01,  8.508739632492931e-01, 1.250938444289149e-01,  4.573233787957925e-01, 5.489765440005430e-02,  4.618185844636104e-01, 1.845121336137294e-02,  1.320482276906168e-01, 7.345873589343038e-02,  6.705982381815261e-01, 1.373236843250485e-01,  6.895992677330283e-02, -1.790454882188923e-02,  1.031466068353063e-01, -2.451062726280972e-01,  5.640344477433554e-02, 4.084232381607680e-01, -1.909167116301572e-01, 1.614385196887380e-01,  5.600437320696919e-01, 1.373236843250485e-01,  8.267809247795697e-01, -9.376877472417783e-01,  7.745236588305584e-01, 7.777609815334900e-03,  4.336885586148986e-01, -3.154764710067853e-02, -1.926353970694745e-01, 6.748490890080357e-02, -2.261386219226110e-03, -8.570694633596697e-01,  6.895992677330287e-02, -9.376877472417784e-01,  1.658260940007182e+00, -1.206333856213852e+00,  1.349318314613122e-01, -7.834079981842947e-01, -3.131431589241728e-02, 1.429560233059879e-01, -2.729710779875336e-01, 1.141456560154707e-01,  8.508739632492931e-01, -1.790454882188924e-02,  7.745236588305583e-01, -1.206333856213851e+00,  1.792118456839944e+00, 6.484736194465113e-01,  9.166943391253495e-01, -4.146554666849281e-02,  3.000265703060581e-02, -1.898270272854460e-01,  3.814379469710374e-02, 1.250938444289148e-01,  1.031466068353062e-01, 7.777609815334867e-03,  1.349318314613122e-01, 6.484736194465112e-01,  6.613112260553748e-01, 1.716240655731736e-01, -3.256353105833034e-02, -4.847806468910395e-02, -1.095220005863721e-01, 1.312530882458422e-01,  4.573233787957925e-01, -2.451062726280973e-01,  4.336885586148986e-01, -7.834079981842945e-01,  9.166943391253495e-01, 1.716240655731737e-01,  6.264803777310277e-01, 5.818727571694549e-03,  1.262438161456028e-04, 3.600061123615382e-03,  1.544004465715114e-03, -2.694623954347131e-04,  1.780995984605714e-03, -1.763963190303177e-04, -3.419081701221544e-03, -4.533237219255594e-03, -6.771287597439619e-03, -1.118990499156932e-03,  1.262438161455995e-04, 2.274151071432750e-02, -6.140951391686788e-03, 6.373292998407138e-03,  2.856359737841881e-03, 1.357075132640078e-02,  1.397134537831622e-02, 3.857378801434785e-04, -3.172829363208935e-03, 7.436122551418740e-04, -6.519806177090011e-03, 3.600061123615382e-03, -6.140951391686775e-03, 1.948346510848866e-02,  3.185184497027486e-03, 2.006727256530956e-03,  8.312244923504278e-03, -1.211684319238674e-02, -6.558656810597922e-03, -1.170460675088519e-03, -8.147540996787538e-03, 4.208732788384436e-04,  1.544004465715113e-03, 6.373292998407162e-03,  3.185184497027499e-03, 4.303636019447936e-02, -1.854622953621046e-03, 1.110810812018847e-03,  1.889562405216926e-03, 5.375135767218158e-03, -5.759933993917739e-04, -2.515464579673798e-03,  1.003964829579445e-02, -2.694623954347143e-04,  2.856359737841842e-03, 2.006727256530934e-03, -1.854622953621060e-03, 1.211187091717125e-02,  4.069370220893716e-03, 4.876906439511650e-03, -1.132975557348766e-02, 9.435344008069715e-03,  2.694425071224308e-04, 2.975823811688751e-03,  1.780995984605716e-03, 1.357075132640077e-02,  8.312244923504275e-03, 1.110810812018863e-03,  4.069370220893671e-03, 3.713165075755478e-02, -2.769526355701791e-03, -1.210747988129526e-03,  2.160193019635335e-03, 3.591625825641818e-03, -9.804859513257581e-03, -1.763963190303155e-04,  1.397134537831622e-02, -1.211684319238672e-02,  1.889562405216931e-03, 4.876906439511620e-03, -2.769526355701797e-03, 2.815231082070524e-02, -7.655436656436176e-03, 5.760001204812564e-04, -5.627501306059248e-03, 1.840945533056586e-03, -3.419081701221546e-03, 3.857378801434510e-04, -6.558656810597914e-03, 5.375135767218135e-03, -1.132975557348764e-02, -1.210747988129494e-03, -7.655436656436154e-03, 3.643622872495084e-02, -7.677998972437951e-03, 1.200073681017258e-02, -6.993576618659705e-03, -4.533237219255595e-03, -3.172829363208914e-03, -1.170460675088472e-03, -5.759933993917915e-04, 9.435344008069713e-03,  2.160193019635321e-03, 5.760001204812613e-04, -7.677998972437909e-03, 3.214829287624230e-02,  1.671854267198206e-02, 1.148131199773626e-02, -6.771287597439616e-03, 7.436122551418915e-04, -8.147540996787564e-03, -2.515464579673779e-03,  2.694425071224324e-04, 3.591625825641802e-03, -5.627501306059282e-03, 1.200073681017256e-02,  1.671854267198206e-02, 3.187824655394818e-02,  1.775689801057896e-04, -1.118990499156930e-03, -6.519806177090057e-03, 4.208732788384020e-04,  1.003964829579445e-02, 2.975823811688740e-03, -9.804859513257540e-03, 1.840945533056601e-03, -6.993576618659765e-03, 1.148131199773619e-02,  1.775689801058490e-04, 1.784634074230639e-02,  4.867520091884474e-03, 2.931852322295813e-04,  2.782232607263124e-03, 9.694566790729146e-04, -2.215119884032467e-04, 1.125020956407128e-03,  2.484404537058639e-04, -2.526968688104035e-03, -3.652285063252378e-03, -5.716716196632591e-03, -1.160623121328822e-03, 2.931852322295758e-04,  2.008113359881302e-02, -4.910539212626836e-03,  5.951876055023292e-03, 2.704175840679183e-03,  1.259927784544745e-02, 1.227604657616855e-02, -2.361920749531710e-05, -2.563108880605941e-03,  2.534325648852608e-04, -5.631465777837545e-03,  2.782232607263117e-03, -4.910539212626836e-03,  1.593673365098888e-02, 2.037001401178432e-03,  1.524699251273278e-03, 7.065953145871664e-03, -9.932594220997366e-03, -5.267048373655530e-03, -1.144758498245893e-03, -6.429227220462998e-03,  6.461217704969421e-05, 9.694566790729170e-04,  5.951876055023305e-03, 2.037001401178439e-03,  3.775327122377364e-02, -1.431569105397356e-03,  1.078555115412519e-03, 2.158589627172442e-03,  5.174148989583011e-03, 5.704761825689761e-04, -1.033015612538175e-03, 9.140157460928659e-03, -2.215119884032591e-04, 2.704175840679167e-03,  1.524699251273258e-03, -1.431569105397363e-03,  1.061307065474743e-02, 3.772317438125509e-03,  4.643085199245575e-03, -1.023000580228942e-02,  8.525592417597143e-03, 3.119993378890696e-04,  2.882150010122053e-03, 1.125020956407130e-03,  1.259927784544741e-02, 7.065953145871660e-03,  1.078555115412530e-03, 3.772317438125472e-03,  3.295139310557337e-02, -2.117219971547685e-03, -7.976030129196094e-04, 1.995030484605571e-03,  3.636494777616651e-03,
                  -9.003897122932052e-03,  2.484404537058641e-04, 1.227604657616856e-02, -9.932594220997360e-03, 2.158589627172440e-03,  4.643085199245568e-03, -2.117219971547713e-03,  2.458318694009202e-02, -7.762317929809138e-03,  5.970050505416023e-04, -5.672928805895467e-03,  1.844243505923207e-03, -2.526968688104042e-03, -2.361920749533310e-05, -5.267048373655520e-03,  5.174148989582995e-03, -1.023000580228938e-02, -7.976030129195915e-04, -7.762317929809126e-03,  3.219188560856599e-02, -6.750364746506870e-03,  1.101542794557540e-02, -6.305185107256436e-03, -3.652285063252377e-03, -2.563108880605946e-03, -1.144758498245839e-03, 5.704761825689629e-04,  8.525592417597240e-03, 1.995030484605566e-03,  5.970050505416307e-04, -6.750364746506820e-03,  2.895269736973003e-02, 1.546828276987066e-02,  1.059954122239887e-02, -5.716716196632592e-03,  2.534325648852832e-04, -6.429227220463017e-03, -1.033015612538179e-03, 3.119993378890431e-04,  3.636494777616643e-03, -5.672928805895481e-03,  1.101542794557541e-02, 1.546828276987065e-02,  2.845624605409663e-02, 6.468518870157899e-04, -1.160623121328831e-03, -5.631465777837572e-03,  6.461217704965995e-05, 9.140157460928659e-03,  2.882150010121991e-03, -9.003897122932021e-03,  1.844243505923190e-03, -6.305185107256497e-03,  1.059954122239883e-02, 6.468518870157945e-04,  1.600617220779430e-02, 4.915916771389655e-03,  1.504643176735653e-03, 2.267186436462472e-03,  5.532007448717613e-04, 1.057525270848222e-03,  2.244022688670431e-03, 2.082403867837502e-03, -5.047553173127212e-03, -2.475863849095017e-03, -5.900170551417653e-03, -6.349550576700764e-04,  1.504643176735650e-03, 1.274964211851494e-02, -3.405034378290580e-03, 3.361589416270198e-03,  1.468356636412900e-03, 7.104695894966350e-03,  7.526942310925273e-03, 3.503579126045738e-04, -1.349076016394272e-03, 5.146710136991322e-04, -3.269033958005918e-03, 2.267186436462471e-03, -3.405034378290577e-03, 1.092858309521149e-02,  1.277367816067912e-03, 9.433254500774337e-04,  4.262370905808248e-03, -6.380382223934012e-03, -3.254651741738546e-03, -3.902434215624480e-04, -3.995906580888275e-03, 2.091405351993442e-04,  5.532007448717617e-04, 3.361589416270208e-03,  1.277367816067916e-03, 2.347046882253401e-02, -1.081935483603735e-03, 5.700352366268655e-04,  8.702494291174714e-04, 3.685546539940436e-03,  3.226564328852394e-04, -3.614432396699175e-04,  5.337616222593435e-03, 1.057525270848217e-03,  1.468356636412875e-03, 9.433254500774335e-04, -1.081935483603757e-03, 7.545593885410927e-03,  2.167018462490014e-03, 2.918633445095581e-03, -6.498802542185966e-03, 5.687503596604044e-03,  3.572042734227329e-04, 1.879661485165897e-03,  2.244022688670432e-03, 7.104695894966347e-03,  4.262370905808267e-03, 5.700352366268732e-04,  2.167018462489987e-03, 2.074958810314191e-02, -1.442035172338567e-03, -3.239542394249771e-04,  1.719236277775055e-03, 2.440286765167557e-03, -5.090239633997934e-03, 2.082403867837504e-03,  7.526942310925298e-03, -6.380382223934016e-03,  8.702494291174743e-04, 2.918633445095567e-03, -1.442035172338594e-03, 1.650330606881262e-02, -5.184852563882368e-03, 5.236014529329792e-04, -3.762408996772056e-03, 1.198083815825637e-03, -5.047553173127213e-03, 3.503579126045540e-04, -3.254651741738558e-03, 3.685546539940423e-03, -6.498802542185959e-03, -3.239542394249641e-04, -5.184852563882360e-03, 2.252565761952155e-02, -4.850534712594798e-03, 7.034946780720955e-03, -4.168791964240825e-03, -2.475863849095018e-03, -1.349076016394274e-03, -3.902434215624474e-04,  3.226564328852380e-04, 5.687503596604102e-03,  1.719236277775043e-03, 5.236014529329742e-04, -4.850534712594769e-03, 1.913498052288909e-02,  9.523640448027552e-03, 6.534761510828735e-03, -5.900170551417653e-03, 5.146710136991484e-04, -3.995906580888286e-03, -3.614432396699183e-04,  3.572042734226731e-04, 2.440286765167564e-03, -3.762408996772061e-03, 7.034946780720934e-03,  9.523640448027546e-03, 1.933521545365383e-02,  2.426220103744389e-04, -6.349550576700778e-04, -3.269033958005949e-03, 2.091405351993437e-04,  5.337616222593447e-03, 1.879661485165854e-03, -5.090239633997913e-03, 1.198083815825655e-03, -4.168791964240861e-03, 6.534761510828731e-03,  2.426220103744290e-04, 1.048292030266827e-02,  5.108583041610280e-03, -9.619322925421885e-04,  2.869093151346226e-03, 2.185797267391859e-04, -3.065382423559301e-05, -4.634078306608441e-04,  3.497192071749009e-04, -4.428129876728065e-03, -3.807943638323504e-03, -7.071366256152093e-03, -1.571967992126945e-04, -9.619322925421917e-04,  9.587335290697600e-03, -2.524796713462719e-03,  2.619180510933472e-03, 1.195173255159028e-03,  4.773153812798031e-03, 5.308567259142000e-03,  1.603628618153916e-04, -8.358577845388991e-04,  5.718918020448930e-04, -2.050730661204755e-03,  2.869093151346226e-03, -2.524796713462704e-03,  9.169857618579975e-03, 1.074813802351219e-03,  6.590019708496509e-04, 3.646742804740755e-03, -4.978403110663396e-03, -2.752571150554949e-03, -7.705453454369051e-04, -3.832009540829671e-03, -4.839950112265262e-05, 2.185797267391859e-04,  2.619180510933477e-03, 1.074813802351218e-03,  1.789191272015759e-02, -6.283241899375360e-04,  2.940266656015616e-04, 7.597846578789359e-04,  2.393959467603159e-03, -8.047210456256836e-05, -7.516854358543163e-04, 3.920114694374846e-03, -3.065382423560030e-05, 1.195173255159026e-03,  6.590019708496528e-04, -6.283241899375567e-04,  6.063262963191578e-03, 1.885205298262910e-03,  1.973162443242304e-03, -4.653783491009490e-03,  4.602476751632494e-03, 7.838505455045597e-04,  1.472012041420437e-03, -4.634078306608432e-04,  4.773153812798009e-03, 3.646742804740756e-03,  2.940266656015666e-04, 1.885205298262891e-03,  1.538933380708564e-02, -1.690925230524547e-03, -7.399867608264840e-04, 1.668709547235864e-03,  1.903259968898524e-03, -3.289864324192730e-03,  3.497192071749021e-04, 5.308567259141994e-03, -4.978403110663396e-03, 7.597846578789394e-04,  1.973162443242304e-03, -1.690925230524550e-03,  1.245794683907869e-02, -3.551230213679256e-03,  1.752680276838608e-04, -2.752906659221839e-03,  1.021334234833998e-03, -4.428129876728070e-03,  1.603628618153643e-04, -2.752571150554939e-03,  2.393959467603170e-03, -4.653783491009494e-03, -7.399867608264775e-04, -3.551230213679243e-03,  1.741811990139091e-02, -3.260102356266601e-03,  5.639083258706670e-03, -2.876806173890462e-03, -3.807943638323505e-03, -8.358577845388965e-04, -7.705453454369019e-04, -8.047210456256008e-05,  4.602476751632518e-03, 1.668709547235866e-03,  1.752680276838598e-04, -3.260102356266599e-03,  1.608758112223290e-02, 9.003045627931548e-03,  5.055314711797342e-03, -7.071366256152089e-03,  5.718918020448994e-04, -3.832009540829668e-03, -7.516854358543133e-04, 7.838505455045434e-04,  1.903259968898497e-03, -2.752906659221833e-03,  5.639083258706635e-03, 9.003045627931557e-03,  1.745928729163508e-02, 5.778266812459106e-04, -1.571967992126937e-04, -2.050730661204776e-03, -4.839950112265614e-05, 3.920114694374841e-03,  1.472012041420385e-03, -3.289864324192711e-03,  1.021334234834006e-03, -2.876806173890425e-03,  5.055314711797359e-03, 5.778266812459204e-04,  7.930325061386910e-03, 5.306697773431113e-03, -4.207950504676769e-04, 1.473199844296815e-03, -1.065960869467364e-03, 1.054634960161757e-03, -1.327393050355871e-03, 2.633608283808650e-03, -6.450369128653577e-03, -2.117054956613472e-03,
                  -6.616429231713152e-03, 5.904910834944888e-04, -4.207950504676787e-04, 1.047163698712043e-02, -2.768305343664087e-03, 2.871332594290260e-03,  1.376931296643471e-03, 5.908353136703008e-03,  6.341573589021028e-03, -6.396631981886626e-05, -8.472556776475732e-04, 3.900509590446765e-04, -2.408204827222355e-03, 1.473199844296816e-03, -2.768305343664057e-03, 9.594588922003211e-03,  1.534365983910977e-03, 6.115178986417234e-04,  4.088194167484060e-03, -5.906168572659317e-03, -3.120732369497139e-03, -1.146778430343214e-03, -4.139110687788120e-03, -6.941946879708827e-05, -1.065960869467363e-03, 2.871332594290264e-03,  1.534365983910968e-03, 1.933880380819483e-02, -6.093745560774463e-04, 5.411841946218186e-04,  6.674821608835819e-04, 2.400321723850110e-03, -9.906206733259707e-05, -1.041682092440952e-03,  4.483951924809145e-03, 1.054634960161758e-03,  1.376931296643451e-03, 6.115178986417116e-04, -6.093745560774553e-04, 5.851552498943461e-03,  2.211667622792266e-03, 2.398566190741737e-03, -5.301378108343343e-03, 4.604709279775138e-03,  4.770002280641050e-04, 1.515955348780120e-03, -1.327393050355870e-03, 5.908353136702976e-03,  4.088194167484064e-03, 5.411841946218171e-04,  2.211667622792237e-03, 1.719016850343427e-02, -1.798270967884503e-03, -9.824488594804613e-04,  1.661604466095464e-03, 2.067495127533269e-03, -4.111383144044353e-03, 2.633608283808652e-03,  6.341573589021033e-03, -5.906168572659313e-03,  6.674821608835874e-04, 2.398566190741727e-03, -1.798270967884507e-03, 1.432705975092105e-02, -4.579798946218511e-03, 4.450464746780343e-04, -3.037127666760524e-03, 1.145029310675893e-03, -6.450369128653575e-03, -6.396631981888366e-05, -3.120732369497160e-03, 2.400321723850132e-03, -5.301378108343321e-03, -9.824488594804544e-04, -4.579798946218508e-03, 1.929903902593924e-02, -3.274351445483045e-03, 6.951923575775612e-03, -3.155676485614452e-03, -2.117054956613479e-03, -8.472556776475621e-04, -1.146778430343209e-03, -9.906206733259055e-05, 4.604709279775195e-03,  1.661604466095456e-03, 4.450464746780456e-04, -3.274351445482976e-03, 1.625393910001056e-02,  9.479092517869651e-03, 5.198353399205903e-03, -6.616429231713145e-03, 3.900509590446937e-04, -4.139110687788110e-03, -1.041682092440954e-03,  4.770002280640591e-04, 2.067495127533263e-03, -3.037127666760535e-03, 6.951923575775528e-03,  9.479092517869662e-03, 1.788958828058750e-02,  4.633164149849722e-04, 5.904910834944882e-04, -2.408204827222385e-03, -6.941946879707167e-05,  4.483951924809132e-03, 1.515955348780075e-03, -4.111383144044344e-03, 1.145029310675904e-03, -3.155676485614442e-03, 5.198353399205897e-03,  4.633164149849902e-04, 8.209868619375803e-03,  3.854656872251399e-03, -5.686799924609559e-04,  6.810351886452549e-04, -3.775574735450057e-04,  1.866486911935148e-03, -1.059779213195093e-03,  2.107395581464912e-03, -6.014022111787653e-03,  1.671695741804107e-03, -2.558292338489411e-03,  1.925385746744143e-03, -5.686799924609597e-04,  4.752469098110489e-03, -1.052892501216991e-03,  8.289910457937276e-04, 2.985237687897542e-04,  1.928876681299119e-03, 1.847147692396287e-03,  5.414550285123032e-04, -5.789672893344097e-04,  3.581235111129937e-04, -1.105440750382808e-03,  6.810351886452549e-04, -1.052892501216980e-03,  4.499992269663437e-03, 4.342875676217290e-04,  4.140137369825925e-04, 1.113709666343750e-03, -1.774517694351680e-03, -1.579268179507670e-03, -1.078540005883329e-04, -1.498594142321282e-03,  2.107077012603930e-04, -3.775574735450062e-04,  8.289910457937313e-04, 4.342875676217315e-04,  7.551996530304495e-03, -3.295623548267038e-04,  3.608047690405791e-05, 1.204739206977637e-04,  1.114544745300803e-03, -1.995040330050154e-04, -2.244478324730912e-04, 1.427261789439171e-03,  1.866486911935154e-03, 2.985237687897072e-04,  4.140137369826068e-04, -3.295623548266914e-04,  3.753061496865770e-03, 3.145117409283806e-04,  1.355658566993869e-03, -3.119502384166738e-03,  1.625659533855448e-03, -7.793907881743520e-04,  8.132450656674420e-04, -1.059779213195094e-03,  1.928876681299104e-03, 1.113709666343752e-03,  3.608047690405618e-05, 3.145117409283793e-04,  7.022065318478474e-03, -8.483669283526686e-04,  5.250794599184539e-04, 2.518535017975238e-04,  9.027798420704477e-04, -1.669348734944285e-03,  2.107395581464915e-03, 1.847147692396287e-03, -1.774517694351670e-03, 1.204739206977681e-04,  1.355658566993844e-03, -8.483669283526862e-04,  6.605293890297114e-03, -2.823226725797710e-03,  6.376495165978657e-04, -1.621977537686798e-03,  8.861651100970925e-04, -6.014022111787656e-03,  5.414550285122730e-04, -1.579268179507666e-03,  1.114544745300790e-03, -3.119502384166703e-03,  5.250794599184685e-04, -2.823226725797678e-03,  1.371616753256162e-02, -2.149358165445565e-03,  4.102055543852206e-03, -2.377236823381624e-03,  1.671695741804107e-03, -5.789672893344030e-04, -1.078540005883375e-04, -1.995040330050138e-04,  1.625659533855504e-03, 2.518535017975271e-04,  6.376495165978683e-04, -2.149358165445533e-03,  6.672636831774940e-03, 1.862312891680486e-03,  2.004508052992314e-03, -2.558292338489407e-03,  3.581235111130108e-04, -1.498594142321278e-03, -2.244478324730864e-04, -7.793907881744023e-04,  9.027798420704312e-04, -1.621977537686820e-03,  4.102055543852173e-03, 1.862312891680498e-03,  7.450473481007346e-03, -7.312801676069236e-04,  1.925385746744138e-03, -1.105440750382820e-03,  2.107077012604092e-04, 1.427261789439162e-03,  8.132450656674411e-04, -1.669348734944292e-03,  8.861651100971199e-04, -2.377236823381646e-03,  2.004508052992320e-03, -7.312801676069026e-04,  4.676169434112422e-03, 4.640626054187414e-03, -1.548184868416825e-03, 1.129419102455862e-03, -1.805156740097674e-03, 2.175028324951794e-03, -1.593957191965641e-03, 1.808027589232426e-03, -7.248190268319484e-03, 2.126621913695327e-03, -3.013929167982338e-03, 2.160854637528191e-03, -1.548184868416831e-03, 6.513508229539861e-03, -1.782057618741881e-03, 1.603564040904003e-03,  3.308635261762909e-04, 3.237882893924944e-03,  2.800504950165895e-03, 1.277140355153625e-03, -8.269462371445182e-04, 1.058199112493015e-03, -1.728768226763433e-03, 1.129419102455861e-03, -1.782057618741877e-03, 5.737015568966784e-03,  4.047906971989444e-04, 5.385026661283133e-04,  1.588633156618858e-03, -2.726935522600882e-03, -2.346487737047739e-03, -2.942104535211615e-04, -2.353053993418799e-03, 3.023714763162004e-04, -1.805156740097669e-03, 1.603564040904007e-03,  4.047906971989474e-04, 1.081300514686891e-02, -8.605617846768523e-04, 4.535006151012073e-04, -3.932615257737435e-05, 2.884073755706814e-03, -4.310783680136490e-04, 4.374325222985203e-04,  1.751463530403868e-03, 2.175028324951810e-03,  3.308635261762661e-04, 5.385026661283194e-04, -8.605617846768345e-04, 4.259076352632293e-03,  6.014677948256423e-04, 1.642338645042141e-03, -4.111646420486926e-03, 2.347286889996432e-03, -7.588927809935744e-04, 1.003338700754288e-03, -1.593957191965644e-03, 3.237882893924945e-03,  1.588633156618865e-03, 4.535006151012086e-04,  6.014677948256592e-04, 9.517730907585632e-03, -1.091065531345275e-03, 8.291693081294042e-04,  1.784975093756245e-04, 1.541910782032139e-03, -2.509059277530218e-03, 1.808027589232428e-03,  2.800504950165900e-03, -2.726935522600876e-03, -3.932615257737430e-05, 1.642338645042128e-03, -1.091065531345280e-03, 8.040298264651200e-03, -3.258463379900165e-03,
                  8.886993833284199e-04, -1.523655658794589e-03, 9.215334677673716e-04, -7.248190268319480e-03, 1.277140355153589e-03, -2.346487737047748e-03, 2.884073755706834e-03, -4.111646420486857e-03, 8.291693081293982e-04, -3.258463379900155e-03, 1.673317973784563e-02, -3.006728335634014e-03, 5.410656137667610e-03, -2.923699032201961e-03, 2.126621913695326e-03, -8.269462371445250e-04, -2.942104535211703e-04, -4.310783680136505e-04, 2.347286889996440e-03,  1.784975093756392e-04, 8.886993833284186e-04, -3.006728335633989e-03, 8.448379395703223e-03,  2.790122419715803e-03, 2.725576499930636e-03, -3.013929167982338e-03, 1.058199112493020e-03, -2.353053993418787e-03, 4.374325222985171e-04, -7.588927809936143e-04, 1.541910782032134e-03, -1.523655658794580e-03, 5.410656137667585e-03,  2.790122419715806e-03, 9.243654311439304e-03, -7.996987142129609e-04, 2.160854637528181e-03, -1.728768226763439e-03, 3.023714763162033e-04,  1.751463530403876e-03, 1.003338700754327e-03, -2.509059277530229e-03, 9.215334677673760e-04, -2.923699032201941e-03, 2.725576499930635e-03, -7.996987142129617e-04, 5.418841189488586e-03,  5.100254692147784e-03, -1.148821174178866e-03,  8.325466627743571e-04, -9.437084804241253e-04,  2.788672561869190e-03, -1.410460664336489e-03,  2.608846243175006e-03, -8.018352557517464e-03,  3.547713190980939e-03, -2.457034048555378e-03,  3.038343783716625e-03, -1.148821174178868e-03,  6.245433638268506e-03, -1.568093743989431e-03,  1.188238074503007e-03, 1.549968756227566e-04,  3.054975842030364e-03, 2.553598851957431e-03,  1.166306371928980e-03, -1.208833042305009e-03,  6.450709155450667e-04, -1.851479696666066e-03,  8.325466627743538e-04, -1.568093743989410e-03,  5.413444716501330e-03, 6.218462958782218e-04,  5.478413094643325e-04, 1.322909869245722e-03, -2.447488412623525e-03, -2.175179327552174e-03, -1.605266988278034e-04, -2.062582060299120e-03,  4.191714585227501e-04, -9.437084804241266e-04,  1.188238074503005e-03, 6.218462958782251e-04,  1.041144800976792e-02, -9.084796335203684e-04,  1.122495616257820e-04, -1.602905779159614e-04,  2.541628698433225e-03, -7.102761736333454e-04, -1.949756177352054e-04, 1.708100083920633e-03,  2.788672561869196e-03, 1.549968756227355e-04,  5.478413094643524e-04, -9.084796335203638e-04,  4.743038102584115e-03, 4.063807031135285e-04,  1.985449934343948e-03, -4.826935970353612e-03,  3.131049141509525e-03, -7.217654672898122e-04,  1.554383887985755e-03, -1.410460664336488e-03,  3.054975842030349e-03, 1.322909869245720e-03,  1.122495616257790e-04, 4.063807031135351e-04,  9.164597905052698e-03, -1.005058861757920e-03,  8.963245631263541e-04, 2.902996862560832e-05,  1.476641321351751e-03, -2.520441063488739e-03,  2.608846243175005e-03, 2.553598851957438e-03, -2.447488412623526e-03, -1.602905779159673e-04,  1.985449934343921e-03, -1.005058861757916e-03,  8.293452715125185e-03, -4.066240053732653e-03,  1.596542761602849e-03, -1.675798756215362e-03,  1.418926516001316e-03, -8.018352557517466e-03,  1.166306371928968e-03, -2.175179327552186e-03,  2.541628698433223e-03, -4.826935970353581e-03,  8.963245631263515e-04, -4.066240053732654e-03,  1.829637626962713e-02, -4.487952271276343e-03,  5.083755184264781e-03, -3.976904937507523e-03,  3.547713190980936e-03, -1.208833042305012e-03, -1.605266988278111e-04, -7.102761736333381e-04,  3.131049141509529e-03, 2.902996862561168e-05,  1.596542761602855e-03, -4.487952271276355e-03,  1.000429118802050e-02, 2.567737295979328e-03,  3.654164922909251e-03, -2.457034048555380e-03,  6.450709155450799e-04, -2.062582060299108e-03, -1.949756177352118e-04, -7.217654672898287e-04,  1.476641321351749e-03, -1.675798756215361e-03,  5.083755184264804e-03, 2.567737295979327e-03,  8.759053034976528e-03, -9.762002953399272e-04,  3.038343783716625e-03, -1.851479696666078e-03,  4.191714585227565e-04, 1.708100083920622e-03,  1.554383887985770e-03, -2.520441063488737e-03,  1.418926516001317e-03, -3.976904937507499e-03,  3.654164922909253e-03, -9.762002953399339e-04,  6.164208342389136e-03, 5.575373720894623e-03, -4.156490357375787e-04, 5.094912173410889e-04, -3.595093524674476e-04, 3.112080442788784e-03, -1.103825053201972e-03, 3.522604295107612e-03, -8.426097587318200e-03, 3.780235994949835e-03, -2.589029751925875e-03, 3.199686739713845e-03, -4.156490357375744e-04, 6.637071819405626e-03, -1.684998233493912e-03, 1.099655437497182e-03,  4.275784015503187e-04, 2.858405302529653e-03,  3.199552771800957e-03, 5.487999313644442e-04, -1.018834676494859e-03, 3.958074583988542e-04, -1.747199782509850e-03, 5.094912173410852e-04, -1.684998233493909e-03, 6.152021836980313e-03,  9.252380389719083e-04, 5.160188224208516e-04,  1.829308144886100e-03, -3.061914234499064e-03, -1.996612652616812e-03, -3.055873402294110e-04, -2.109922451877399e-03, 2.703811404398767e-04, -3.595093524674480e-04, 1.099655437497180e-03,  9.252380389719043e-04, 1.146498911489653e-02, -7.411549178949072e-04, 1.266459393350410e-04, -2.834909892057009e-04, 2.044311299344395e-03, -5.459280332654297e-04, -4.450199354944116e-04,  2.192631420665549e-03, 3.112080442788791e-03,  4.275784015503084e-04, 5.160188224208660e-04, -7.411549178948992e-04, 5.229862467645566e-03,  4.669246749817939e-04, 2.336132661413991e-03, -5.056346418310527e-03, 3.252404757812522e-03, -8.504255472018842e-04, 1.573960457419457e-03, -1.103825053201972e-03, 2.858405302529652e-03,  1.829308144886105e-03, 1.266459393350394e-04,  4.669246749817951e-04, 9.639490112812564e-03, -1.130783492579460e-03, 4.888427188202371e-04,  1.663513120413700e-04, 1.263951978126307e-03, -2.438774629767254e-03, 3.522604295107610e-03,  3.199552771800959e-03, -3.061914234499062e-03, -2.834909892056962e-04, 2.336132661413971e-03, -1.130783492579467e-03, 9.837297182199159e-03, -4.590423940717977e-03, 1.739371047107844e-03, -2.096888130520746e-03, 1.479959428911816e-03, -8.426097587318196e-03, 5.487999313644486e-04, -1.996612652616822e-03, 2.044311299344405e-03, -5.056346418310488e-03, 4.888427188202310e-04, -4.590423940717969e-03, 1.920034886862080e-02, -4.294191257096411e-03, 5.433057084934568e-03, -3.872802153465121e-03, 3.780235994949834e-03, -1.018834676494865e-03, -3.055873402294210e-04, -5.459280332654286e-04, 3.252404757812531e-03,  1.663513120413778e-04, 1.739371047107847e-03, -4.294191257096404e-03, 1.064333204813647e-02,  2.863451777398322e-03, 3.829178104536391e-03, -2.589029751925878e-03, 3.958074583988568e-04, -2.109922451877382e-03, -4.450199354944139e-04, -8.504255472019000e-04, 1.263951978126301e-03, -2.096888130520743e-03, 5.433057084934560e-03,  2.863451777398306e-03, 9.635412571069268e-03, -8.976693184911469e-04, 3.199686739713851e-03, -1.747199782509840e-03, 2.703811404398710e-04,  2.192631420665547e-03, 1.573960457419512e-03, -2.438774629767258e-03, 1.479959428911808e-03, -3.872802153465104e-03, 3.829178104536375e-03, -8.976693184911556e-04, 6.704550356864315e-03,  5.449422612265639e-03, -1.824230825314559e-03,  8.051295655459259e-04, 5.805892344299339e-04,  2.729455580733945e-03, -2.727125501635126e-03,  2.386852623299974e-03, -7.848625539178429e-03,  4.051914467712673e-03, -2.328840349948573e-03,  4.104687518981604e-03, -1.824230825314559e-03,  6.960726850161966e-03, -1.582545674540172e-03,  9.679879809765920e-04, 3.462539136775747e-05,  3.216485101466349e-03, 2.227199008315262e-03,
                  1.608482095627996e-03, -1.612321014077967e-03,  9.808986869143067e-04, -2.421400632640986e-03,  8.051295655459259e-04, -1.582545674540172e-03,  6.474785317900143e-03, 9.779908342550231e-04,  7.811660924183800e-04, 1.716244325600570e-03, -2.661832608364882e-03, -2.094656631699075e-03,  7.626378020123090e-05, -2.193085324502278e-03,  4.849643895843374e-04, 5.805892344299339e-04,  9.679879809765920e-04, 9.779908342550231e-04,  1.147789151712682e-02, -4.427974926304037e-04, -1.682441200593428e-04, 3.203164685303763e-04,  7.733785774212637e-04, 8.010495116930316e-05, -7.523943396937630e-04, 2.611438463590231e-03,  2.729455580733945e-03, 3.462539136775747e-05,  7.811660924183800e-04, -4.427974926304037e-04,  5.680484916410006e-03, -1.549152668677411e-04,  1.850034210885510e-03, -4.745608945108438e-03,  3.253038100923574e-03, -7.548800848713918e-04,  1.674852504143416e-03, -2.727125501635126e-03,  3.216485101466349e-03, 1.716244325600570e-03, -1.682441200593428e-04, -1.549152668677411e-04,  1.102939586600780e-02, -1.704845888352648e-03,  1.852985857483922e-03, -6.516678397686695e-04,  1.548182912192216e-03, -3.204643833607945e-03,  2.386852623299974e-03, 2.227199008315262e-03, -2.661832608364882e-03, 3.203164685303763e-04,  1.850034210885510e-03, -1.704845888352648e-03,  8.780133117964495e-03, -3.277692626865079e-03,  1.561402200542255e-03, -1.578204989341893e-03,  1.574157335064102e-03, -7.848625539178429e-03,  1.608482095627996e-03, -2.094656631699075e-03,  7.733785774212637e-04, -4.745608945108438e-03,  1.852985857483922e-03, -3.277692626865079e-03,  1.893520908555326e-02, -4.643683675506168e-03,  4.356130952034516e-03, -4.517487147793108e-03,  4.051914467712673e-03, -1.612321014077967e-03,  7.626378020123090e-05, 8.010495116930316e-05,  3.253038100923574e-03, -6.516678397686695e-04,  1.561402200542255e-03, -4.643683675506168e-03,  1.124374061373513e-02, 2.384490781500766e-03,  4.476529479464560e-03, -2.328840349948573e-03,  9.808986869143067e-04, -2.193085324502278e-03, -7.523943396937630e-04, -7.548800848713918e-04,  1.548182912192216e-03, -1.578204989341893e-03,  4.356130952034516e-03, 2.384490781500766e-03,  9.397616545584082e-03, -1.140679692327849e-03,  4.104687518981604e-03, -2.421400632640986e-03,  4.849643895843374e-04, 2.611438463590231e-03,  1.674852504143416e-03, -3.204643833607945e-03,  1.574157335064102e-03, -4.517487147793108e-03,  4.476529479464560e-03, -1.140679692327849e-03,  7.979421377264031e-03 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$lag_one_cor),
               c( 5.810831057103913e-03, 9.480062190668547e-05,  3.601465789404457e-03, 1.546611360539133e-03, -2.771634020688601e-04, 1.752703077268354e-03, -2.039413026046959e-04, -3.401188354931832e-03, -4.516262932195904e-03, -6.749422118671741e-03, -1.102927519791506e-03, 1.167775238776399e-04,  2.249595481054259e-02, -6.105764679187230e-03,  6.263375685872120e-03, 2.753492228818760e-03,  1.333576628761186e-02, 1.376978354963107e-02,  5.016401347665295e-04, -3.246577741823781e-03,  7.375200137349522e-04, -6.500203723269263e-03,  3.571873535469105e-03, -6.099974046499821e-03,  1.941888868337854e-02, 3.198651433457359e-03,  2.064352295494380e-03, 8.310308324489405e-03, -1.203303841833662e-02, -6.607065676977629e-03, -1.025369860068839e-03, -8.052070359897264e-03,  4.808056099428694e-04, 1.545519190277254e-03,  6.266161112717518e-03, 3.199542327933371e-03,  4.281945762220329e-02, -1.887708769155219e-03,  1.041234047596870e-03, 1.804040032865654e-03,  5.384433113938672e-03, -6.353723730316088e-04, -2.535811766547368e-03, 9.981095776112260e-03, -2.437986279081409e-04, 2.760172978011373e-03,  2.049674974484534e-03, -1.883634403408197e-03,  1.182820797252616e-02, 4.031635227205641e-03,  4.586384997460136e-03, -1.084838712713557e-02,  8.978960968750189e-03, 2.096553541633419e-04,  2.726595499087413e-03, 1.769691020606300e-03,  1.333627108927809e-02, 8.308107652102536e-03,  1.038515519329566e-03, 4.034461037637254e-03,  3.680772287057199e-02, -2.843243120872752e-03, -1.246324307715275e-03, 2.178889706312409e-03,  3.544524519724818e-03, -9.681609509543707e-03, -1.667694413212103e-04, 1.376997106334175e-02, -1.204352273110036e-02, 1.805573655368592e-03,  4.568843112293484e-03, -2.849671355693569e-03,  2.774132082838089e-02, -7.122137510304228e-03,  1.574238913154122e-04, -5.621546004748085e-03,  1.603299408886863e-03, -3.424173247372484e-03,  4.835582239693406e-04, -6.579624646284925e-03,  5.376872117854505e-03, -1.086087481745245e-02, -1.242561385083520e-03, -7.161578836751464e-03,  3.552208557714026e-02, -7.021756315757036e-03,  1.192139646343729e-02, -6.566997448221018e-03, -4.428037661755348e-03, -3.244753939340509e-03, -1.042885618824763e-03, -6.248662093333464e-04,  8.968836261563745e-03, 2.170349483221296e-03,  1.775330533121439e-04, -6.989021628453437e-03,  3.119737930024990e-02, 1.638464683908914e-02,  1.098982132446129e-02, -6.687331181621168e-03,  7.303679295802522e-04, -8.053430779340500e-03, -2.531909881664807e-03, 2.005430734244605e-04,  3.543247311201129e-03, -5.623484387698266e-03,  1.194180571359268e-02, 1.638307049270753e-02,  3.153704144642536e-02, 8.582404064844899e-05, -1.075889656371362e-03, -6.495933225163442e-03,  4.708845102805644e-04, 9.987134975587463e-03,  2.722653621621940e-03, -9.685285366097380e-03,  1.614443163809982e-03, -6.551661502400562e-03,  1.098800090586504e-02, 8.738069182660476e-05,  1.751950436800671e-02, 9.365591895615776e-04, -4.760343074296169e-04, 1.104814072380809e-03,  8.678949226411670e-04, -7.995332440471288e-05,  1.931628917300037e-04, -8.063871093506275e-04, -7.278187927746351e-04, -4.279173216869079e-04, -9.625740563226422e-04, 9.419316612984112e-05, -3.936181754683470e-04, 3.349958772240431e-03, -7.896593928473977e-04, -5.365918962182610e-04,  6.571646896119708e-05, -1.177412360163153e-03,  1.158206290122832e-04, 1.260475536274342e-04, -1.948555548969128e-04, 7.708520744244543e-04, -3.247115938172997e-04, 1.276041198985356e-03, -7.638695607935170e-04, 5.589723326057477e-03,  8.849567472047123e-04, 6.995769215131237e-04,  9.111799382063765e-04, -1.331771345359924e-03, -2.172081400535000e-04, 5.665475487783198e-04, -8.856039262700325e-04, 2.959041992461491e-04,  8.404298125122791e-04, -5.445537253213799e-04,  8.483703944154447e-04, 4.905858933218804e-03, -1.943910886012377e-04, -3.256565442318535e-04, -9.753990969451643e-04, -5.591110914390175e-04, -3.802607695995853e-04, -4.125203455777633e-04,  3.541631931085077e-04, -2.182843528501934e-05,  8.128106884133703e-05, 6.863134549021353e-04, -2.094379672886736e-04, 4.055722126979234e-03, -2.652514211899956e-04, -4.521144428570262e-04,  9.122970406368431e-04, -2.815679474641522e-04, -5.866139283743879e-05, -6.829954704564301e-04,  1.102230976993702e-04, -1.201604274120290e-03,  8.970919455805826e-04, -2.674086925936809e-04, -2.948130057011153e-04, 3.929497281344068e-03, -9.609595155132929e-04, -4.266111274277515e-04,  4.636131640927204e-04, -5.786192915787458e-04,  7.195894140784908e-04, -7.354908790085803e-04,  1.013215550473342e-04, -1.320443025816882e-03, -9.897303883007334e-04, -4.720033867162531e-04, -9.011109958512621e-04, 4.433126232273713e-03,  1.825004591481317e-03, -3.161229472326622e-04, -1.637006402109694e-05, -2.570100504671539e-04, -6.069274738322427e-04, 2.084772755465619e-04, -3.549985021431916e-04, -6.195404911029964e-04,  9.216319526032472e-04, -3.660708246058204e-04,  1.967221528122723e-03, 4.019681441311651e-03,  1.185785614070704e-03, -1.115327828054064e-03,  7.480395692285088e-04, -2.780124989757979e-04, -1.104196571800483e-04, 4.319777360719861e-04, -5.053195980452001e-04, -3.673977871752982e-04,  5.433093201768531e-04, -1.922230507566977e-04,  1.230192435416921e-03, 2.846239691767642e-03, -8.771006302272875e-04, -5.823200135935767e-04, -1.157655751715928e-03, 7.682575824209121e-04, -9.959828339926461e-04, -5.549343263898405e-04, -1.094169293077881e-04, -5.264758289902822e-04, -3.266372221066155e-05, -1.070819176947614e-03, -8.183425156144414e-04, 4.893376361298813e-03, -8.133499217999502e-04, -4.407925064905320e-05, -3.602855736101638e-04, 3.577928717244461e-04,  3.842736744643421e-04, -6.614259629055125e-04,  6.510772095963658e-04, -2.520679962419103e-04,  6.795878982355655e-04, -4.952103628190667e-04, -8.642605372634405e-04, 3.759684385645307e-03,  7.500009866002779e-04, 1.490296925150898e-05,  7.882506321508936e-04, 4.373111192543263e-04,  1.638335540305046e-04, 2.075355990714458e-04, -9.969506598055523e-05, -7.945787167695560e-04, -8.431145642671652e-05, -9.502377512713405e-04, -9.124115654211547e-05, -3.056432849105325e-04,  2.358018525082314e-03, -3.263028956173612e-04, -3.759596508146406e-04, -6.370916342986633e-05, -1.118775518485272e-03, -4.021314144064844e-04,  2.737939961539096e-04, 1.559682679458168e-05,  5.752078303565831e-04, -7.324049503620433e-05,  7.780663275358869e-04, -1.170125239303849e-04,  3.813182231756557e-03, 3.302255248462882e-04,  5.601815821992128e-04, 4.660466402544392e-04, -1.636695148806628e-04, -2.497172591939764e-04,  4.068405439715375e-04, -4.902647653686996e-04,  2.052998038722183e-04, 6.007169358924380e-04, -2.713583847781210e-04, 3.772438350007815e-04,  2.770083467638276e-03, 6.096794745196794e-05, -4.347815094403305e-05, -3.812039889233557e-04, -8.598957896307075e-04, -2.187256495575741e-04, -3.193063581900158e-04, -4.136967569311981e-05, -6.864327668064122e-05, -7.492474673287007e-06,  3.393439487322476e-04, -7.226731913157679e-05,  3.204801404860116e-03, -3.294332551897966e-04, -3.843258417556110e-04, 1.030610284789033e-03, -3.115590649914678e-04, 9.029966503017265e-05, -4.545292259958320e-04, 1.722098347186146e-04, -9.562118787537176e-04, 3.051959033434388e-04, -2.180801977942472e-04, -3.019143018750020e-04,  2.530649861204898e-03, -3.891503664568734e-04, -1.214688207197418e-04, 2.415587408971075e-04, -4.410155108907771e-04,
                  5.869791657637533e-04, -6.019196661038572e-04, -4.182028445985355e-04, -4.300194701528800e-04, -5.256904832809726e-04, -4.843164135534274e-04, -5.357807833993772e-04,  2.699413539144444e-03, 1.723418011964392e-03, -1.186271779358955e-04, 1.736158273468969e-04, -1.909087008919659e-04, -6.163862436886873e-04, -3.545912253427330e-05, 9.063570638445542e-05, -3.371490065375742e-04, 6.578189404116237e-04, -2.238737170886941e-04, 1.034601766833177e-03,  3.281840943934757e-03, 8.233014343835539e-04, -8.883272074334553e-04, 4.883275488595925e-04, -3.258640871934259e-04, -1.336361266497598e-04,  3.715503626913492e-04, -1.334965447402993e-04, -4.313017279588094e-04, 1.416695008630221e-04, -2.867457100953468e-04, 1.145755577821327e-03,  2.028589028377368e-03, -8.169980770487972e-04, -4.967047930868984e-04, -8.501126593634414e-04,  2.318229312898827e-04, -4.024453999254161e-04, -1.360813559952605e-04, -1.668729365614463e-04, -6.384620171348517e-04, -3.051080802701465e-04, -7.677770881799103e-04, -8.012780247035342e-04,  3.859283300841226e-03, -5.152074697697945e-04,  3.251794811935573e-05, 1.618604763538225e-05,  1.537316397649675e-04, -6.092838286023139e-05, -4.589060760915133e-04, 7.515742284139328e-04, -9.057183080917386e-05, 5.671239800382369e-04, -6.381066619939304e-04, -6.205789691444887e-04,  2.853867890602203e-03, 8.094306393487826e-04, -2.867720801329691e-04, 6.135630066177540e-04,  2.687131912105429e-04, -2.296396996780411e-05, -5.101845935808903e-05, -2.883662942924030e-04, -8.191907236398239e-04, -4.337841649428655e-04, -1.057830285468831e-03, 2.759142641565936e-05, -5.796376603731404e-05, 1.782786973998010e-03,  1.031272611469629e-04, -1.979125630993377e-04, -2.610129253739508e-05, -7.907456510404297e-04, -5.874947542005298e-04, -8.750365218434619e-05, -3.107665966744881e-06, 1.182014746803506e-04,  1.678439402375746e-04, 6.272501059078878e-04, -1.674414359700793e-04, 2.858818883920698e-03,  8.017124221145584e-05, 1.595939767722470e-04, -8.640722652218484e-05, 1.840093611971995e-05,  5.455578687849430e-05, 5.548182989970780e-05, -4.333264094339173e-04, 7.650949812017925e-05,  4.474212320390893e-04, -3.829726662166298e-04,  1.867707224617628e-04, 1.430107889671586e-03,  2.663051083504991e-05, -2.248815794574828e-04, -2.636408681224449e-04, -6.220694091078772e-04, -2.054966020712151e-04, -3.177344886410129e-04, -2.808366003844156e-04, 9.684175201356676e-05, -8.362416114935886e-05, 3.109238096007627e-04,  1.848243400644251e-04, 2.541699502031618e-03, -3.242290074153375e-04, -3.690776648837788e-04,  7.245989642032599e-04, -4.482723687765969e-04, -1.184551282562579e-04, -3.025851396047681e-04,  3.031298718026019e-04, -9.273803537048519e-04,  9.928531972890455e-05, -1.317575902355698e-04, -2.895262848231405e-04, 1.559965964608527e-03, -1.199966386838713e-04, -2.233140395210894e-04, -9.624035115654008e-05, -6.994938405742780e-04,  6.364762725319280e-04, -1.883419150031605e-04, -5.316918179380495e-04, 1.614962270847248e-04, -2.426353551611215e-04, -3.278386208707436e-04, -9.992093150250423e-05, 1.779257810493564e-03,  9.129213528468188e-04, -1.168292826992727e-04,  9.799252555134580e-06, -1.010701065633728e-04, -1.016286322563554e-03, 2.408664017349051e-04, -1.180365716670982e-04, -4.901618964231094e-04,  7.591702023263230e-04, 1.643300226500934e-04,  9.819555658164168e-04, 3.084486271865903e-03,  1.000489145398127e-03, -2.011355808670453e-04,  3.851106593218637e-04, -2.191578669436778e-04,  7.799259583275399e-05, 2.742633043509575e-04, -5.779619729866884e-05, -3.399141765300028e-04,  8.457731555300578e-05, -8.044436495858822e-05,  7.333126578381739e-04, 1.541754300775118e-03, -7.422642115301648e-04, -5.671006481446945e-04, -1.012792190966599e-03, 4.508783084314435e-04, -3.996317871789723e-04, -5.864510454202492e-05,  7.278349668571663e-05, -2.421165702935854e-04,  9.050731481348429e-05, -4.599578593877526e-04, -3.920660682039689e-04, 3.572662689883905e-03, -3.885924180323703e-04, 5.317683197645558e-05,  1.487115862744922e-04, 1.091518894155551e-04, -3.495661727472279e-04, -3.453158367239708e-04,  6.440690150744804e-04, -9.407151197280230e-05,  4.636991340467029e-04, -5.959719781167051e-04, -4.035714497729968e-04, 2.113787874623421e-03,  8.757060552981044e-04, -3.074961433365423e-04,  4.957626944762734e-04, 1.323467295661459e-04,  1.157420879089447e-04, -2.267774015329744e-04, -3.020642765414424e-05, -1.216040223637231e-03, -2.132674344600614e-04, -1.161399347763162e-03,  2.081214462832974e-04, -3.376925704671955e-04,  1.615267730913604e-03, -7.671061392120165e-05, -2.043454636886109e-04, -1.150016069704971e-04, -5.623503526210505e-04, -5.539999441850148e-04,  3.412712391554841e-04, 7.221285952138272e-05,  4.327869757068990e-04, 1.046885638328053e-04,  5.270855495708950e-04, -8.382264077417937e-05,  2.367758838954296e-03, 1.178672643757672e-05,  1.765636364635420e-04, -2.718435441982955e-04,  2.029315534587345e-04, -2.122464174727108e-04,  1.143255853787585e-04, -4.885681158874539e-04,  1.837868890340791e-04, 2.562127233302684e-04, -2.687589963048944e-04, 9.111275159847667e-05,  1.113657776658790e-03, 1.929025826358972e-04, -2.374717680421701e-04, -1.515072360189380e-04, -6.201706367645909e-04, -5.516376885577017e-05, -2.142339611829118e-04, -2.395140958191658e-04, -9.239218040612562e-05, -9.391916370397841e-05,  9.038507457326793e-05, 8.955295721309005e-05,  2.095041767374986e-03, -2.744727608370296e-04, -3.248160641176478e-04, 7.517175808336302e-04, -3.209935433754759e-04, 6.974196141573734e-05, -2.266903346117081e-04, -1.606652995975180e-04, -5.955655957035097e-04, -5.632546447314839e-05, -1.482410040831155e-04, -2.319603062150856e-04,  1.399293273929114e-03, -1.243821994943891e-04,  1.924619951154025e-04, 5.822978122051826e-05, -1.220216827742845e-04, 4.759500772364724e-04, -2.641706059054306e-04, -4.089733162171438e-04, -6.282651570658755e-05, -1.679164767217046e-04, -3.526787175478708e-04, -1.940706824485805e-05,  1.528133899554859e-03, 1.029893844904668e-03, -6.690508837141660e-05, 2.891485054200306e-04, -1.658340695343566e-04, -9.678273972066425e-04,  1.694301136841223e-04, -2.380684035918504e-05, -2.769795304289877e-04, 4.708853777945545e-04,  1.805804331074078e-04, 5.733484370866473e-04,  3.197435268373996e-03, 5.251843761837377e-04,  1.328013152941568e-05, 1.829035800156962e-04, -5.284671918721344e-04, 1.864341218322784e-04,  8.252662135168812e-05, -1.675761087825690e-05, -4.577364966642022e-04, 2.576075593225496e-04, -2.539898235717137e-04, 1.119303286663712e-03,  1.236613972634965e-03, -1.600154920099628e-04, -6.921975325007163e-04, -1.099234329136182e-03,  3.748222859511523e-04, -2.914079096018189e-04,  6.238216560304930e-06, -7.328676708340883e-05,  4.509802593335305e-06, -3.349408899298379e-05,  9.614527454782258e-05, -4.651477765175523e-04,  3.364934870778484e-03, -4.344786229722079e-04,  2.230308813733960e-05, 1.525148545662531e-04,  3.782435201112245e-05, -2.775363531091343e-04, -2.319866560789315e-04, 4.364305620036585e-04, -8.445063482701064e-05, 3.662471815381736e-04, -4.993092577562069e-04, -2.998261158094252e-04,  1.806078493433735e-03, 6.770675119353480e-04, -1.755491535600218e-04, 1.204792968972466e-04,  4.544197068427517e-05, 2.425287081820953e-04, -2.112337504268519e-04, 1.667485141491452e-04, -1.202779392602585e-03, 3.291314304837124e-04,
                  -4.432120422261663e-04, 3.055370133784218e-04, -2.015073539314871e-04, 1.246953366891401e-03,  1.152620208028893e-04, -2.352464114893054e-04, -2.121286081835139e-04, -4.859280760450345e-04, -6.166212683800891e-04, 2.497158446369215e-04, -2.034123948247069e-05, 1.503403822195750e-04,  1.068086655289202e-04, 2.482576312905466e-04,  9.334126609484347e-05, 1.524250027454758e-03, -6.507925169929094e-05, 8.226847669298458e-05, -3.767149947042490e-04, 4.167736744776443e-04,  3.472583959252478e-05, 2.945487855796199e-04,  7.069029837636793e-05, 1.504789601589157e-04,  1.124692185846898e-04, -1.932474112317975e-04, -4.780949352030731e-05, 5.434077540867099e-04,  1.496489578193027e-04, -1.010712689160838e-04, -5.276858942035400e-05, -4.287884488921312e-04,  4.060883251379632e-05, -1.044060843544437e-05, -3.274108913353078e-04, 9.077099119890857e-05, -8.821028826034440e-05, -2.099979676554122e-05,  1.151914763795336e-04, 1.821768715342755e-03, -3.031689499383271e-04, -1.077591332506941e-04,  3.733714608986019e-04, -3.596447083042579e-04, -9.244589470061058e-05, -1.080102541324721e-04, -2.661347525046282e-04, -4.884529850114467e-04, -2.996813600482200e-04, -6.414632474511988e-05, -3.783810670518526e-04, 9.585379561100984e-04, -5.124707038472772e-05, 4.359466229284019e-04, -1.122587696442017e-04, -8.067388382321483e-05,  2.790119450856964e-04, -6.471220646754547e-05, -5.386232477848445e-04, 3.126344653337597e-04, -3.299592772742246e-05, -2.553078012184771e-04,  4.882593060110438e-05, 1.128483721575543e-03,  5.423678946894742e-04, -8.758086132421586e-05,  1.588038644152719e-04, -6.494383605923929e-05, -1.241590519782949e-03, 1.946415078429277e-04,  1.058706072117644e-04, -2.619509318453829e-04,  1.144468520571610e-04, 3.131250493804440e-04,  1.815377737685807e-04, 3.704822461712381e-03, -4.142884719860989e-05, -1.358770629177149e-04, -1.569929323408700e-04, -2.542349070111987e-04,  1.083705460398890e-04, 6.895840717388941e-05, -4.013516161614778e-06, -4.477720414875218e-04,  5.825577454090247e-05, -1.764034872283186e-04,  7.350184823590208e-04, 7.857517017216981e-04, -4.053587166418089e-04, -6.121459129224576e-04, -5.790187915309357e-04, 1.646093848872397e-04,  1.635773505214064e-04, 4.967649841748918e-05, -2.498289462217634e-04, -5.786943366866993e-05, -1.193957050611580e-05, 3.542549666695773e-06, -1.181045344016357e-03, 1.765303864986601e-03, -4.734919756084591e-04, 1.049168964465773e-04,  1.462732476778589e-04, 2.740922381258935e-06, -2.891585112386262e-04, -1.000157487530542e-04,  3.026958306618843e-04, -4.946518608012203e-05,  1.936811431432670e-04, -3.723090830769160e-04, -1.108304556033140e-04, 1.636379187683301e-03,  6.788687686650387e-04, -2.643231194235588e-04,  1.494517646177670e-04, -8.733275910205441e-05,  2.518230795293091e-04, -2.755042947949448e-04,  1.300074246135754e-06, -1.368974097328923e-03,  2.397729446303981e-04, -2.518105021509968e-04,  2.613470763792691e-04, -1.493519887149543e-04,  1.147723250883313e-03, 1.032447703217682e-04, -2.223972533715263e-04, -1.230888177445202e-04, -4.346918420309393e-04, -5.146023877889820e-04,  1.854842004936706e-04, 2.603774978859525e-05,  6.849363120366649e-05, 1.205662038546889e-04,  1.307218196340978e-04, 1.041813958601757e-04,  1.279778123365956e-03, -9.868466297989247e-05, -4.060524700206462e-05, -3.876948641604338e-04,  4.106199451056624e-04, 1.049062933822819e-04,  1.105021747404011e-04, 1.921628931976949e-04,  5.354952365198404e-05, 5.861319120313341e-05, -2.215545275906529e-04, -8.406130375439582e-05,  3.630939591486446e-04, 1.296793390271858e-04, -4.319901800469461e-05, 5.041292197052498e-06, -2.978433488749081e-04, 2.143665974114618e-05,  4.889416902497439e-05, -3.023213011773082e-04,  2.516751892309412e-04, -2.094257296198452e-04, -1.005470221529214e-05, 1.889081270753013e-05,  1.753899911850079e-03, -3.227181951349223e-04, -1.513860820981505e-04, 4.286330445385736e-05, -2.164119213047685e-04, -1.191205159264371e-04, -2.097604417533334e-05, -2.424201072437612e-04, -4.233460722292251e-04, -3.770578055046458e-04,  1.543491171545767e-05, -3.500815603529941e-04,  7.705380419021328e-04, 3.317657977757400e-05,  4.467036463161275e-04, -1.331846017110543e-04, -9.336467718453562e-05, 2.216761039593861e-04,  9.243449756788247e-05, -6.381661787673110e-04,  4.700458082194513e-04, 2.530649008350499e-05, -7.618360992896568e-05, 1.181795551467972e-05,  9.105455057835495e-04, 1.809051625295975e-04, -4.738545733555923e-05, 1.061794452785054e-04, -2.916462270620868e-06, -1.380556878929950e-03,  3.557984793900383e-04, 9.637699091344672e-05, -5.848557771194663e-05, 1.637193226664769e-05,  4.546551044474273e-04, 2.781523630260161e-04,  4.034330604108616e-03, -6.824520888850620e-05, -2.118945387780531e-04, -1.208446901057595e-04,  2.364286673561176e-04, -5.943607187121763e-05,  1.455132615791882e-04, -5.156082595091622e-05, -2.836536947198550e-04, -1.993070692221846e-04, -7.942668897005277e-05, -4.258732025302911e-05,  9.981162971033062e-04, -7.968279974748201e-04, -2.697425006423036e-04, -2.593390551003232e-04,  1.924771023682599e-04, 2.210012258374895e-04,  1.356661447576290e-04, -1.691602908091643e-04, -8.375486992639235e-06, 2.099501180433495e-04, -1.890918066429491e-04, -7.799939332133541e-04,  1.144725762873586e-03, -1.832792980159631e-04,  2.647629252384366e-04, 7.128015542923595e-05,  8.121201215917626e-05, -4.518209496221379e-04, -1.977177297339949e-05, 2.414847530262225e-04, -8.907455118383479e-05, -1.421628680388895e-04, -3.279010894492666e-04, -1.879816331965441e-04,  1.562203122029353e-03, 8.834046258753703e-04, -2.685498060804575e-04, 1.839885125841052e-04, -1.393162557095316e-05, 3.912279964507800e-04, -3.018534846870646e-04, 1.312510000233983e-04, -1.710232328084822e-03, 5.195225071926313e-04, -2.574566923777713e-04, 4.406494409275103e-04, -3.644829289117163e-04, 1.266961563163919e-03,  6.504038458343732e-05, -2.352681064933104e-04, -2.769761466108026e-04, -3.887490286145753e-04, -6.162495884897755e-04, 4.598370280291907e-04, -2.684977787159613e-04, 1.312206748823891e-04, -5.012972649824399e-05, 2.340985087330533e-04,  4.115152333719870e-05, 1.350234094887948e-03, -7.458003423313386e-05, 6.418587306595132e-05, -4.135142514875394e-04, 5.023219978393542e-04, -5.794420428537141e-05, 2.670207342461726e-04,  1.546252596323030e-04, 1.874814764143351e-04, -1.499629705425951e-04, -2.064905315322771e-04, -9.981167285175242e-05, 4.709688567962410e-04, -3.651991435316283e-05, 2.112502971859072e-05, -2.392983755396685e-05, 6.447891653811841e-05, -1.303983759406528e-04, 1.547892903369383e-04, -4.935695676808031e-04, 3.289120631972374e-04, -2.286375801677246e-04, 3.443242413400548e-06,  7.201804721880905e-05, 1.862089643095303e-03, -3.816809880169019e-04, -1.364177323630800e-04, -5.841365558583285e-05, -8.661335984210423e-05, -7.220281230029026e-05, 6.503414963749826e-05, -3.411947323960702e-04, -3.920283270071256e-04, -3.875801378453153e-04, -2.534869118179265e-05, -3.713295432909467e-04, 8.596130120348939e-04, -2.257722618407440e-05, 5.618601792862248e-04, -2.861665606983114e-04, 6.280102993951896e-06,  1.771177842819222e-04, 1.686717465575062e-05, -5.292764207040748e-04, 3.927172256119226e-04,  2.548450203037797e-05, -1.338125468374640e-04, -2.808877222916652e-06, 9.679289560536080e-04,  2.675746755009879e-04,
                  -2.183326733320123e-05,  2.103594927676672e-04, -4.382773230672501e-05, -1.696278241583332e-03, 3.169042032251734e-04,  1.838551061736981e-05, -1.567382122826877e-04, -1.476370295489338e-04, 4.716240530025027e-04,  1.340302841261143e-04, 4.631976601500160e-03, -3.766716240824976e-04, -1.548297632479052e-04, -3.345625101050567e-04, 3.495182690418858e-04, -6.789013883043242e-05, 1.256566203130413e-04,  3.382139046412720e-05, -1.543837210822333e-04, -2.278745259948024e-04, -1.970920193702928e-05, -1.971821699103733e-04, 1.209439990064415e-03, -7.600727065278493e-04, -1.964694840728710e-04, -3.697696146779185e-04, 1.827631605341618e-04,  1.661896758098867e-04, 5.831213571268144e-05, -2.016871045610289e-04, 4.653160566518819e-07,  8.508081049933001e-05, -6.620075225704706e-05, -1.035003012311716e-03, 1.122495452857853e-03, -3.480329257004029e-04, 3.963980308449253e-04,  7.362597582075704e-05, 9.417373612479540e-05, -3.790574502001985e-04, 8.138587349233914e-05,  2.253937557763949e-04, 6.101759251988204e-05, -3.578863324972864e-04, -1.073003592726821e-04, -2.273622610493080e-04, 1.705165132334643e-03,  1.020267729089144e-03, -1.838695476066055e-04,  1.514591333779881e-04, 1.342201884600387e-04,  4.627133357825455e-04, -2.592461023704791e-04,  2.449741739559933e-04, -1.925943030297698e-03,  5.924045883181146e-04, -2.833511305475184e-04,  5.555807447084246e-04, -3.073960460028257e-04,  1.297964461281058e-03, 8.821539439670420e-05, -2.914538974005171e-04, -2.822051318692649e-04, -4.847041375531450e-04, -6.649375208081657e-04,  3.661101568361285e-04, -1.792252816607953e-04,  1.542722829633232e-04, 2.955568823596983e-05,  1.808955094622627e-04, 1.764604452519405e-04,  1.408389546685105e-03, -7.917248779421975e-05,  5.821759026146438e-05, -3.309073981102143e-04,  5.000866539325937e-04, 7.971197828650959e-05,  2.236117085769307e-04, 2.599582187328472e-04,  8.324778044843274e-05, -1.131534495385316e-06, -2.687941572139580e-04, -5.460473118609159e-05,  4.925876082137543e-04, 6.724298863090061e-05, -3.332483915037077e-05, -9.834170363020238e-06, -1.752433208781097e-04, -1.147734973620338e-05,  3.371112476010012e-05, -4.416611221238777e-04,  4.904786725834871e-04, -2.020601563168831e-04,  3.628772675901957e-05, 1.671593091503452e-04,  2.137518852232650e-03, -4.388322274320803e-04, -3.822053978468132e-06, -2.332958187340500e-04,  5.772445454542398e-06, -1.479912253027331e-04,  1.987236104382857e-04, -3.394263276516784e-04, -5.232910860181953e-04, -4.209817426970934e-04, -6.909160100711870e-05, -4.710523497018187e-04,  8.869906477250456e-04, -6.907037754824827e-05,  5.067592194866359e-04, -2.903688146732888e-04, -4.926638762937275e-05, 2.584281298667642e-04,  1.698461503300199e-04, -5.749926300020116e-04,  4.859299350059611e-04, -3.461313754502717e-05, -1.032110570419463e-04, 7.094422032833956e-05,  1.153173884619958e-03, 1.554038454047377e-04,  7.912669933598696e-05, 1.369171606775014e-04,  7.153570955589098e-05, -1.905219076533401e-03,  1.621620729860701e-04, 7.011262290528906e-05, -4.282237682421960e-04, -1.613169999002102e-04,  4.150142672350985e-04, 3.786723864404155e-05,  5.178757836453890e-03, -3.735885420951821e-04, -2.126511704854371e-04, -5.132702854070380e-04,  6.118703238738547e-04, -1.271033751590096e-04,  1.948160152075506e-04, 4.902009219518367e-05,  4.256665954526258e-06, -2.145167664663938e-04,  1.970552571012672e-04, -4.277678153586043e-04,  1.546521477665228e-03, -1.001960510698098e-03, -1.527338463403366e-05, -3.258057568440271e-04,  6.712651307875379e-05, 2.252347768188436e-04,  2.318982339274872e-05, -1.451729652190324e-04, -1.671567214858459e-05, 6.678862820774528e-05, -1.330862434033523e-04, -1.013701849404547e-03,  1.144491280385092e-03, -3.644732174350626e-04,  5.762246820875931e-04, 5.263574630817970e-05,  1.114159970892690e-04, -3.066088829285083e-04,  1.648198246435487e-04, 2.489792842777442e-04,  1.725627209571277e-04, -4.789385421191189e-04,  5.761705762761654e-05, -2.882968374086559e-04,  2.059031360434981e-03, 1.135748931233977e-03, -3.791889374197085e-04, 1.245997090263831e-04,  3.343185732457595e-04, 6.718360673710814e-04, -6.305977447358994e-04, 3.356457588147288e-04, -2.367734138688168e-03, 1.003794614812421e-03, -2.736711381010826e-04, 9.797959141359582e-04, -2.017236147244904e-04, 1.512246372860038e-03,  1.950410404551280e-04, -3.266244364486268e-04, -1.883219115796750e-04, -6.094926767844113e-04, -6.995261018500084e-04, 1.964954453715966e-04, -1.018885577066997e-04, 2.045219314153073e-04,  1.216603016615885e-05, 1.850117297311816e-04,  1.119042994350921e-04, 1.662669579028766e-03,  6.067916169222609e-06, 1.093674906365332e-04, -4.991014771247495e-04, 5.553529761877883e-04,  1.146268128423364e-04, 2.900996734408522e-04,  2.492100269682192e-04, 1.467253950294873e-04,  1.941863649640847e-04, -3.184979109729927e-04, -9.662226206702357e-05, 5.963350783634796e-04,  2.028222199647665e-04, -1.237444826172422e-04, -1.905499843672121e-05, -5.451111759777047e-04,  3.306009398455558e-05, 1.275200724077864e-06, -3.501274849011160e-04, 6.057616097229112e-04, -2.964193489495322e-04, 8.284314191178207e-05,  1.623862477959513e-04, 2.701516357641386e-03, -7.958790700756036e-04, 1.048376280422496e-04, -5.377203731486921e-04, 2.042318682779101e-04, -2.639153243494463e-04, 3.587972836667540e-04, -3.378518953674063e-04, -5.686795486916094e-04, -3.683736141832601e-04, -1.085330455015849e-04, -6.378003486342690e-04, 1.191204204727033e-03,  1.372125609215616e-05, 6.158596364944350e-04, -3.766223449265858e-04, -6.524202099793547e-05,  2.178418059845493e-04, 2.798442600592301e-04, -7.541083783868858e-04, 5.725468842678898e-04,  7.577396908528394e-05, 1.020609187935256e-04, -9.473187400023246e-05, 1.474307096289162e-03, -1.030408849654000e-04, 4.274144759728388e-04,  6.117076511220412e-06, 3.702705681196214e-04, -2.051558748482761e-03, 4.053948035100363e-04,  3.432287092696444e-04, -8.432274433478104e-04, -3.599673721487535e-04, 1.011315139572474e-03,  3.319017950464456e-05, 6.222144775615900e-03, -8.940334755190505e-04, -4.995010006695030e-04, -1.025140508343047e-03, 6.869137313118780e-04, -2.427892145999665e-04, 2.488137765300581e-04,  1.848003716937702e-04, 1.395847346100367e-04, -4.558951732715763e-04, 2.571205531047496e-04, -5.640243909546588e-04, 2.095212360221990e-03, -1.151281572914691e-03, 3.250504684719516e-04, -3.525006577652001e-04, 2.292535690292522e-04,  2.697461796747710e-04, -3.701313509617678e-05, -2.277020025338783e-04, -2.096747128705200e-06,  3.897892824751479e-05, -1.479400454794393e-04, -1.291685135409239e-03, 1.403518937017068e-03, -4.857564224037318e-04, 6.340520124880808e-04, -8.868644562595854e-05, 4.907994922996115e-05, -2.711130713473811e-04, 2.146673555947058e-04,  2.097813499061600e-04, 1.119040975251027e-04, -5.922863928350427e-04, 2.474783255053758e-04, -3.101846218503568e-04, 2.666805093079125e-03 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$n_iter),
               c(10 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$Q),
               c( 0.0370208313167464317, 0.0346841385423950488, -0.0004929104651646699, -0.0208570993559084837,  0.0032854226598369911, 0.0392785234301780833,  0.0300048233899102915, -0.0156116662728580172, -0.0303768203372281297, -0.0311840099798412554, -0.0309083547817222033, 0.0346841385423950488,  0.5712629599319651863, -0.1689343403869119908,  0.1699914560982205836, 0.1983733317153642262,  0.4806196547051954648, 0.4963627829005280989, -0.1729705978254248155, 0.1411367918866995030,  0.0644336160955874954, -0.0831725461743011429, -0.0004929104651646699, -0.1689343403869119908,  0.2115075946595506851, 0.0109238356510654756, -0.1197455718749028120, -0.0231882545551327229, -0.2716547924480197662, 0.0656021077216151771, -0.2844790476474123864, -0.2181303346064001336, -0.0779258954046652963, -0.0208570993559084837,  0.1699914560982205836, 0.0109238356510654756,  0.4761910066070441649, 0.0408497056353600285,  0.1205033594638909439, 0.1023631766451162245,  0.0230600858440459036, 0.0907121797967034293,  0.0289888807148874356, 0.1265561127868692903,  0.0032854226598369911, 0.1983733317153642262, -0.1197455718749028120, 0.0408497056353600285,  0.5039644922472519273, 0.0663979994697856679,  0.5556907566025846013, -0.8218664668394478623,  0.8227520022976404501, 0.1403384208740941774,  0.4366440571840116691, 0.0392785234301780833,  0.4806196547051954648, -0.0231882545551327229,  0.1205033594638909439, 0.0663979994697856679,  0.6282414301609345886, 0.1833564834738904969,  0.0723787460160525697, -0.0429102951511652342,  0.0907191485538196285, -0.2506464386870880245,  0.0300048233899102915, 0.4963627829005280989, -0.2716547924480197662, 0.1023631766451162245,  0.5556907566025846013, 0.1833564834738904969,  0.8898900833008855926, -0.8828763382661020120,  0.7554264243913209054, 0.0672677678739100615,  0.3700242471030621427, -0.0156116662728580172, -0.1729705978254248155, 0.0656021077216151771,  0.0230600858440459036, -0.8218664668394478623,  0.0723787460160525697, -0.8828763382661020120,  1.5895097904477248907, -1.1563571198640349991,  0.1147555903935551791, -0.7513599854593675520, -0.0303768203372281297, 0.1411367918866995030, -0.2844790476474123864, 0.0907121797967034293,  0.8227520022976404501, -0.0429102951511652342,  0.7554264243913209054, -1.1563571198640349991,  1.7257267246945944272, 0.6473135706713051274,  0.8836806896751779883, -0.0311840099798412554,  0.0644336160955874954, -0.2181303346064001336,  0.0289888807148874356, 0.1403384208740941774,  0.0907191485538196285, 0.0672677678739100615,  0.1147555903935551791, 0.6473135706713051274,  0.6423093152893194491, 0.1696617683423707335, -0.0309083547817222033, -0.0831725461743011429, -0.0779258954046652963, 0.1265561127868692903,  0.4366440571840116691, -0.2506464386870880245,  0.3700242471030621427, -0.7513599854593675520,  0.8836806896751779883, 0.1696617683423707335,  0.6093938253081568890 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$Q_0),
               c(100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 100, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 100 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$n_risk),
               c(20188, 19718, 19208, 18895, 18093, 17286, 16014, 14766, 13487, 12518 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$times),
               c( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$risk_set),
               c(NA )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$order),
               c(1 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$F_),
               c(1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$method),
               c("EKF" )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$model),
               c("exponential" )
               , tolerance = 1e-04)

  expect_equal(c(result_exp$est_Q_0),
               c(FALSE )
               , tolerance = 1e-04)
})




# for(i in 1:100){
#   n_vars <- 10
#   sims <- test_sim_func_exp(n_series = 1e4, n_vars = n_vars, t_0 = 0, t_max = 10,
#                             x_range = 1, x_mean = 0, re_draw = T, beta_start = 0,
#                             intercept_start = -5, sds = c(.1, rep(1, n_vars)))
#
#   tmp_file <- file("exponential.log")
#   sink(tmp_file)
#   result_exp = ddhazard(
#     formula = survival::Surv(tstart, tstop, event) ~ . - id - tstart - tstop - event,
#     data = sims$res,
#     by = (by_ <- 1),
#     n_max = 10^4, eps = 10^-2,
#     a_0 = rep(0, n_vars + 1),
#     Q_0 = diag(1e4, n_vars + 1),
#     Q = diag(1, n_vars + 1),
#     est_Q_0 = F,
#     max_T = 10,
#     id = sims$res$id, order_ = 1,
#     verbose = F,
#     model = "exponential"
#   )
#   sink()
#   close(tmp_file)
#
#   print(sum(sims$res$event))
#   matplot(seq_len(nrow(sims$betas)) - 1, sims$betas, type = "l", lty = 1)
#   matplot(result_exp$times, result_exp$a_t_d_s, result_exp$a_t_d_s, type = "l", lty = 2, add = T)
# }
